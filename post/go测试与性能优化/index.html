<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ– - cold bin&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="cold-bin" /><meta name="description" content="goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ– ä¸€ã€å•å…ƒæµ‹è¯• ä¸å†™æµ‹è¯•çš„å¼€å‘ä¸æ˜¯å¥½ç¨‹åºå‘˜ã€‚æˆ‘ä¸ªäººéå¸¸å´‡å°šTDDï¼ˆTest Driven Developmentï¼‰çš„ï¼Œç„¶è€Œå¯æƒœçš„æ˜¯å›½å†…çš„ç¨‹åº" />






<meta name="generator" content="Hugo 0.119.0 with theme even" />


<link rel="canonical" href="https://cold-bin.github.io/post/go%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.f7f4d73c43a767e434997279164764c32c7f0f3b1ec88bfb5bfc297b77fd7e7a.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–" />
<meta property="og:description" content="goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ– ä¸€ã€å•å…ƒæµ‹è¯• ä¸å†™æµ‹è¯•çš„å¼€å‘ä¸æ˜¯å¥½ç¨‹åºå‘˜ã€‚æˆ‘ä¸ªäººéå¸¸å´‡å°šTDDï¼ˆTest Driven Developmentï¼‰çš„ï¼Œç„¶è€Œå¯æƒœçš„æ˜¯å›½å†…çš„ç¨‹åº" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cold-bin.github.io/post/go%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-07T17:46:37+08:00" />
<meta property="article:modified_time" content="2022-07-07T17:46:37+08:00" />
<meta itemprop="name" content="Goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–">
<meta itemprop="description" content="goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ– ä¸€ã€å•å…ƒæµ‹è¯• ä¸å†™æµ‹è¯•çš„å¼€å‘ä¸æ˜¯å¥½ç¨‹åºå‘˜ã€‚æˆ‘ä¸ªäººéå¸¸å´‡å°šTDDï¼ˆTest Driven Developmentï¼‰çš„ï¼Œç„¶è€Œå¯æƒœçš„æ˜¯å›½å†…çš„ç¨‹åº"><meta itemprop="datePublished" content="2022-07-07T17:46:37+08:00" />
<meta itemprop="dateModified" content="2022-07-07T17:46:37+08:00" />
<meta itemprop="wordCount" content="10779">
<meta itemprop="keywords" content="å•å…ƒæµ‹è¯•,æ€§èƒ½ä¼˜åŒ–,ç½‘ç»œæµ‹è¯•," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–"/>
<meta name="twitter:description" content="goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ– ä¸€ã€å•å…ƒæµ‹è¯• ä¸å†™æµ‹è¯•çš„å¼€å‘ä¸æ˜¯å¥½ç¨‹åºå‘˜ã€‚æˆ‘ä¸ªäººéå¸¸å´‡å°šTDDï¼ˆTest Driven Developmentï¼‰çš„ï¼Œç„¶è€Œå¯æƒœçš„æ˜¯å›½å†…çš„ç¨‹åº"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>

  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">cold bin&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/links/">
        <li class="mobile-menu-item">Links</li>
      </a><a href="/search/">
        <li class="mobile-menu-item">Search</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">cold bin&#39;s blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/links/">Links</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/search/">Search</a>
      </li>
  </ul>
</nav>

    </header>

    
    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-07 </span>
        <div class="post-category">
            <a href="/categories/golang/"> golang </a>
            </div>
          <span class="more-meta"> çº¦ 10779 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 22 åˆ†é’Ÿ </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡é˜…è¯» </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–"><code>go</code>æµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–</a></li>
    <li><a href="#ä¸€å•å…ƒæµ‹è¯•">ä¸€ã€å•å…ƒæµ‹è¯•</a>
      <ul>
        <li><a href="#go-testå·¥å…·"><code>go test</code>å·¥å…·</a></li>
        <li><a href="#æµ‹è¯•å‡½æ•°">æµ‹è¯•å‡½æ•°</a>
          <ul>
            <li><a href="#æ ¼å¼">æ ¼å¼</a></li>
            <li><a href="#å•å…ƒæµ‹è¯•ç¤ºä¾‹">å•å…ƒæµ‹è¯•ç¤ºä¾‹</a></li>
            <li><a href="#go-test--v"><code>go test -v</code></a></li>
            <li><a href="#go-test--run"><code>go test -run</code></a></li>
            <li><a href="#å›å½’æµ‹è¯•">å›å½’æµ‹è¯•</a></li>
            <li><a href="#è·³è¿‡æŸäº›æµ‹è¯•ç”¨ä¾‹">è·³è¿‡æŸäº›æµ‹è¯•ç”¨ä¾‹</a></li>
            <li><a href="#å­æµ‹è¯•">å­æµ‹è¯•</a></li>
            <li><a href="#è¡¨æ ¼é©±åŠ¨æµ‹è¯•">è¡¨æ ¼é©±åŠ¨æµ‹è¯•</a></li>
            <li><a href="#æµ‹è¯•è¦†ç›–ç‡">æµ‹è¯•è¦†ç›–ç‡</a></li>
            <li><a href="#testifyassert">testify/assert</a></li>
            <li><a href="#å®‰è£…">å®‰è£…</a></li>
            <li><a href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li>
          </ul>
        </li>
        <li><a href="#åŸºå‡†æµ‹è¯•">åŸºå‡†æµ‹è¯•</a>
          <ul>
            <li><a href="#åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼">åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼</a></li>
            <li><a href="#åŸºå‡†æµ‹è¯•ç¤ºä¾‹">åŸºå‡†æµ‹è¯•ç¤ºä¾‹</a></li>
            <li><a href="#æ€§èƒ½æ¯”è¾ƒå‡½æ•°">æ€§èƒ½æ¯”è¾ƒå‡½æ•°</a></li>
            <li><a href="#é‡ç½®æ—¶é—´">é‡ç½®æ—¶é—´</a></li>
            <li><a href="#å¹¶è¡Œæµ‹è¯•-1">å¹¶è¡Œæµ‹è¯•</a></li>
          </ul>
        </li>
        <li><a href="#setupä¸teardown"><code>Setup</code>ä¸<code>TearDown</code></a>
          <ul>
            <li><a href="#testmain"><code>TestMain</code></a></li>
            <li><a href="#å­æµ‹è¯•çš„setupä¸teardown">å­æµ‹è¯•çš„Setupä¸Teardown</a></li>
          </ul>
        </li>
        <li><a href="#ç¤ºä¾‹å‡½æ•°">ç¤ºä¾‹å‡½æ•°</a>
          <ul>
            <li><a href="#ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼">ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼</a></li>
            <li><a href="#ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹">ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#äºŒç½‘ç»œæµ‹è¯•">äºŒã€ç½‘ç»œæµ‹è¯•</a>
      <ul>
        <li><a href="#httptest"><code>httptest</code></a></li>
        <li><a href="#gock"><code>gock</code></a>
          <ul>
            <li><a href="#å®‰è£…-1">å®‰è£…</a></li>
            <li><a href="#ä½¿ç”¨ç¤ºä¾‹-1">ä½¿ç”¨ç¤ºä¾‹</a></li>
          </ul>
        </li>
        <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
	 
	  	
	
    <div class="post-content image-border">
	 <h1 id="goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–"><code>go</code>æµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–</h1>
<h1 id="ä¸€å•å…ƒæµ‹è¯•">ä¸€ã€å•å…ƒæµ‹è¯•</h1>
<p>ä¸å†™æµ‹è¯•çš„å¼€å‘ä¸æ˜¯å¥½ç¨‹åºå‘˜ã€‚æˆ‘ä¸ªäººéå¸¸å´‡å°šTDDï¼ˆTest Driven Developmentï¼‰çš„ï¼Œç„¶è€Œå¯æƒœçš„æ˜¯å›½å†…çš„ç¨‹åºå‘˜éƒ½ä¸å¤ªå…³æ³¨æµ‹è¯•è¿™ä¸€éƒ¨åˆ†ã€‚ è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä¸‹åœ¨Goè¯­è¨€ä¸­å¦‚ä½•åšå•å…ƒæµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•ã€‚</p>
<h2 id="go-testå·¥å…·"><code>go test</code>å·¥å…·</h2>
<p>Goè¯­è¨€ä¸­çš„æµ‹è¯•ä¾èµ–<code>go test</code>å‘½ä»¤ã€‚ç¼–å†™æµ‹è¯•ä»£ç å’Œç¼–å†™æ™®é€šçš„Goä»£ç è¿‡ç¨‹æ˜¯ç±»ä¼¼çš„ï¼Œå¹¶ä¸éœ€è¦å­¦ä¹ æ–°çš„è¯­æ³•ã€è§„åˆ™æˆ–å·¥å…·ã€‚</p>
<p>go testå‘½ä»¤æ˜¯ä¸€ä¸ªæŒ‰ç…§ä¸€å®šçº¦å®šå’Œç»„ç»‡çš„æµ‹è¯•ä»£ç çš„é©±åŠ¨ç¨‹åºã€‚åœ¨åŒ…ç›®å½•å†…ï¼Œæ‰€æœ‰ä»¥<code>_test.go</code>ä¸ºåç¼€åçš„æºä»£ç æ–‡ä»¶éƒ½æ˜¯<code>go test</code>æµ‹è¯•çš„ä¸€éƒ¨åˆ†ï¼Œä¸ä¼šè¢«<code>go build</code>ç¼–è¯‘åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚</p>
<p>åœ¨<code>*_test.go</code>æ–‡ä»¶ä¸­æœ‰ä¸‰ç§ç±»å‹çš„å‡½æ•°ï¼Œå•å…ƒæµ‹è¯•å‡½æ•°ã€åŸºå‡†æµ‹è¯•å‡½æ•°å’Œç¤ºä¾‹å‡½æ•°ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">ç±»å‹</th>
<th style="text-align:center">æ ¼å¼</th>
<th style="text-align:center">ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">æµ‹è¯•å‡½æ•°</td>
<td style="text-align:center">å‡½æ•°åå‰ç¼€ä¸ºTest</td>
<td style="text-align:center">æµ‹è¯•ç¨‹åºçš„ä¸€äº›é€»è¾‘è¡Œä¸ºæ˜¯å¦æ­£ç¡®</td>
</tr>
<tr>
<td style="text-align:center">åŸºå‡†å‡½æ•°</td>
<td style="text-align:center">å‡½æ•°åå‰ç¼€ä¸ºBenchmark</td>
<td style="text-align:center">æµ‹è¯•å‡½æ•°çš„æ€§èƒ½</td>
</tr>
<tr>
<td style="text-align:center">ç¤ºä¾‹å‡½æ•°</td>
<td style="text-align:center">å‡½æ•°åå‰ç¼€ä¸ºExample</td>
<td style="text-align:center">ä¸ºæ–‡æ¡£æä¾›ç¤ºä¾‹æ–‡æ¡£</td>
</tr>
</tbody>
</table>
<p><code>go test</code>å‘½ä»¤ä¼šéå†æ‰€æœ‰çš„<code>*_test.go</code>æ–‡ä»¶ä¸­ç¬¦åˆä¸Šè¿°å‘½åè§„åˆ™çš„å‡½æ•°ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„mainåŒ…ç”¨äºè°ƒç”¨ç›¸åº”çš„æµ‹è¯•å‡½æ•°ï¼Œç„¶åæ„å»ºå¹¶è¿è¡Œã€æŠ¥å‘Šæµ‹è¯•ç»“æœï¼Œæœ€åæ¸…ç†æµ‹è¯•ä¸­ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<h2 id="æµ‹è¯•å‡½æ•°">æµ‹è¯•å‡½æ•°</h2>
<h3 id="æ ¼å¼">æ ¼å¼</h3>
<p>æ¯ä¸ªæµ‹è¯•å‡½æ•°å¿…é¡»å¯¼å…¥<code>testing</code>åŒ…ï¼Œæµ‹è¯•å‡½æ•°çš„åŸºæœ¬æ ¼å¼ï¼ˆç­¾åï¼‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestName</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•å‡½æ•°çš„åå­—å¿…é¡»ä»¥<code>Test</code>å¼€å¤´ï¼Œå¯é€‰çš„åç¼€åå¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œä¸¾å‡ ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestAdd</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSum</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestLog</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span> <span class="o">...</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­å‚æ•°<code>t</code>ç”¨äºæŠ¥å‘Šæµ‹è¯•å¤±è´¥å’Œé™„åŠ çš„æ—¥å¿—ä¿¡æ¯ã€‚ <code>testing.T</code>çš„æ‹¥æœ‰çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Cleanup</span><span class="p">(</span><span class="kd">func</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Error</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Errorf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Fail</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">FailNow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Failed</span><span class="p">()</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Fatal</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Fatalf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Helper</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Log</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Logf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Name</span><span class="p">()</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Skip</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">SkipNow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Skipf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Skipped</span><span class="p">()</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">TempDir</span><span class="p">()</span> <span class="kt">string</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å•å…ƒæµ‹è¯•ç¤ºä¾‹">å•å…ƒæµ‹è¯•ç¤ºä¾‹</h3>
<p>å°±åƒç»†èƒæ˜¯æ„æˆæˆ‘ä»¬èº«ä½“çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè½¯ä»¶ç¨‹åºä¹Ÿæ˜¯ç”±å¾ˆå¤šå•å…ƒç»„ä»¶æ„æˆçš„ã€‚å•å…ƒç»„ä»¶å¯ä»¥æ˜¯å‡½æ•°ã€ç»“æ„ä½“ã€æ–¹æ³•å’Œæœ€ç»ˆç”¨æˆ·å¯èƒ½ä¾èµ–çš„ä»»æ„ä¸œè¥¿ã€‚æ€»ä¹‹æˆ‘ä»¬éœ€è¦ç¡®ä¿è¿™äº›ç»„ä»¶æ˜¯èƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„ã€‚å•å…ƒæµ‹è¯•æ˜¯ä¸€äº›åˆ©ç”¨å„ç§æ–¹æ³•æµ‹è¯•å•å…ƒç»„ä»¶çš„ç¨‹åºï¼Œå®ƒä¼šå°†ç»“æœä¸é¢„æœŸè¾“å‡ºè¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨<code>base_demo</code>åŒ…ä¸­å®šä¹‰äº†ä¸€ä¸ª<code>Split</code>å‡½æ•°ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// base_demo/split.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">base_demo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Split æŠŠå­—ç¬¦ä¸²sæŒ‰ç…§ç»™å®šçš„åˆ†éš”ç¬¦sepè¿›è¡Œåˆ†å‰²è¿”å›å­—ç¬¦ä¸²åˆ‡ç‰‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">result</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">s</span><span class="p">[:</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="nx">s</span> <span class="p">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">i</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>split_test.go</code>çš„æµ‹è¯•æ–‡ä»¶ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæµ‹è¯•å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// split/split_test.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">split</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;reflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;testing&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplit</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// æµ‹è¯•å‡½æ•°åå¿…é¡»ä»¥Testå¼€å¤´ï¼Œå¿…é¡»æ¥æ”¶ä¸€ä¸ª*testing.Tç±»å‹å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">,</span> <span class="s">&#34;:&#34;</span><span class="p">)</span>         <span class="c1">// ç¨‹åºè¾“å‡ºçš„ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">want</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">}</span>    <span class="c1">// æœŸæœ›çš„ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// å› ä¸ºsliceä¸èƒ½æ¯”è¾ƒç›´æ¥ï¼Œå€ŸåŠ©åå°„åŒ…ä¸­çš„æ–¹æ³•æ¯”è¾ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%v, got:%v&#34;</span><span class="p">,</span> <span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span> <span class="c1">// æµ‹è¯•å¤±è´¥è¾“å‡ºé”™è¯¯æç¤º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å½“å‰è·¯å¾„ä¸‹æ‰§è¡Œ<code>go test</code>å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo       0.005s
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="go-test--v"><code>go test -v</code></h3>
<p>ç°åœ¨æˆ‘ä»¬æœ‰å¤šä¸ªæµ‹è¯•ç”¨ä¾‹äº†ï¼Œä¸ºäº†èƒ½æ›´å¥½çš„åœ¨è¾“å‡ºç»“æœä¸­çœ‹åˆ°æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œæƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä¸º<code>go test</code>å‘½ä»¤æ·»åŠ <code>-v</code>å‚æ•°ï¼Œè®©å®ƒè¾“å‡ºå®Œæ•´çš„æµ‹è¯•ç»“æœï¼ˆæµ‹è¯•æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit
</span></span><span class="line"><span class="cl">--- PASS: TestSplit <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitWithComplexSep
</span></span><span class="line"><span class="cl">    split_test.go:20: expected:<span class="o">[</span>a d<span class="o">]</span>, got:<span class="o">[</span>a cd<span class="o">]</span>
</span></span><span class="line"><span class="cl">--- FAIL: TestSplitWithComplexSep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">FAIL
</span></span><span class="line"><span class="cl"><span class="nb">exit</span> status <span class="m">1</span>
</span></span><span class="line"><span class="cl">FAIL    golang-unit-test-demo/base_demo 0.009s
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä¸Šé¢çš„è¾“å‡ºç»“æœæˆ‘ä»¬èƒ½æ¸…æ¥šçš„çœ‹åˆ°æ˜¯<code>TestSplitWithComplexSep</code>è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ²¡æœ‰æµ‹è¯•é€šè¿‡ã€‚</p>
<h3 id="go-test--run"><code>go test -run</code></h3>
<p>åœ¨æ‰§è¡Œ<code>go test</code>å‘½ä»¤çš„æ—¶å€™å¯ä»¥æ·»åŠ <code>-run</code>å‚æ•°ï¼Œå®ƒå¯¹åº”ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œåªæœ‰å‡½æ•°ååŒ¹é…ä¸Šçš„æµ‹è¯•å‡½æ•°æ‰ä¼šè¢«<code>go test</code>å‘½ä»¤æ‰§è¡Œã€‚</p>
<p>ä¾‹å¦‚é€šè¿‡ç»™<code>go test</code>æ·»åŠ <code>-run=Sep</code>å‚æ•°æ¥å‘Šè¯‰å®ƒæœ¬æ¬¡æµ‹è¯•åªè¿è¡Œ<code>TestSplitWithComplexSep</code>è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span> -run<span class="o">=</span>Sep -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitWithComplexSep
</span></span><span class="line"><span class="cl">--- PASS: TestSplitWithComplexSep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.010s
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å›å½’æµ‹è¯•">å›å½’æµ‹è¯•</h3>
<p>æˆ‘ä»¬ä¿®æ”¹äº†ä»£ç ä¹‹åä»…ä»…æ‰§è¡Œé‚£äº›å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹æˆ–æ–°å¼•å…¥çš„æµ‹è¯•ç”¨ä¾‹æ˜¯é”™è¯¯ä¸”å±é™©çš„ï¼Œ<strong>æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯å®Œæ•´è¿è¡Œæ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¿è¯ä¸ä¼šå› ä¸ºä¿®æ”¹ä»£ç è€Œå¼•å…¥æ–°çš„é—®é¢˜</strong>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit
</span></span><span class="line"><span class="cl">--- PASS: TestSplit <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitWithComplexSep
</span></span><span class="line"><span class="cl">--- PASS: TestSplitWithComplexSep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.011s
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è·³è¿‡æŸäº›æµ‹è¯•ç”¨ä¾‹">è·³è¿‡æŸäº›æµ‹è¯•ç”¨ä¾‹</h3>
<p>ä¸ºäº†èŠ‚çœæ—¶é—´æ”¯æŒåœ¨å•å…ƒæµ‹è¯•æ—¶è·³è¿‡æŸäº›è€—æ—¶çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestTimeConsuming</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">testing</span><span class="p">.</span><span class="nf">Short</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">t</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="s">&#34;shortæ¨¡å¼ä¸‹ä¼šè·³è¿‡è¯¥æµ‹è¯•ç”¨ä¾‹&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“æ‰§è¡Œ<code>go test -short</code>æ—¶å°±ä¸ä¼šæ‰§è¡Œä¸Šé¢çš„<code>TestTimeConsuming</code>æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<h3 id="å­æµ‹è¯•">å­æµ‹è¯•</h3>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªæµ‹è¯•æ•°æ®ç¼–å†™äº†ä¸€ä¸ªæµ‹è¯•å‡½æ•°ï¼Œè€Œé€šå¸¸å•å…ƒæµ‹è¯•ä¸­éœ€è¦å¤šç»„æµ‹è¯•æ•°æ®ä¿è¯æµ‹è¯•çš„æ•ˆæœã€‚Go1.7+ä¸­æ–°å¢äº†å­æµ‹è¯•ï¼Œæ”¯æŒåœ¨æµ‹è¯•å‡½æ•°ä¸­ä½¿ç”¨<code>t.Run</code>æ‰§è¡Œä¸€ç»„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸ºä¸åŒçš„æµ‹è¯•æ•°æ®å®šä¹‰å¤šä¸ªæµ‹è¯•å‡½æ•°äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestXXX</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;case1&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span><span class="o">...</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;case2&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span><span class="o">...</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;case3&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span><span class="o">...</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¡¨æ ¼é©±åŠ¨æµ‹è¯•">è¡¨æ ¼é©±åŠ¨æµ‹è¯•</h3>
<h4 id="ä»‹ç»">ä»‹ç»</h4>
<p>è¡¨æ ¼é©±åŠ¨æµ‹è¯•ä¸æ˜¯å·¥å…·ã€åŒ…æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿ï¼Œå®ƒåªæ˜¯ç¼–å†™æ›´æ¸…æ™°æµ‹è¯•çš„ä¸€ç§æ–¹å¼å’Œè§†è§’ã€‚</p>
<p>ç¼–å†™å¥½çš„æµ‹è¯•å¹¶éæ˜“äº‹ï¼Œä½†åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¡¨æ ¼é©±åŠ¨æµ‹è¯•å¯ä»¥æ¶µç›–å¾ˆå¤šæ–¹é¢ï¼šè¡¨æ ¼é‡Œçš„æ¯ä¸€ä¸ªæ¡ç›®éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…å«è¾“å…¥å’Œé¢„æœŸç»“æœï¼Œæœ‰æ—¶è¿˜åŒ…å«æµ‹è¯•åç§°ç­‰é™„åŠ ä¿¡æ¯ï¼Œä»¥ä½¿æµ‹è¯•è¾“å‡ºæ˜“äºé˜…è¯»ã€‚</p>
<p>ä½¿ç”¨è¡¨æ ¼é©±åŠ¨æµ‹è¯•èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„ç»´æŠ¤å¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œé¿å…åœ¨ç¼–å†™å•å…ƒæµ‹è¯•æ—¶é¢‘ç¹çš„å¤åˆ¶ç²˜è´´ã€‚</p>
<p>è¡¨æ ¼é©±åŠ¨æµ‹è¯•çš„æ­¥éª¤é€šå¸¸æ˜¯å®šä¹‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹è¡¨æ ¼ï¼Œç„¶åéå†è¡¨æ ¼ï¼Œå¹¶ä½¿ç”¨<code>t.Run</code>å¯¹æ¯ä¸ªæ¡ç›®æ‰§è¡Œå¿…è¦çš„æµ‹è¯•ã€‚</p>
<h4 id="ç¤ºä¾‹">ç¤ºä¾‹</h4>
<p>å®˜æ–¹æ ‡å‡†åº“ä¸­æœ‰å¾ˆå¤šè¡¨æ ¼é©±åŠ¨æµ‹è¯•çš„ç¤ºä¾‹ï¼Œä¾‹å¦‚fmtåŒ…ä¸­ä¾¿æœ‰å¦‚ä¸‹æµ‹è¯•ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">flagtests</span> <span class="p">=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">in</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">out</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}{</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%a&#34;</span><span class="p">,</span> <span class="s">&#34;[%a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-a&#34;</span><span class="p">,</span> <span class="s">&#34;[%-a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%+a&#34;</span><span class="p">,</span> <span class="s">&#34;[%+a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%#a&#34;</span><span class="p">,</span> <span class="s">&#34;[%#a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;% a&#34;</span><span class="p">,</span> <span class="s">&#34;[% a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%0a&#34;</span><span class="p">,</span> <span class="s">&#34;[%0a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%1.2a&#34;</span><span class="p">,</span> <span class="s">&#34;[%1.2a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-1.2a&#34;</span><span class="p">,</span> <span class="s">&#34;[%-1.2a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%+1.2a&#34;</span><span class="p">,</span> <span class="s">&#34;[%+1.2a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-+1.2a&#34;</span><span class="p">,</span> <span class="s">&#34;[%+-1.2a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-+1.2abc&#34;</span><span class="p">,</span> <span class="s">&#34;[%+-1.2a]bc&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-1.2abc&#34;</span><span class="p">,</span> <span class="s">&#34;[%-1.2a]bc&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestFlagParser</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">flagprinter</span> <span class="nx">flagPrinter</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">flagtests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">in</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">s</span> <span class="o">:=</span> <span class="nf">Sprintf</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">in</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">flagprinter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">s</span> <span class="o">!=</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">out</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;got %q, want %q&#34;</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">out</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šå¸¸è¡¨æ ¼æ˜¯åŒ¿åç»“æ„ä½“åˆ‡ç‰‡ï¼Œå¯ä»¥å®šä¹‰ç»“æ„ä½“æˆ–ä½¿ç”¨å·²ç»å­˜åœ¨çš„ç»“æ„è¿›è¡Œç»“æ„ä½“æ•°ç»„å£°æ˜ã€‚nameå±æ€§ç”¨æ¥æè¿°ç‰¹å®šçš„æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬è¯•ç€è‡ªå·±ç¼–å†™è¡¨æ ¼é©±åŠ¨æµ‹è¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplitAll</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰æµ‹è¯•è¡¨æ ¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// è¿™é‡Œä½¿ç”¨åŒ¿åç»“æ„ä½“å®šä¹‰äº†è‹¥å¹²ä¸ªæµ‹è¯•ç”¨ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// å¹¶ä¸”ä¸ºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è®¾ç½®äº†ä¸€ä¸ªåç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">input</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sep</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">want</span>  <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}{</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;base case&#34;</span><span class="p">,</span> <span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">,</span> <span class="s">&#34;:&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;wrong sep&#34;</span><span class="p">,</span> <span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">,</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;more sep&#34;</span><span class="p">,</span> <span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="s">&#34;bc&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;leading sep&#34;</span><span class="p">,</span> <span class="s">&#34;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&#34;</span><span class="p">,</span> <span class="s">&#34;æ²™&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;æ²³æœ‰&#34;</span><span class="p">,</span> <span class="s">&#34;åˆæœ‰æ²³&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// éå†æµ‹è¯•ç”¨ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ä½¿ç”¨t.Run()æ‰§è¡Œå­æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%#v, got:%#v&#34;</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ç»ˆç«¯æ‰§è¡Œ<code>go test -v</code>ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹æµ‹è¯•è¾“å‡ºç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit
</span></span><span class="line"><span class="cl">--- PASS: TestSplit <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitWithComplexSep
</span></span><span class="line"><span class="cl">--- PASS: TestSplitWithComplexSep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   <span class="nv">TestSplitAll</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitAll/base_case
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitAll/wrong_sep
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitAll/more_sep
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitAll/leading_sep
</span></span><span class="line"><span class="cl">--- PASS: TestSplitAll <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: TestSplitAll/base_case <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: TestSplitAll/wrong_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: TestSplitAll/more_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: TestSplitAll/leading_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.010s
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¹¶è¡Œæµ‹è¯•">å¹¶è¡Œæµ‹è¯•</h4>
<p>è¡¨æ ¼é©±åŠ¨æµ‹è¯•ä¸­é€šå¸¸ä¼šå®šä¹‰æ¯”è¾ƒå¤šçš„æµ‹è¯•ç”¨ä¾‹ï¼Œè€ŒGoè¯­è¨€åˆå¤©ç”Ÿæ”¯æŒå¹¶å‘ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å‘æŒ¥è‡ªèº«å¹¶å‘ä¼˜åŠ¿å°†è¡¨æ ¼é©±åŠ¨æµ‹è¯•å¹¶è¡ŒåŒ–ã€‚ æƒ³è¦åœ¨å•å…ƒæµ‹è¯•è¿‡ç¨‹ä¸­ä½¿ç”¨å¹¶è¡Œæµ‹è¯•ï¼Œå¯ä»¥åƒä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­é‚£æ ·é€šè¿‡æ·»åŠ <code>t.Parallel()</code>æ¥å®ç°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplitAll</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">Parallel</span><span class="p">()</span>  <span class="c1">// å°† TLog æ ‡è®°ä¸ºèƒ½å¤Ÿä¸å…¶ä»–æµ‹è¯•å¹¶è¡Œè¿è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// å®šä¹‰æµ‹è¯•è¡¨æ ¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// è¿™é‡Œä½¿ç”¨åŒ¿åç»“æ„ä½“å®šä¹‰äº†è‹¥å¹²ä¸ªæµ‹è¯•ç”¨ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// å¹¶ä¸”ä¸ºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è®¾ç½®äº†ä¸€ä¸ªåç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">input</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sep</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">want</span>  <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}{</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;base case&#34;</span><span class="p">,</span> <span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">,</span> <span class="s">&#34;:&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;wrong sep&#34;</span><span class="p">,</span> <span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">,</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;more sep&#34;</span><span class="p">,</span> <span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="s">&#34;bc&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;leading sep&#34;</span><span class="p">,</span> <span class="s">&#34;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&#34;</span><span class="p">,</span> <span class="s">&#34;æ²™&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;æ²³æœ‰&#34;</span><span class="p">,</span> <span class="s">&#34;åˆæœ‰æ²³&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// éå†æµ‹è¯•ç”¨ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tt</span> <span class="o">:=</span> <span class="nx">tt</span>  <span class="c1">// æ³¨æ„è¿™é‡Œé‡æ–°å£°æ˜ttå˜é‡ï¼ˆé¿å…å¤šä¸ªgoroutineä¸­ä½¿ç”¨äº†ç›¸åŒçš„å˜é‡ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ä½¿ç”¨t.Run()æ‰§è¡Œå­æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">t</span><span class="p">.</span><span class="nf">Parallel</span><span class="p">()</span>  <span class="c1">// å°†æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ ‡è®°ä¸ºèƒ½å¤Ÿå½¼æ­¤å¹¶è¡Œè¿è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%#v, got:%#v&#34;</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·æˆ‘ä»¬æ‰§è¡Œ<code>go test -v</code>çš„æ—¶å€™å°±ä¼šçœ‹åˆ°æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¹¶ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œè€Œæ˜¯äº’ç›¸å¹¶è¡Œäº†ã€‚</p>
<h4 id="ä½¿ç”¨å·¥å…·ç”Ÿæˆæµ‹è¯•ä»£ç ">ä½¿ç”¨å·¥å…·ç”Ÿæˆæµ‹è¯•ä»£ç </h4>
<p>ç¤¾åŒºé‡Œæœ‰å¾ˆå¤šè‡ªåŠ¨ç”Ÿæˆè¡¨æ ¼é©±åŠ¨æµ‹è¯•å‡½æ•°çš„å·¥å…·ï¼Œæ¯”å¦‚<a href="https://github.com/cweill/gotests">gotests</a>ç­‰ï¼Œå¾ˆå¤šç¼–è¾‘å™¨å¦‚Golandä¹Ÿæ”¯æŒå¿«é€Ÿç”Ÿæˆæµ‹è¯•æ–‡ä»¶ã€‚è¿™é‡Œç®€å•æ¼”ç¤ºä¸€ä¸‹<code>gotests</code>çš„ä½¿ç”¨ã€‚</p>
<p>å®‰è£…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -u github.com/cweill/gotests/...
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gotests -all -w split.go
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„å‘½ä»¤è¡¨ç¤ºï¼Œä¸º<code>split.go</code>æ–‡ä»¶çš„æ‰€æœ‰å‡½æ•°ç”Ÿæˆæµ‹è¯•ä»£ç è‡³<code>split_test.go</code>æ–‡ä»¶ï¼ˆç›®å½•ä¸‹å¦‚æœäº‹å…ˆå­˜åœ¨è¿™ä¸ªæ–‡ä»¶å°±ä¸å†ç”Ÿæˆï¼‰ã€‚</p>
<p>ç”Ÿæˆçš„æµ‹è¯•ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">base_demo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;reflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;testing&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplit</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">type</span> <span class="nx">args</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">s</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sep</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span>       <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">args</span>       <span class="nx">args</span>
</span></span><span class="line"><span class="cl">		<span class="nx">wantResult</span> <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// TODO: Add test cases.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">gotResult</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">sep</span><span class="p">);</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">gotResult</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">wantResult</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Split() = %v, want %v&#34;</span><span class="p">,</span> <span class="nx">gotResult</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">wantResult</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»£ç æ ¼å¼ä¸æˆ‘ä»¬ä¸Šé¢çš„ç±»ä¼¼ï¼Œåªéœ€è¦åœ¨TODOä½ç½®æ·»åŠ æˆ‘ä»¬çš„æµ‹è¯•é€»è¾‘å°±å¯ä»¥äº†ã€‚</p>
<h3 id="æµ‹è¯•è¦†ç›–ç‡">æµ‹è¯•è¦†ç›–ç‡</h3>
<p>æµ‹è¯•è¦†ç›–ç‡æ˜¯æŒ‡ä»£ç è¢«æµ‹è¯•å¥—ä»¶è¦†ç›–çš„ç™¾åˆ†æ¯”ã€‚é€šå¸¸æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯è¯­å¥çš„è¦†ç›–ç‡ï¼Œä¹Ÿå°±æ˜¯åœ¨æµ‹è¯•ä¸­è‡³å°‘è¢«è¿è¡Œä¸€æ¬¡çš„ä»£ç å æ€»ä»£ç çš„æ¯”ä¾‹ã€‚åœ¨å…¬å¸å†…éƒ¨ä¸€èˆ¬ä¼šè¦æ±‚æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°80%å·¦å³ã€‚</p>
<p>Goæä¾›å†…ç½®åŠŸèƒ½æ¥æ£€æŸ¥ä½ çš„ä»£ç è¦†ç›–ç‡ï¼Œå³ä½¿ç”¨<code>go test -cover</code>æ¥æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span> -cover
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">coverage: 100.0% of statements
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.009s
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹è¦†ç›–äº†100%çš„ä»£ç ã€‚</p>
<p>Goè¿˜æä¾›äº†ä¸€ä¸ªé¢å¤–çš„<code>-coverprofile</code>å‚æ•°ï¼Œç”¨æ¥å°†è¦†ç›–ç‡ç›¸å…³çš„è®°å½•ä¿¡æ¯è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span> -cover -coverprofile<span class="o">=</span>c.out
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">coverage: 100.0% of statements
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.009s
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„å‘½ä»¤ä¼šå°†è¦†ç›–ç‡ç›¸å…³çš„ä¿¡æ¯è¾“å‡ºåˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹é¢çš„<code>c.out</code>æ–‡ä»¶ä¸­ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ tree .
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">â”œâ”€â”€ c.out
</span></span><span class="line"><span class="cl">â”œâ”€â”€ split.go
</span></span><span class="line"><span class="cl">â””â”€â”€ split_test.go
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬æ‰§è¡Œ<code>go tool cover -html=c.out</code>ï¼Œä½¿ç”¨<code>cover</code>å·¥å…·æ¥å¤„ç†ç”Ÿæˆçš„è®°å½•ä¿¡æ¯ï¼Œè¯¥å‘½ä»¤ä¼šæ‰“å¼€æœ¬åœ°çš„æµè§ˆå™¨çª—å£ç”Ÿæˆä¸€ä¸ªHTMLæŠ¥å‘Šã€‚<img src="https://raw.githubusercontent.com/liuhaibin123456789/img-for-cold-bin-blog/master/img/202207161338110.png" alt="Go test cover">ä¸Šå›¾ä¸­æ¯ä¸ªç”¨ç»¿è‰²æ ‡è®°çš„è¯­å¥å—è¡¨ç¤ºè¢«è¦†ç›–äº†ï¼Œè€Œçº¢è‰²çš„è¡¨ç¤ºæ²¡æœ‰è¢«è¦†ç›–ã€‚</p>
<h3 id="testifyassert">testify/assert</h3>
<p><a href="https://github.com/stretchr/testify">testify</a>æ˜¯ä¸€ä¸ªç¤¾åŒºéå¸¸æµè¡Œçš„Goå•å…ƒæµ‹è¯•å·¥å…·åŒ…ï¼Œå…¶ä¸­ä½¿ç”¨æœ€å¤šçš„åŠŸèƒ½å°±æ˜¯å®ƒæä¾›çš„æ–­è¨€å·¥å…·â€”â€”<code>testify/assert</code>æˆ–<code>testify/require</code>ã€‚</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get github.com/stretchr/testify
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h3>
<p>æˆ‘ä»¬åœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨æ–­è¨€æ¥æ ¡éªŒæµ‹è¯•ç»“æœï¼Œä½†æ˜¯ç”±äºGoè¯­è¨€å®˜æ–¹æ²¡æœ‰æä¾›æ–­è¨€ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå†™å‡ºå¾ˆå¤šçš„<code>if...else...</code>è¯­å¥ã€‚è€Œ<code>testify/assert</code>ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šå¸¸ç”¨çš„æ–­è¨€å‡½æ•°ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¾“å‡ºå‹å¥½ã€æ˜“äºé˜…è¯»çš„é”™è¯¯æè¿°ä¿¡æ¯ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨<code>TestSplit</code>æµ‹è¯•å‡½æ•°ä¸­å°±ä½¿ç”¨äº†<code>reflect.DeepEqual</code>æ¥åˆ¤æ–­æœŸæœ›ç»“æœä¸å®é™…ç»“æœæ˜¯å¦ä¸€è‡´ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ä½¿ç”¨t.Run()æ‰§è¡Œå­æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%#v, got:%#v&#34;</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨<code>testify/assert</code>ä¹‹åå°±èƒ½å°†ä¸Šè¿°åˆ¤æ–­è¿‡ç¨‹ç®€åŒ–å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ä½¿ç”¨t.Run()æ‰§è¡Œå­æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span>  <span class="c1">// ä½¿ç”¨assertæä¾›çš„æ–­è¨€å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“æˆ‘ä»¬æœ‰å¤šä¸ªæ–­è¨€è¯­å¥æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>assert := assert.New(t)</code>åˆ›å»ºä¸€ä¸ªassertå¯¹è±¡ï¼Œå®ƒæ‹¥æœ‰å‰é¢æ‰€æœ‰çš„æ–­è¨€æ–¹æ³•ï¼Œåªæ˜¯ä¸éœ€è¦å†ä¼ å…¥<code>Testing.T</code>å‚æ•°äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSomething</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">assert</span> <span class="o">:=</span> <span class="nx">assert</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// assert equality
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="s">&#34;they should be equal&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// assert inequality
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">assert</span><span class="p">.</span><span class="nf">NotEqual</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="s">&#34;they should not be equal&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// assert for nil (good for errors)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">assert</span><span class="p">.</span><span class="nf">Nil</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// assert for not nil (good when you expect something)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="nx">assert</span><span class="p">.</span><span class="nf">NotNil</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// now we know that object isn&#39;t nil, we are safe to make
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// further assertions without causing any errors
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="s">&#34;Something&#34;</span><span class="p">,</span> <span class="nx">object</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>testify/assert</code>æä¾›äº†éå¸¸å¤šçš„æ–­è¨€å‡½æ•°ï¼Œè¿™é‡Œæ²¡åŠæ³•ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥ï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹<a href="https://pkg.go.dev/github.com/stretchr/testify/assert#pkg-functions">å®˜æ–¹æ–‡æ¡£</a>äº†è§£ã€‚</p>
<p><code>testify/require</code>æ‹¥æœ‰<code>testify/assert</code>æ‰€æœ‰æ–­è¨€å‡½æ•°ï¼Œå®ƒä»¬çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯â€”â€”<code>testify/require</code>é‡åˆ°å¤±è´¥çš„ç”¨ä¾‹ä¼šç«‹å³ç»ˆæ­¢æœ¬æ¬¡æµ‹è¯•ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>testify</code>åŒ…è¿˜æä¾›äº†<a href="https://pkg.go.dev/github.com/stretchr/testify/mock">mock</a>ã€<a href="https://pkg.go.dev/github.com/stretchr/testify/http">http</a>ç­‰å…¶ä»–æµ‹è¯•å·¥å…·ã€‚</p>
<h2 id="åŸºå‡†æµ‹è¯•">åŸºå‡†æµ‹è¯•</h2>
<h3 id="åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼">åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼</h3>
<p>åŸºå‡†æµ‹è¯•å°±æ˜¯åœ¨ä¸€å®šçš„å·¥ä½œè´Ÿè½½ä¹‹ä¸‹æ£€æµ‹ç¨‹åºæ€§èƒ½çš„ä¸€ç§æ–¹æ³•ã€‚åŸºå‡†æµ‹è¯•çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkName</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŸºå‡†æµ‹è¯•ä»¥<code>Benchmark</code>ä¸ºå‰ç¼€ï¼Œéœ€è¦ä¸€ä¸ª<code>*testing.B</code>ç±»å‹çš„å‚æ•°bï¼ŒåŸºå‡†æµ‹è¯•å¿…é¡»è¦æ‰§è¡Œ<code>b.N</code>æ¬¡ï¼Œè¿™æ ·çš„æµ‹è¯•æ‰æœ‰å¯¹ç…§æ€§ï¼Œ<code>b.N</code>çš„å€¼æ˜¯ç³»ç»Ÿæ ¹æ®å®é™…æƒ…å†µå»è°ƒæ•´çš„ï¼Œä»è€Œä¿è¯æµ‹è¯•çš„ç¨³å®šæ€§ã€‚ <code>testing.B</code>æ‹¥æœ‰çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Error</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Errorf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Fail</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">FailNow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Failed</span><span class="p">()</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Fatal</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Fatalf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Log</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Logf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Name</span><span class="p">()</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">ReportAllocs</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">ResetTimer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Run</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">f</span> <span class="kd">func</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">))</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">RunParallel</span><span class="p">(</span><span class="nx">body</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">PB</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">SetBytes</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">SetParallelism</span><span class="p">(</span><span class="nx">p</span> <span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Skip</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">SkipNow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Skipf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">Skipped</span><span class="p">()</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">StartTimer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">B</span><span class="p">)</span> <span class="nf">StopTimer</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åŸºå‡†æµ‹è¯•ç¤ºä¾‹">åŸºå‡†æµ‹è¯•ç¤ºä¾‹</h3>
<p>æˆ‘ä»¬ä¸ºsplitåŒ…ä¸­çš„<code>Split</code>å‡½æ•°ç¼–å†™åŸºå‡†æµ‹è¯•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkSplit</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Split</span><span class="p">(</span><span class="s">&#34;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&#34;</span><span class="p">,</span> <span class="s">&#34;æ²™&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŸºå‡†æµ‹è¯•å¹¶ä¸ä¼šé»˜è®¤æ‰§è¡Œï¼Œéœ€è¦å¢åŠ <code>-bench</code>å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ<code>go test -bench=Split</code>å‘½ä»¤æ‰§è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">split $ go <span class="nb">test</span> -bench<span class="o">=</span>Split
</span></span><span class="line"><span class="cl">goos: darwin
</span></span><span class="line"><span class="cl">goarch: amd64
</span></span><span class="line"><span class="cl">pkg: github.com/Q1mi/studygo/code_demo/test_demo/split
</span></span><span class="line"><span class="cl">BenchmarkSplit-8        <span class="m">10000000</span>               <span class="m">203</span> ns/op
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      github.com/Q1mi/studygo/code_demo/test_demo/split       2.255s
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­<code>BenchmarkSplit-8</code>è¡¨ç¤ºå¯¹Splitå‡½æ•°è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œæ•°å­—<code>8</code>è¡¨ç¤º<code>GOMAXPROCS</code>çš„å€¼ï¼Œè¿™ä¸ªå¯¹äºå¹¶å‘åŸºå‡†æµ‹è¯•å¾ˆé‡è¦ã€‚<code>10000000</code>å’Œ<code>203ns/op</code>è¡¨ç¤ºæ¯æ¬¡è°ƒç”¨<code>Split</code>å‡½æ•°è€—æ—¶<code>203ns</code>ï¼Œè¿™ä¸ªç»“æœæ˜¯<code>10000000</code>æ¬¡è°ƒç”¨çš„å¹³å‡å€¼ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºåŸºå‡†æµ‹è¯•æ·»åŠ <code>-benchmem</code>å‚æ•°ï¼Œæ¥è·å¾—å†…å­˜åˆ†é…çš„ç»Ÿè®¡æ•°æ®ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">split $ go <span class="nb">test</span> -bench<span class="o">=</span>Split -benchmem
</span></span><span class="line"><span class="cl">goos: darwin
</span></span><span class="line"><span class="cl">goarch: amd64
</span></span><span class="line"><span class="cl">pkg: github.com/Q1mi/studygo/code_demo/test_demo/split
</span></span><span class="line"><span class="cl">BenchmarkSplit-8        <span class="m">10000000</span>               <span class="m">215</span> ns/op             <span class="m">112</span> B/op          <span class="m">3</span> allocs/op
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      github.com/Q1mi/studygo/code_demo/test_demo/split       2.394s
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>112 B/op</code>è¡¨ç¤ºæ¯æ¬¡æ“ä½œå†…å­˜åˆ†é…äº†112å­—èŠ‚ï¼Œ<code>3 allocs/op</code>åˆ™è¡¨ç¤ºæ¯æ¬¡æ“ä½œè¿›è¡Œäº†3æ¬¡å†…å­˜åˆ†é…ã€‚ æˆ‘ä»¬å°†æˆ‘ä»¬çš„<code>Split</code>å‡½æ•°ä¼˜åŒ–å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">result</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">s</span><span class="p">[:</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="nx">s</span> <span class="p">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="nx">sep</span><span class="p">):]</span> <span class="c1">// è¿™é‡Œä½¿ç”¨len(sep)è·å–sepçš„é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">i</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸€æ¬¡æˆ‘ä»¬æå‰ä½¿ç”¨makeå‡½æ•°å°†resultåˆå§‹åŒ–ä¸ºä¸€ä¸ªå®¹é‡è¶³å¤Ÿå¤§çš„åˆ‡ç‰‡ï¼Œè€Œä¸å†åƒä¹‹å‰ä¸€æ ·é€šè¿‡è°ƒç”¨appendå‡½æ•°æ¥è¿½åŠ ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ”¹è¿›ä¼šå¸¦æ¥å¤šå¤§çš„æ€§èƒ½æå‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">split $ go <span class="nb">test</span> -bench<span class="o">=</span>Split -benchmem
</span></span><span class="line"><span class="cl">goos: darwin
</span></span><span class="line"><span class="cl">goarch: amd64
</span></span><span class="line"><span class="cl">pkg: github.com/Q1mi/studygo/code_demo/test_demo/split
</span></span><span class="line"><span class="cl">BenchmarkSplit-8        <span class="m">10000000</span>               <span class="m">127</span> ns/op              <span class="m">48</span> B/op          <span class="m">1</span> allocs/op
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      github.com/Q1mi/studygo/code_demo/test_demo/split       1.423s
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªä½¿ç”¨makeå‡½æ•°æå‰åˆ†é…å†…å­˜çš„æ”¹åŠ¨ï¼Œå‡å°‘äº†2/3çš„å†…å­˜åˆ†é…æ¬¡æ•°ï¼Œå¹¶ä¸”å‡å°‘äº†ä¸€åŠçš„å†…å­˜åˆ†é…ã€‚</p>
<h3 id="æ€§èƒ½æ¯”è¾ƒå‡½æ•°">æ€§èƒ½æ¯”è¾ƒå‡½æ•°</h3>
<p>ä¸Šé¢çš„åŸºå‡†æµ‹è¯•åªèƒ½å¾—åˆ°ç»™å®šæ“ä½œçš„ç»å¯¹è€—æ—¶ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šæ€§èƒ½é—®é¢˜æ˜¯å‘ç”Ÿåœ¨ä¸¤ä¸ªä¸åŒæ“ä½œä¹‹é—´çš„ç›¸å¯¹è€—æ—¶ï¼Œæ¯”å¦‚åŒä¸€ä¸ªå‡½æ•°å¤„ç†1000ä¸ªå…ƒç´ çš„è€—æ—¶ä¸å¤„ç†1ä¸‡ç”šè‡³100ä¸‡ä¸ªå…ƒç´ çš„è€—æ—¶çš„å·®åˆ«æ˜¯å¤šå°‘ï¼Ÿå†æˆ–è€…å¯¹äºåŒä¸€ä¸ªä»»åŠ¡ç©¶ç«Ÿä½¿ç”¨å“ªç§ç®—æ³•æ€§èƒ½æœ€ä½³ï¼Ÿæˆ‘ä»¬é€šå¸¸éœ€è¦å¯¹ä¸¤ä¸ªä¸åŒç®—æ³•çš„å®ç°ä½¿ç”¨ç›¸åŒçš„è¾“å…¥æ¥è¿›è¡ŒåŸºå‡†æ¯”è¾ƒæµ‹è¯•ã€‚</p>
<p>æ€§èƒ½æ¯”è¾ƒå‡½æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¸¦æœ‰å‚æ•°çš„å‡½æ•°ï¼Œè¢«å¤šä¸ªä¸åŒçš„Benchmarkå‡½æ•°ä¼ å…¥ä¸åŒçš„å€¼æ¥è°ƒç”¨ã€‚ä¸¾ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">benchmark</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">,</span> <span class="nx">size</span> <span class="kt">int</span><span class="p">){</span><span class="cm">/* ... */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Benchmark10</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">){</span> <span class="nf">benchmark</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Benchmark100</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">){</span> <span class="nf">benchmark</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Benchmark1000</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">){</span> <span class="nf">benchmark</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¾‹å¦‚æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// fib.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Fib æ˜¯ä¸€ä¸ªè®¡ç®—ç¬¬nä¸ªæ–æ³¢é‚£å¥‘æ•°çš„å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">Fib</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">n</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">n</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">Fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">Fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç¼–å†™çš„æ€§èƒ½æ¯”è¾ƒå‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// fib_test.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">benchmarkFib</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">,</span> <span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Fib</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkFib1</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>  <span class="p">{</span> <span class="nf">benchmarkFib</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkFib2</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>  <span class="p">{</span> <span class="nf">benchmarkFib</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkFib3</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>  <span class="p">{</span> <span class="nf">benchmarkFib</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkFib10</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span> <span class="nf">benchmarkFib</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkFib20</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span> <span class="nf">benchmarkFib</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkFib40</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span> <span class="nf">benchmarkFib</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">split $ go <span class="nb">test</span> -bench<span class="o">=</span>.
</span></span><span class="line"><span class="cl">goos: darwin
</span></span><span class="line"><span class="cl">goarch: amd64
</span></span><span class="line"><span class="cl">pkg: github.com/Q1mi/studygo/code_demo/test_demo/fib
</span></span><span class="line"><span class="cl">BenchmarkFib1-8         <span class="m">1000000000</span>               2.03 ns/op
</span></span><span class="line"><span class="cl">BenchmarkFib2-8         <span class="m">300000000</span>                5.39 ns/op
</span></span><span class="line"><span class="cl">BenchmarkFib3-8         <span class="m">200000000</span>                9.71 ns/op
</span></span><span class="line"><span class="cl">BenchmarkFib10-8         <span class="m">5000000</span>               <span class="m">325</span> ns/op
</span></span><span class="line"><span class="cl">BenchmarkFib20-8           <span class="m">30000</span>             <span class="m">42460</span> ns/op
</span></span><span class="line"><span class="cl">BenchmarkFib40-8               <span class="m">2</span>         <span class="m">638524980</span> ns/op
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      github.com/Q1mi/studygo/code_demo/test_demo/fib 12.944s
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåŸºå‡†æµ‹è¯•è‡³å°‘è¿è¡Œ1ç§’ã€‚å¦‚æœåœ¨Benchmarkå‡½æ•°è¿”å›æ—¶æ²¡æœ‰åˆ°1ç§’ï¼Œåˆ™<code>b.N</code>çš„å€¼ä¼šæŒ‰1,2,5,10,20,50ï¼Œâ€¦å¢åŠ ï¼Œå¹¶ä¸”å‡½æ•°å†æ¬¡è¿è¡Œã€‚</p>
<p>æœ€ç»ˆçš„<code>BenchmarkFib40</code>åªè¿è¡Œäº†ä¸¤æ¬¡ï¼Œæ¯æ¬¡è¿è¡Œçš„å¹³å‡å€¼åªæœ‰ä¸åˆ°ä¸€ç§’ã€‚åƒè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥å¯ä»¥ä½¿ç”¨<code>-benchtime</code>æ ‡å¿—å¢åŠ æœ€å°åŸºå‡†æ—¶é—´ï¼Œä»¥äº§ç”Ÿæ›´å‡†ç¡®çš„ç»“æœã€‚ï¼ˆå› ä¸ºé»˜è®¤åŸºå‡†æ‰§è¡Œ1s,æ—¶é—´æ²¡åˆ°æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒæ•´ï¼Œé‡æ–°æ‰§è¡Œç›´åˆ°1sï¼Œå¦‚æœæŸä¸ªå‡½æ•°çš„æ‰§è¡Œç”¨æ—¶è¶…è¿‡é»˜è®¤æ‰§è¡Œç”¨æ—¶1sï¼Œå¯èƒ½æ— æ³•å¾—åˆ°è¿”å›ï¼‰ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">split $ go <span class="nb">test</span> -bench<span class="o">=</span>Fib40 -benchtime<span class="o">=</span>20s
</span></span><span class="line"><span class="cl">goos: darwin
</span></span><span class="line"><span class="cl">goarch: amd64
</span></span><span class="line"><span class="cl">pkg: github.com/Q1mi/studygo/code_demo/test_demo/fib
</span></span><span class="line"><span class="cl">BenchmarkFib40-8              <span class="m">50</span>         <span class="m">663205114</span> ns/op
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      github.com/Q1mi/studygo/code_demo/test_demo/fib 33.849s
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸€æ¬¡<code>BenchmarkFib40</code>å‡½æ•°è¿è¡Œäº†50æ¬¡ï¼Œç»“æœå°±ä¼šæ›´å‡†ç¡®ä¸€äº›äº†ã€‚</p>
<p>ä½¿ç”¨æ€§èƒ½æ¯”è¾ƒå‡½æ•°åšæµ‹è¯•çš„æ—¶å€™ä¸€ä¸ªå®¹æ˜“çŠ¯çš„é”™è¯¯å°±æ˜¯æŠŠ<code>b.N</code>ä½œä¸ºè¾“å…¥çš„å¤§å°ï¼Œä¾‹å¦‚ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­éƒ½æ˜¯é”™è¯¯çš„ç¤ºèŒƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// é”™è¯¯ç¤ºèŒƒ1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">BenchmarkFibWrong</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">n</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">n</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Fib</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é”™è¯¯ç¤ºèŒƒ2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">BenchmarkFibWrong2</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Fib</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é‡ç½®æ—¶é—´">é‡ç½®æ—¶é—´</h3>
<p><code>b.ResetTimer</code>ä¹‹å‰çš„å¤„ç†ä¸ä¼šæ”¾åˆ°æ‰§è¡Œæ—¶é—´é‡Œï¼Œä¹Ÿä¸ä¼šè¾“å‡ºåˆ°æŠ¥å‘Šä¸­ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¹‹å‰åšä¸€äº›ä¸è®¡åˆ’ä½œä¸ºæµ‹è¯•æŠ¥å‘Šçš„æ“ä½œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkSplit</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span> <span class="c1">// å‡è®¾éœ€è¦åšä¸€äº›è€—æ—¶çš„æ— å…³æ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>              <span class="c1">// é‡ç½®è®¡æ—¶å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Split</span><span class="p">(</span><span class="s">&#34;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&#34;</span><span class="p">,</span> <span class="s">&#34;æ²™&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¹¶è¡Œæµ‹è¯•-1">å¹¶è¡Œæµ‹è¯•</h3>
<p><code>func (b *B) RunParallel(body func(*PB))</code>ä¼šä»¥å¹¶è¡Œçš„æ–¹å¼æ‰§è¡Œç»™å®šçš„åŸºå‡†æµ‹è¯•ã€‚</p>
<p><code>RunParallel</code>ä¼šåˆ›å»ºå‡ºå¤šä¸ª<code>goroutine</code>ï¼Œå¹¶å°†<code>b.N</code>åˆ†é…ç»™è¿™äº›<code>goroutine</code>æ‰§è¡Œï¼Œ å…¶ä¸­<code>goroutine</code>æ•°é‡çš„é»˜è®¤å€¼ä¸º<code>GOMAXPROCS</code>ã€‚ç”¨æˆ·å¦‚æœæƒ³è¦å¢åŠ éCPUå—é™ï¼ˆnon-CPU-boundï¼‰åŸºå‡†æµ‹è¯•çš„å¹¶è¡Œæ€§ï¼Œ é‚£ä¹ˆå¯ä»¥åœ¨<code>RunParallel</code>ä¹‹å‰è°ƒç”¨<code>SetParallelism</code> ã€‚<code>RunParallel</code>é€šå¸¸ä¼šä¸<code>-cpu</code>æ ‡å¿—ä¸€åŒä½¿ç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkSplitParallel</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// b.SetParallelism(1) // è®¾ç½®ä½¿ç”¨çš„CPUæ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">b</span><span class="p">.</span><span class="nf">RunParallel</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pb</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">PB</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">Split</span><span class="p">(</span><span class="s">&#34;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&#34;</span><span class="p">,</span> <span class="s">&#34;æ²™&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä¸€ä¸‹åŸºå‡†æµ‹è¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">split $ go <span class="nb">test</span> -bench<span class="o">=</span>.
</span></span><span class="line"><span class="cl">goos: darwin
</span></span><span class="line"><span class="cl">goarch: amd64
</span></span><span class="line"><span class="cl">pkg: github.com/Q1mi/studygo/code_demo/test_demo/split
</span></span><span class="line"><span class="cl">BenchmarkSplit-8                <span class="m">10000000</span>               <span class="m">131</span> ns/op
</span></span><span class="line"><span class="cl">BenchmarkSplitParallel-8        <span class="m">50000000</span>                36.1 ns/op
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      github.com/Q1mi/studygo/code_demo/test_demo/split       3.308s
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿˜å¯ä»¥é€šè¿‡åœ¨æµ‹è¯•å‘½ä»¤åæ·»åŠ <code>-cpu</code>å‚æ•°å¦‚<code>go test -bench=. -cpu 1</code>æ¥æŒ‡å®šä½¿ç”¨çš„CPUæ•°é‡ã€‚</p>
<h2 id="setupä¸teardown"><code>Setup</code>ä¸<code>TearDown</code></h2>
<p>æµ‹è¯•ç¨‹åºæœ‰æ—¶éœ€è¦åœ¨æµ‹è¯•ä¹‹å‰è¿›è¡Œé¢å¤–çš„è®¾ç½®ï¼ˆsetupï¼‰æˆ–åœ¨æµ‹è¯•ä¹‹åè¿›è¡Œæ‹†å¸ï¼ˆteardownï¼‰ã€‚</p>
<h3 id="testmain"><code>TestMain</code></h3>
<p>é€šè¿‡åœ¨<code>*_test.go</code>æ–‡ä»¶ä¸­å®šä¹‰<code>TestMain</code>å‡½æ•°æ¥å¯ä»¥åœ¨æµ‹è¯•ä¹‹å‰è¿›è¡Œé¢å¤–çš„è®¾ç½®ï¼ˆsetupï¼‰æˆ–åœ¨æµ‹è¯•ä¹‹åè¿›è¡Œæ‹†å¸ï¼ˆteardownï¼‰æ“ä½œã€‚</p>
<p>å¦‚æœæµ‹è¯•æ–‡ä»¶åŒ…å«å‡½æ•°:<code>func TestMain(m *testing.M)</code>é‚£ä¹ˆç”Ÿæˆçš„æµ‹è¯•ä¼šå…ˆè°ƒç”¨ TestMain(m)ï¼Œç„¶åå†è¿è¡Œå…·ä½“æµ‹è¯•ã€‚<code>TestMain</code>è¿è¡Œåœ¨ä¸»<code>goroutine</code>ä¸­, å¯ä»¥åœ¨è°ƒç”¨ <code>m.Run</code>å‰ååšä»»ä½•è®¾ç½®ï¼ˆsetupï¼‰å’Œæ‹†å¸ï¼ˆteardownï¼‰ã€‚é€€å‡ºæµ‹è¯•çš„æ—¶å€™åº”è¯¥ä½¿ç”¨<code>m.Run</code>çš„è¿”å›å€¼ä½œä¸ºå‚æ•°è°ƒç”¨<code>os.Exit</code>ã€‚</p>
<p>ä¸€ä¸ªä½¿ç”¨<code>TestMain</code>æ¥è®¾ç½®Setupå’ŒTearDownçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestMain</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">M</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;write setup code here...&#34;</span><span class="p">)</span> <span class="c1">// æµ‹è¯•ä¹‹å‰çš„åšä¸€äº›è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// å¦‚æœ TestMain ä½¿ç”¨äº† flagsï¼Œè¿™é‡Œåº”è¯¥åŠ ä¸Šflag.Parse()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">retCode</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span>                         <span class="c1">// æ‰§è¡Œæµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;write teardown code here...&#34;</span><span class="p">)</span> <span class="c1">// æµ‹è¯•ä¹‹ååšä¸€äº›æ‹†å¸å·¥ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="nx">retCode</span><span class="p">)</span>                           <span class="c1">// é€€å‡ºæµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨è°ƒç”¨<code>TestMain</code>æ—¶, <code>flag.Parse</code>å¹¶æ²¡æœ‰è¢«è°ƒç”¨ã€‚æ‰€ä»¥å¦‚æœ<code>TestMain</code> ä¾èµ–äºcommand-lineæ ‡å¿— (åŒ…æ‹¬ testing åŒ…çš„æ ‡è®°), åˆ™åº”è¯¥æ˜¾ç¤ºçš„è°ƒç”¨<code>flag.Parse</code>ã€‚</p>
<h3 id="å­æµ‹è¯•çš„setupä¸teardown">å­æµ‹è¯•çš„Setupä¸Teardown</h3>
<p>æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªæµ‹è¯•é›†è®¾ç½®Setupä¸Teardownï¼Œä¹Ÿæœ‰å¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªå­æµ‹è¯•è®¾ç½®Setupä¸Teardownã€‚ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå‡½æ•°å·¥å…·å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// æµ‹è¯•é›†çš„Setupä¸Teardown
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">setupTestCase</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">&#34;å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:æµ‹è¯•ä¹‹å‰çš„setup&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">&#34;å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:æµ‹è¯•ä¹‹åçš„teardown&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å­æµ‹è¯•çš„Setupä¸Teardown
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">setupSubTest</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">&#34;å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">&#34;å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplit</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">type</span> <span class="nx">test</span> <span class="kd">struct</span> <span class="p">{</span> <span class="c1">// å®šä¹‰testç»“æ„ä½“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">input</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sep</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">want</span>  <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tests</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">test</span><span class="p">{</span> <span class="c1">// æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨mapå­˜å‚¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="s">&#34;simple&#34;</span><span class="p">:</span>      <span class="p">{</span><span class="nx">input</span><span class="p">:</span> <span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">,</span> <span class="nx">sep</span><span class="p">:</span> <span class="s">&#34;:&#34;</span><span class="p">,</span> <span class="nx">want</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;wrong sep&#34;</span><span class="p">:</span>   <span class="p">{</span><span class="nx">input</span><span class="p">:</span> <span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">,</span> <span class="nx">sep</span><span class="p">:</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="nx">want</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;more sep&#34;</span><span class="p">:</span>    <span class="p">{</span><span class="nx">input</span><span class="p">:</span> <span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="nx">sep</span><span class="p">:</span> <span class="s">&#34;bc&#34;</span><span class="p">,</span> <span class="nx">want</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;leading sep&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nx">input</span><span class="p">:</span> <span class="s">&#34;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&#34;</span><span class="p">,</span> <span class="nx">sep</span><span class="p">:</span> <span class="s">&#34;æ²™&#34;</span><span class="p">,</span> <span class="nx">want</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;æ²³æœ‰&#34;</span><span class="p">,</span> <span class="s">&#34;åˆæœ‰æ²³&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">teardownTestCase</span> <span class="o">:=</span> <span class="nf">setupTestCase</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="c1">// æµ‹è¯•ä¹‹å‰æ‰§è¡Œsetupæ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">defer</span> <span class="nf">teardownTestCase</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>            <span class="c1">// æµ‹è¯•ä¹‹åæ‰§è¡Œtestdoenæ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">tc</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ä½¿ç”¨t.Run()æ‰§è¡Œå­æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">teardownSubTest</span> <span class="o">:=</span> <span class="nf">setupSubTest</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="c1">// å­æµ‹è¯•ä¹‹å‰æ‰§è¡Œsetupæ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">defer</span> <span class="nf">teardownSubTest</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>           <span class="c1">// æµ‹è¯•ä¹‹åæ‰§è¡Œtestdoenæ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%#v, got:%#v&#34;</span><span class="p">,</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">split $ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   <span class="nv">TestSplit</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit/simple
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit/wrong_sep
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit/more_sep
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit/leading_sep
</span></span><span class="line"><span class="cl">--- PASS: TestSplit <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    split_test.go:71: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:æµ‹è¯•ä¹‹å‰çš„setup
</span></span><span class="line"><span class="cl">    --- PASS: TestSplit/simple <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">        split_test.go:79: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup
</span></span><span class="line"><span class="cl">        split_test.go:81: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown
</span></span><span class="line"><span class="cl">    --- PASS: TestSplit/wrong_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">        split_test.go:79: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup
</span></span><span class="line"><span class="cl">        split_test.go:81: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown
</span></span><span class="line"><span class="cl">    --- PASS: TestSplit/more_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">        split_test.go:79: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup
</span></span><span class="line"><span class="cl">        split_test.go:81: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown
</span></span><span class="line"><span class="cl">    --- PASS: TestSplit/leading_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">        split_test.go:79: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup
</span></span><span class="line"><span class="cl">        split_test.go:81: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown
</span></span><span class="line"><span class="cl">    split_test.go:73: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:æµ‹è¯•ä¹‹åçš„teardown
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   ExampleSplit
</span></span><span class="line"><span class="cl">--- PASS: ExampleSplit <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç¤ºä¾‹å‡½æ•°">ç¤ºä¾‹å‡½æ•°</h2>
<h3 id="ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼">ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼</h3>
<p>è¢«<code>go test</code>ç‰¹æ®Šå¯¹å¾…çš„ç¬¬ä¸‰ç§å‡½æ•°å°±æ˜¯ç¤ºä¾‹å‡½æ•°ï¼Œå®ƒä»¬çš„å‡½æ•°åä»¥<code>Example</code>ä¸ºå‰ç¼€ã€‚å®ƒä»¬æ—¢æ²¡æœ‰å‚æ•°ä¹Ÿæ²¡æœ‰è¿”å›å€¼ã€‚æ ‡å‡†æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ExampleName</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹">ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹</h3>
<p>ä¸‹é¢çš„ä»£ç æ˜¯æˆ‘ä»¬ä¸º<code>Split</code>å‡½æ•°ç¼–å†™çš„ä¸€ä¸ªç¤ºä¾‹å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ExampleSplit</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">split</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="s">&#34;ağŸ…±ï¸c&#34;</span><span class="p">,</span> <span class="s">&#34;:&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">split</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="s">&#34;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&#34;</span><span class="p">,</span> <span class="s">&#34;æ²™&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Output:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// [a b c]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// [ æ²³æœ‰ åˆæœ‰æ²³]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºä½ çš„ä»£ç ç¼–å†™ç¤ºä¾‹ä»£ç æœ‰å¦‚ä¸‹ä¸‰ä¸ªç”¨å¤„ï¼š</p>
<ol>
<li>
<p>ç¤ºä¾‹å‡½æ•°èƒ½å¤Ÿä½œä¸ºæ–‡æ¡£ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚åŸºäºwebçš„godocä¸­èƒ½æŠŠç¤ºä¾‹å‡½æ•°ä¸å¯¹åº”çš„å‡½æ•°æˆ–åŒ…ç›¸å…³è”ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹å‡½æ•°åªè¦åŒ…å«äº†<code>// Output:</code>ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡<code>go test</code>è¿è¡Œçš„å¯æ‰§è¡Œæµ‹è¯•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">split $ go <span class="nb">test</span> -run Example
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ç¤ºä¾‹å‡½æ•°æä¾›äº†å¯ä»¥ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ï¼Œå¯ä»¥ç›´æ¥åœ¨<code>golang.org</code>çš„<code>godoc</code>æ–‡æ¡£æœåŠ¡å™¨ä¸Šä½¿ç”¨<code>Go Playground</code>è¿è¡Œç¤ºä¾‹ä»£ç ã€‚ä¸‹å›¾ä¸º<code>strings.ToUpper</code>å‡½æ•°åœ¨Playgroundçš„ç¤ºä¾‹å‡½æ•°æ•ˆæœã€‚</p>
<p><img src="https://raw.githubusercontent.com/liuhaibin123456789/img-for-cold-bin-blog/master/img/202207161339940.png" alt="Go Playground"></p>
</li>
</ol>
<h1 id="äºŒç½‘ç»œæµ‹è¯•">äºŒã€ç½‘ç»œæµ‹è¯•</h1>
<h2 id="httptest"><code>httptest</code></h2>
<p>åœ¨Webå¼€å‘åœºæ™¯ä¸‹çš„å•å…ƒæµ‹è¯•ï¼Œå¦‚æœæ¶‰åŠåˆ°HTTPè¯·æ±‚æ¨èå¤§å®¶ä½¿ç”¨Goæ ‡å‡†åº“ <code>net/http/httptest</code> è¿›è¡Œæµ‹è¯•ï¼Œèƒ½å¤Ÿæ˜¾è‘—æé«˜æµ‹è¯•æ•ˆç‡ã€‚</p>
<p>åœ¨è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬ä»¥å¸¸è§çš„ginæ¡†æ¶ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä¸ºhttp serverç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘æ˜¯æ­å»ºä¸€ä¸ªhttp serverç«¯ï¼Œå¯¹å¤–æä¾›HTTPæœåŠ¡ã€‚æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ª<code>helloHandler</code>å‡½æ•°ï¼Œç”¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// gin.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">package</span> <span class="nx">httptest_demo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Param è¯·æ±‚å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Param</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`json:&#34;name&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// helloHandler /helloè¯·æ±‚å¤„ç†å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">helloHandler</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">p</span> <span class="nx">Param</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">ShouldBindJSON</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">p</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="s">&#34;we need a name&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;hello %s&#34;</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Name</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// SetupRouter è·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">SetupRouter</span><span class="p">()</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Engine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">router</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">router</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="nx">helloHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">router</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸º<code>helloHandler</code>å‡½æ•°ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>httptest</code>è¿™ä¸ªå·¥å…·mockä¸€ä¸ªHTTPè¯·æ±‚å’Œå“åº”è®°å½•å™¨ï¼Œè®©æˆ‘ä»¬çš„serverç«¯æ¥æ”¶å¹¶å¤„ç†æˆ‘ä»¬mockçš„HTTPè¯·æ±‚ï¼ŒåŒæ—¶ä½¿ç”¨å“åº”è®°å½•å™¨æ¥è®°å½•serverç«¯è¿”å›çš„å“åº”å†…å®¹ã€‚</p>
<p>å•å…ƒæµ‹è¯•çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// gin_test.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">package</span> <span class="nx">httptest_demo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;encoding/json&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http/httptest&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;testing&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/stretchr/testify/assert&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Test_helloHandler</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">param</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">expect</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}{</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;base case&#34;</span><span class="p">,</span> <span class="s">`{&#34;name&#34;: &#34;liwenzhou&#34;}`</span><span class="p">,</span> <span class="s">&#34;hello liwenzhou&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;bad case&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;we need a name&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nf">SetupRouter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// mockä¸€ä¸ªHTTPè¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">req</span> <span class="o">:=</span> <span class="nx">httptest</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">				<span class="s">&#34;POST&#34;</span><span class="p">,</span>                      <span class="c1">// è¯·æ±‚æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="s">&#34;/hello&#34;</span><span class="p">,</span>                    <span class="c1">// è¯·æ±‚URL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">param</span><span class="p">),</span> <span class="c1">// è¯·æ±‚å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// mockä¸€ä¸ªå“åº”è®°å½•å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">w</span> <span class="o">:=</span> <span class="nx">httptest</span><span class="p">.</span><span class="nf">NewRecorder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// è®©serverç«¯å¤„ç†mockè¯·æ±‚å¹¶è®°å½•è¿”å›çš„å“åº”å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">r</span><span class="p">.</span><span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// æ ¡éªŒçŠ¶æ€ç æ˜¯å¦ç¬¦åˆé¢„æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// è§£æå¹¶æ£€éªŒå“åº”å†…å®¹æ˜¯å¦å¤åˆé¢„æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="kd">var</span> <span class="nx">resp</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">			<span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">String</span><span class="p">()),</span> <span class="o">&amp;</span><span class="nx">resp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">assert</span><span class="p">.</span><span class="nf">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">expect</span><span class="p">,</span> <span class="nx">resp</span><span class="p">[</span><span class="s">&#34;msg&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼ŒæŸ¥çœ‹æµ‹è¯•ç»“æœã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   Test_helloHandler
</span></span><span class="line"><span class="cl"><span class="o">[</span>GIN-debug<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> Creating an Engine instance with the Logger and Recovery middleware already attached.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>GIN-debug<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> Running in <span class="s2">&#34;debug&#34;</span> mode. Switch to <span class="s2">&#34;release&#34;</span> mode in production.
</span></span><span class="line"><span class="cl"> - using env:   <span class="nb">export</span> <span class="nv">GIN_MODE</span><span class="o">=</span>release
</span></span><span class="line"><span class="cl"> - using code:  gin.SetMode<span class="o">(</span>gin.ReleaseMode<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>GIN-debug<span class="o">]</span> POST   /hello                    --&gt; golang-unit-test-demo/httptest_demo.helloHandler <span class="o">(</span><span class="m">3</span> handlers<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   Test_helloHandler/base_case
</span></span><span class="line"><span class="cl"><span class="o">[</span>GIN<span class="o">]</span> 2021/09/14 - 22:00:04 <span class="p">|</span> <span class="m">200</span> <span class="p">|</span>     164.839Âµs <span class="p">|</span>       192.0.2.1 <span class="p">|</span> POST     <span class="s2">&#34;/hello&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   Test_helloHandler/bad_case
</span></span><span class="line"><span class="cl"><span class="o">[</span>GIN<span class="o">]</span> 2021/09/14 - 22:00:04 <span class="p">|</span> <span class="m">200</span> <span class="p">|</span>      23.723Âµs <span class="p">|</span>       192.0.2.1 <span class="p">|</span> POST     <span class="s2">&#34;/hello&#34;</span>
</span></span><span class="line"><span class="cl">--- PASS: Test_helloHandler <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: Test_helloHandler/base_case <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: Test_helloHandler/bad_case <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/httptest_demo     0.055s
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡è¿™ä¸ªç¤ºä¾‹æˆ‘ä»¬å°±æŒæ¡äº†å¦‚ä½•ä½¿ç”¨httpteståœ¨HTTP ServeræœåŠ¡ä¸­ä¸ºè¯·æ±‚å¤„ç†å‡½æ•°ç¼–å†™å•å…ƒæµ‹è¯•äº†ã€‚</p>
<h2 id="gock"><code>gock</code></h2>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä»‹ç»äº†å¦‚ä½•åœ¨HTTP ServeræœåŠ¡ç±»åœºæ™¯ä¸‹ä¸ºè¯·æ±‚å¤„ç†å‡½æ•°ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ˜¯åœ¨ä»£ç ä¸­è¯·æ±‚å¤–éƒ¨APIçš„åœºæ™¯ï¼ˆæ¯”å¦‚é€šè¿‡APIè°ƒç”¨å…¶ä»–æœåŠ¡è·å–è¿”å›å€¼ï¼‰åˆè¯¥æ€ä¹ˆç¼–å†™å•å…ƒæµ‹è¯•å‘¢ï¼Ÿ</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œä¾èµ–å¤–éƒ¨APIï¼š<code>http://your-api.com/post</code>æä¾›çš„æ•°æ®ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// api.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ReqParam APIè¯·æ±‚å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">ReqParam</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">X</span> <span class="kt">int</span> <span class="s">`json:&#34;x&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Result APIè¿”å›ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Result</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Value</span> <span class="kt">int</span> <span class="s">`json:&#34;value&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">GetResultByAPI</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">ReqParam</span><span class="p">{</span><span class="nx">X</span><span class="p">:</span> <span class="nx">x</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">b</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è°ƒç”¨å…¶ä»–æœåŠ¡çš„API
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;http://your-api.com/post&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">bytes</span><span class="p">.</span><span class="nf">NewBuffer</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">body</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">ret</span> <span class="nx">Result</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">ret</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è¿™é‡Œæ˜¯å¯¹APIè¿”å›çš„æ•°æ®åšä¸€äº›é€»è¾‘å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">Value</span> <span class="o">+</span> <span class="nx">y</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¯¹ç±»ä¼¼ä¸Šè¿°è¿™ç±»ä¸šåŠ¡ä»£ç ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¦‚æœä¸æƒ³åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­çœŸæ­£å»å‘é€è¯·æ±‚æˆ–è€…ä¾èµ–çš„å¤–éƒ¨æ¥å£è¿˜æ²¡æœ‰å¼€å‘å®Œæˆæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å•å…ƒæµ‹è¯•ä¸­å¯¹ä¾èµ–çš„APIè¿›è¡Œmockã€‚</p>
<p>è¿™é‡Œæ¨èä½¿ç”¨<a href="https://github.com/h2non/gock">gock</a>è¿™ä¸ªåº“ã€‚</p>
<h3 id="å®‰è£…-1">å®‰è£…</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -u gopkg.in/h2non/gock.v1
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä½¿ç”¨ç¤ºä¾‹-1">ä½¿ç”¨ç¤ºä¾‹</h3>
<p>ä½¿ç”¨<code>gock</code>å¯¹å¤–éƒ¨APIè¿›è¡Œmockï¼Œå³mockæŒ‡å®šå‚æ•°è¿”å›çº¦å®šå¥½çš„å“åº”å†…å®¹ã€‚ ä¸‹é¢çš„ä»£ç ä¸­mockäº†ä¸¤ç»„æ•°æ®ï¼Œç»„æˆäº†ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// api_test.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">package</span> <span class="nx">gock_demo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;testing&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/stretchr/testify/assert&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;gopkg.in/h2non/gock.v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestGetResultByAPI</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">gock</span><span class="p">.</span><span class="nf">Off</span><span class="p">()</span> <span class="c1">// æµ‹è¯•æ‰§è¡Œååˆ·æ–°æŒ‚èµ·çš„mock
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// mock è¯·æ±‚å¤–éƒ¨apiæ—¶ä¼ å‚x=1è¿”å›100
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">gock</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;http://your-api.com&#34;</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Post</span><span class="p">(</span><span class="s">&#34;/post&#34;</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">MatchType</span><span class="p">(</span><span class="s">&#34;json&#34;</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">JSON</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">&#34;x&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Reply</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">JSON</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">&#34;value&#34;</span><span class="p">:</span> <span class="mi">100</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è°ƒç”¨æˆ‘ä»¬çš„ä¸šåŠ¡å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">res</span> <span class="o">:=</span> <span class="nf">GetResultByAPI</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ ¡éªŒè¿”å›ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// mock è¯·æ±‚å¤–éƒ¨apiæ—¶ä¼ å‚x=2è¿”å›200
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">gock</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;http://your-api.com&#34;</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Post</span><span class="p">(</span><span class="s">&#34;/post&#34;</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">MatchType</span><span class="p">(</span><span class="s">&#34;json&#34;</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">JSON</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">&#34;x&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Reply</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">JSON</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">&#34;value&#34;</span><span class="p">:</span> <span class="mi">200</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è°ƒç”¨æˆ‘ä»¬çš„ä¸šåŠ¡å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">res</span> <span class="p">=</span> <span class="nf">GetResultByAPI</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ ¡éªŒè¿”å›ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="mi">202</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">assert</span><span class="p">.</span><span class="nf">True</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">gock</span><span class="p">.</span><span class="nf">IsDone</span><span class="p">())</span> <span class="c1">// æ–­è¨€mockè¢«è§¦å‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä¸Šé¢å†™å¥½çš„å•å…ƒæµ‹è¯•ï¼Œçœ‹ä¸€ä¸‹æµ‹è¯•ç»“æœã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestGetResultByAPI
</span></span><span class="line"><span class="cl">--- PASS: TestGetResultByAPI <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/gock_demo 0.054s
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ç»“æœå’Œé¢„æœŸçš„å®Œå…¨ä¸€è‡´ã€‚</p>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¸ºäº†è®©å¤§å®¶èƒ½å¤Ÿæ¸…æ™°çš„äº†è§£<code>gock</code>çš„ä½¿ç”¨ï¼Œæˆ‘ç‰¹æ„æ²¡æœ‰ä½¿ç”¨è¡¨æ ¼é©±åŠ¨æµ‹è¯•ã€‚ç»™å¤§å®¶ç•™ä¸€ä¸ªå°ä½œä¸šï¼šè‡ªå·±åŠ¨æ‰‹æŠŠè¿™ä¸ªå•å…ƒæµ‹è¯•æ”¹å†™æˆè¡¨æ ¼é©±åŠ¨æµ‹è¯•çš„é£æ ¼ï¼Œå°±å½“åšæ˜¯å¯¹æœ€è¿‘ä¸¤ç¯‡æ•™ç¨‹çš„å¤ä¹ å’Œæµ‹éªŒã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨æ—¥å¸¸å·¥ä½œå¼€å‘ä¸­ä¸ºä»£ç ç¼–å†™å•å…ƒæµ‹è¯•æ—¶å¦‚ä½•å¤„ç†å¤–éƒ¨ä¾èµ–æ˜¯æœ€å¸¸è§çš„é—®é¢˜ï¼Œæœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨<code>httptest</code>å’Œ<code>gock</code>å·¥å…·mockç›¸å…³ä¾èµ–ã€‚ åœ¨ä¸‹ä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬å°†æ›´è¿›ä¸€æ­¥ï¼Œè¯¦ç»†ä»‹ç»é’ˆå¯¹ä¾èµ–MySQLå’ŒRedisçš„åœºæ™¯å¦‚ä½•ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">cold-bin</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2022-07-07
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">å•å…ƒæµ‹è¯•</a>
          <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</a>
          <a href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%8B%E8%AF%95/">ç½‘ç»œæµ‹è¯•</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/api%E5%90%91%E5%89%8D%E5%85%BC%E5%AE%B9%E6%80%A7%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">APIå‘å‰å…¼å®¹æ€§çš„è§£å†³æ–¹æ¡ˆ</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95java%E7%89%88/">
            <span class="next-text nav-default">æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼ˆjavaç‰ˆï¼‰</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2022-07-07 17:46:37 \u002b0800 CST',
        title: 'Goæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–',
        clientID: 'a19ac21c453d44aaaa57',
        clientSecret: '6b740fcf1281b868b86bb30a974a5ed8db33dbf1',
        repo: 'blog-comment',
        owner: 'cold-bin',
        admin: ['cold-bin'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

  

  

      </div>
    </main>
	

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:cold-bin@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/cold-bin" class="iconfont icon-github" title="github"></a>
      <a href="https://space.bilibili.com/248959839" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://cold-bin.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡ </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> æœ¬ç«™æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> äºº </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>cold-bin</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top" title="å›åˆ°é¡¶éƒ¨">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.6.4.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>












<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>

<script id="baidu_analytics">
	  var _hmt = _hmt || [];
	  (function() {
		if (window.location.hostname === 'localhost') return;
		var hm = document.createElement("script"); hm.async = true;
		hm.src = "https://hm.baidu.com/hm.js?cabc0a71f63da092412d82d1aefe7d1c";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	  })();
	</script>


	<script id="baidu_push">
	  (function(){
		if (window.location.hostname === 'localhost') return;
		var bp = document.createElement('script'); bp.async = true;
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
		  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
		  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	  })();
	</script>


<script>
  function createCopyButton(highlightDiv) {
    const div = document.createElement("div");
    div.className = "copy-code";
    div.innerText = "Copy";
    div.addEventListener("click", () =>
      copyCodeToClipboard(div, highlightDiv)
    );
    addCopyButtonToDom(div, highlightDiv);
  }

  async function copyCodeToClipboard(button, highlightDiv) {
    const codeToCopy = highlightDiv.querySelector(":last-child > .chroma > code")
      .innerText;
    await navigator.clipboard.writeText(codeToCopy);
    button.blur();
    button.innerText = "Copied!";
    setTimeout(() => button.innerText = "Copy", 2000);
  }

  function addCopyButtonToDom(button, highlightDiv) {
    highlightDiv.insertBefore(button, highlightDiv.firstChild);
    const wrapper = document.createElement("div");
    wrapper.className = "highlight-wrapper";
    highlightDiv.parentNode.insertBefore(wrapper, highlightDiv);
    wrapper.appendChild(highlightDiv);
  }

  var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  if(!isMobile){
     document.querySelectorAll(".highlight").forEach((highlightDiv) => createCopyButton(highlightDiv));
  }
</script>  


</body>
</html>
