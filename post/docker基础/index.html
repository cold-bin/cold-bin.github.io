<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Docker基础 - cold bin&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="cold-bin" /><meta name="description" content="Docker基础篇之快速上手 第一章 Docker简介 是什么？ 问题：为什么会有 docker 的出现 一款产 品从开发到上线，从操作系统，到运行环境，再到应用配置" />






<meta name="generator" content="Hugo 0.120.3 with theme even" />


<link rel="canonical" href="https://cold-bin.github.io/post/docker%E5%9F%BA%E7%A1%80/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.f7f4d73c43a767e434997279164764c32c7f0f3b1ec88bfb5bfc297b77fd7e7a.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Docker基础" />
<meta property="og:description" content="Docker基础篇之快速上手 第一章 Docker简介 是什么？ 问题：为什么会有 docker 的出现 一款产 品从开发到上线，从操作系统，到运行环境，再到应用配置" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cold-bin.github.io/post/docker%E5%9F%BA%E7%A1%80/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-01-10T19:45:16+08:00" />
<meta property="article:modified_time" content="2023-01-10T19:45:16+08:00" />

<meta itemprop="name" content="Docker基础">
<meta itemprop="description" content="Docker基础篇之快速上手 第一章 Docker简介 是什么？ 问题：为什么会有 docker 的出现 一款产 品从开发到上线，从操作系统，到运行环境，再到应用配置"><meta itemprop="datePublished" content="2023-01-10T19:45:16+08:00" />
<meta itemprop="dateModified" content="2023-01-10T19:45:16+08:00" />
<meta itemprop="wordCount" content="28083">
<meta itemprop="keywords" content="docker,dockerfile," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker基础"/>
<meta name="twitter:description" content="Docker基础篇之快速上手 第一章 Docker简介 是什么？ 问题：为什么会有 docker 的出现 一款产 品从开发到上线，从操作系统，到运行环境，再到应用配置"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>

  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">cold bin&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/links/">
        <li class="mobile-menu-item">Links</li>
      </a><a href="/search/">
        <li class="mobile-menu-item">Search</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">cold bin&#39;s blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/links/">Links</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/search/">Search</a>
      </li>
  </ul>
</nav>

    </header>

    
    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Docker基础</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-01-10 </span>
        <div class="post-category">
            <a href="/categories/docker/"> docker </a>
            </div>
          <span class="more-meta"> 约 28083 字 </span>
          <span class="more-meta"> 预计阅读 57 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#docker基础篇之快速上手">Docker基础篇之快速上手</a></li>
    <li><a href="#第一章-docker简介">第一章 Docker简介</a>
      <ul>
        <li>
          <ul>
            <li><a href="#是什么">是什么？</a></li>
            <li><a href="#能干嘛">能干嘛</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第二章-docker安装">第二章 Docker安装</a>
      <ul>
        <li>
          <ul>
            <li><a href="#前提说明">前提说明</a></li>
            <li><a href="#docker-的基本组成">Docker 的基本组成</a></li>
            <li><a href="#安装步骤">安装步骤</a></li>
            <li><a href="#永远的helloworld">永远的helloworld</a></li>
            <li><a href="#底层原理">底层原理</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第三章-docker常用命令">第三章 Docker常用命令</a>
      <ul>
        <li>
          <ul>
            <li><a href="#帮助命令">帮助命令</a></li>
            <li><a href="#镜像命令">镜像命令</a></li>
            <li><a href="#容器命令">容器命令</a></li>
            <li><a href="#重要">重要</a></li>
            <li><a href="#小总结">小总结</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第-四-章-docker-镜像">第 四 章 Docker 镜像</a>
      <ul>
        <li><a href="#是什么-1">是什么</a>
          <ul>
            <li><a href="#unionfs联合文件系统">UnionFS(联合文件系统)</a></li>
            <li><a href="#docker镜像加载原理">Docker镜像加载原理</a></li>
            <li><a href="#分层的镜像">分层的镜像</a></li>
            <li><a href="#分层的镜像-1">分层的镜像</a></li>
            <li><a href="#为什么-docker纪念馆想要采用这种分层结构">为什么 Docker纪念馆想要采用这种分层结构</a></li>
          </ul>
        </li>
        <li><a href="#特点">特点</a></li>
        <li><a href="#docker镜像commit操作">Docker镜像Commit操作</a>
          <ul>
            <li></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第-五-章-docker容器数据卷">第 五 章 Docker容器数据卷</a>
      <ul>
        <li><a href="#是什么-2">是什么</a></li>
        <li><a href="#能干嘛-1">能干嘛</a></li>
        <li><a href="#数据卷">数据卷</a>
          <ul>
            <li><a href="#容器内添加">容器内添加</a></li>
          </ul>
        </li>
        <li><a href="#数据卷容器">数据卷容器</a>
          <ul>
            <li><a href="#是什么-3">是什么</a></li>
            <li><a href="#总体介绍">总体介绍</a></li>
            <li><a href="#容器间传递共享--volumes--from">容器间传递共享(&ndash;volumes -from)</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第-六-章-dockerfile解析">第 六 章 DockerFile解析</a>
      <ul>
        <li><a href="#是什么-4">是什么</a>
          <ul>
            <li><a href="#dockerfile是用来构建docker镜像的构建文件由一系列命令和参数构成的脚本">Dockerfile是用来构建Docker镜像的构建文件，由一系列命令和参数构成的脚本</a></li>
            <li><a href="#构建三步骤">构建三步骤</a></li>
            <li><a href="#文件什么样">文件什么样？？？</a></li>
          </ul>
        </li>
        <li><a href="#dockerfile构建过程解析">DockerFile构建过程解析</a>
          <ul>
            <li><a href="#docker执行dockerfile的大致流程">Docker执行Dockerfile的大致流程</a></li>
            <li><a href="#小总结-1">小总结</a></li>
          </ul>
        </li>
        <li><a href="#dockerfile体系结构保留字指令">DockerFile体系结构(保留字指令)</a></li>
        <li><a href="#案例">案例</a>
          <ul>
            <li><a href="#base-镜像scratch">Base 镜像(scratch)</a></li>
            <li><a href="#自定义镜像mycentos">自定义镜像mycentos</a></li>
            <li><a href="#cmd">CMD</a></li>
            <li><a href="#自定义镜像tomcat">自定义镜像Tomcat</a></li>
          </ul>
        </li>
        <li><a href="#小总结-2">小总结</a></li>
      </ul>
    </li>
    <li><a href="#第-七-章-docker常用安装">第 七 章 Docker常用安装</a>
      <ul>
        <li>
          <ul>
            <li><a href="#总体步骤">总体步骤</a></li>
            <li><a href="#安装mysql">安装Mysql</a></li>
            <li><a href="#安装redis">安装Redis</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第-8-章-将镜像推送到阿里云">第 8 章 将镜像推送到阿里云</a>
      <ul>
        <li>
          <ul>
            <li><a href="#本地镜像发布到阿里云流程">本地镜像发布到阿里云流程</a></li>
            <li><a href="#镜像生成方法">镜像生成方法</a></li>
            <li><a href="#将本地镜像推送到阿里云">将本地镜像推送到阿里云</a></li>
            <li><a href="#将阿里云上的镜像下载到本地">将阿里云上的镜像下载到本地</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
	 
	  	
	
    <div class="post-content image-border">
	 <h1 id="docker基础篇之快速上手">Docker基础篇之快速上手</h1>
<h1 id="第一章-docker简介">第一章 Docker简介</h1>
<h3 id="是什么">是什么？</h3>
<h4 id="问题为什么会有-docker-的出现">问题：为什么会有 docker 的出现</h4>
<p>一款产 品从开发到上线，从操作系统，到运行环境，再到应用配置。作为开发+运维之间的协作我们需要关心很多东西，这也是很多互联网公司都不得不面对的问题，特别是各种版本的迭代之后，不同版本环境的兼容，对运维人员都是考验
<strong>Docker</strong>之所以发展如此迅速，也是因为它对此给出了一个标准化的解决方案。
环境配置如此麻烦，换一台机器，就要重来一次，费力费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装?也就是说，安装的时候，把原始环境-模-样地复制过来。开发人员利用Docker可以消除协作编码时“在我的机器上可正常工作”的问题。</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_17-51-22.png" alt=""></p>
<p>之前在服务器配置一个应用的运行环境，要安装各种软件，就拿尚硅谷电商项目的环境来说吧，<strong>Java/TomcatMySQL/JDBC</strong>驱动包等。安装和配置这些东西有多麻烦就不说了，它还不能跨平台。假如我们是在<strong>Windows</strong>上安装的这些环境，到了Linux 又得重新装。况且就算不跨操作系统，换另一台同样操作系统的服务器，要移植应用也是非常麻烦的。</p>
<p>传统上认为，软件编码开发/测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等java为例)。而为了让这程序可以顺利执行，开发团队也得准备完整的部署文件，让维运团队得以部署应用程式，<strong>开发需要清楚的告诉运维部署团队，用的全部配置文件+所有软件环境。不过，即便如此，仍然常常发生部署失败的状况。<strong>Docker镜 像的设计</strong>，使得Docker得以打过去「程序即应用」的观念。透过镜像(images)将作业系统核心除外，运作应用程式所需要的系统环境，由下而上打包，达到应用程式跨平台间的无缝接轨运.作。</strong></p>
<h4 id="docker理念">docker理念</h4>
<p>Docker是基于Go语言实现的云开源项目。
Docker的主要目标是“<strong>Build, Ship[ and Run Any App,Anywhere</strong>&quot;，也就是通过对应用组件的封装、分发、部署、运行等生命期的管理，使用户的APP (可以是一个WEB应用或数据库应用等等)及其运行环境能够做到“<strong>一次封装，到处运行</strong>”。</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_18-14-27.png" alt=""></p>
<p>Linux容器技术的出现就解决了这样一 一个问题，而Docker就是在它的基础上发展过来的。将应用运行在Docker容器上面，而Docker容器在任何操作系统上都是一-致的，这就实现了跨平台、跨服务器。<strong>只需要一次配置好环境，换到别的机子上就可以一键部署好，大大简化了操作</strong></p>
<h4 id="一句话">一句话</h4>
<p>解决了运行环境和配置问题的软件容器，方便做持续集成并有助于整体发布的容器虚拟化技术</p>
<h3 id="能干嘛">能干嘛</h3>
<h4 id="之前的虚拟机技术">之前的虚拟机技术</h4>
<p>虚拟机**(virtual machine)**就是带环境安装的一种解决方案。</p>
<p>它可以在一种操作系统里面运行另一种作系统，比如在<strong>Windows系统里面运行Linux系统</strong>。应用程序对此毫无感知，因为虚拟机看上去跟真实系统- -模-样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。这类虚拟机完美的运行了另一套系统，能够使应用程序，操作系统和硬件三者之间的逻辑不变。</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_18-18-07.png" alt=""></p>
<p>虚拟机的缺点:</p>
<p>1、资源占用多</p>
<p>2、冗余步骤多</p>
<p>3、启动慢</p>
<h4 id="容器虚拟化技术">容器虚拟化技术</h4>
<p>由于前面虛拟机存在这些缺点，<strong>Linux</strong> 发展出了另一种虚拟化技术: <strong>Linux 容器</strong>(Linux Containers,缩为LXC)。</p>
<p><strong>Linux容器不是模拟一个完整的操作系统</strong>，而是对进程进行隔离。有了容器，就可以将软件运行所的所有资源打包到一个隔离的容器中。容器与虚拟机不同，不需要捆绑一整套操作系统，只需要软件工作所需的库资源和设置。系统因此而变得高效轻量并保证部署在任何环境中的软件都能始终如一地运行。.</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_18-22-04.png" alt=""></p>
<p>比较了<strong>Docker</strong>和传统虚拟化方式的不同之处:</p>
<p>1、传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程;</p>
<p>2、而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，<strong>而且也没有进行硬件虚拟</strong>。因此容器要比传统虚拟机为轻便。</p>
<p>3、每个容器之间互相隔离，每个容器有自己的文件系统，容器之间进程不会相互影响，能区分计算资源。</p>
<h4 id="开发运维devops">开发/运维(DevOps)</h4>
<p>一次构建、随处运行，</p>
<h5 id="更快速的应用交付和部署">更快速的应用交付和部署</h5>
<p>​		传统的应用开发完成后，需要提供一堆安装程序和配置说明文档，安装部署后需根据配置文档进行繁杂的配置才能正常运行。Docker化
之后只需要交付少量容器镜像文件，在正式生产环境加载镜像并运行即可，应用安装配置在镜像里已经内置好，大大节省部署配置和测
试验证时间。</p>
<h5 id="更便捷的升级和扩缩容">更便捷的升级和扩缩容</h5>
<p>​		随着微服务架构和Docker的发展，大量的应用会通过微服务方式架构，应用的开发构建将变成搭乐高积木一样，每个Docker容器将变成-块“积木”，应用的升级将变得非常容易。当现有的容器不足以支撑业务处理时，可通过镜像运行新的容器进行快速扩容，使应用系统的扩容从原先的天级变成分钟级甚至秒级。</p>
<h5 id="更简单的系统运维">更简单的系统运维</h5>
<p>​		应用容器化运行后，生产环境运行的应用可与开发、测试环境的应用高度&ndash;致，容器会将应用程序相关的环境和状态完全封装起来，不会因为底层基础架构和操作系统的不一致性给应用带来影响，产生新的BUG。当出现程序异常时，也可以通过测试环境的相同容器进行快速定位和修复。</p>
<h5 id="更高效的计算资源利用">更高效的计算资源利用</h5>
<p>​	<strong>Docker是内核级虚拟化</strong>，其不像传统的虚拟化技术一样 需要额外的Hypervisor支持，所以在-台物理机上可以运行很多个容器实例，可大大提升物理服务器的CPU和内存的利用率。</p>
<h4 id="企业级">企业级</h4>
<p>新浪</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_18-30-08.png" alt=""></p>
<p>美团</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_18-30-56.png" alt=""></p>
<p>蘑菇街</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_18-31-11.png" alt=""></p>
<h4 id="去哪下">去哪下</h4>
<h5 id="1官网">1、官网</h5>
<p>docker官网： <a href="https://www.docker.com/">https://www.docker.com/</a></p>
<p>docker中文网站: <a href="https://www.docker-cn.com/">https://www.docker-cn.com/</a></p>
<h5 id="2仓库">2、仓库</h5>
<p>Docker Hub官网：https://hub.docker.com/</p>
<h1 id="第二章-docker安装">第二章 Docker安装</h1>
<h3 id="前提说明">前提说明</h3>
<p><strong>CentOS Docker安装</strong>
Docker支持以下的CentOS版本:
CentOS 7 (64-bit)
CentOS 6.5 (64-bit)或更高的版本</p>
<p><strong>前提条件</strong>
目前，CentOS 仅发行版本中的内核支持Docker。
Docker运行在CentOS 7.上，要求系统为64位、系统内核版本为3.10以上。
Docker运行在CentOS-6.5或更高的版本的CentOS上，要求系统为64位、系<strong>统内核版本为2.6.32-431或者更高版本。</strong></p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_18-46-16.png" alt=""></p>
<h3 id="docker-的基本组成">Docker 的基本组成</h3>
<h4 id="docker架构图">docker架构图</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/architecture.svg" alt=""></p>
<h4 id="镜像-image-">镜像( image )</h4>
<p>Docker镜像(lmage)就是-一个只读的模板。镜像可以用来创建Docker容器，个镜像可以创建很多容器</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_19-39-12.png" alt=""></p>
<h4 id="容器-container">容器( container)</h4>
<p>Docker利用容器(Container) 独立运行的一个或一组应用。<strong>容器是用镜像创建的运行实例。</strong>
它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台。
<strong>可以把容器看做是一个简 易版的Linux环境</strong>(包括root用户权限、进程空间、用户空间和网络空间等)和运行在其中的应用程序。
容器的定义和镜像几乎一模一样，也是一堆层的统一视角， 唯- -区别在于容器的最上面那-层是可读可写的。</p>
<h4 id="仓库-repository">仓库( repository)</h4>
<p>仓库(<strong>Repository</strong>) 是<strong>集中存放镜像</strong>文件的场所。
仓库(<strong>Repository</strong>)和仓库注册服务器(<strong>Registry</strong>) 是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多镜像，
每个镜像有不同的标签(tag) 。</p>
<p>仓库分为公开仓库(<strong>Public</strong>) 和私有仓库(<strong>Private</strong>) 两种形式。
<strong>最大的公开仓库是Docker Hub(ttps://hub. docker.com/)</strong>
存放了数量庞大的镜像供用户下载。国内的公开仓库包括阿里云、网易云等</p>
<h4 id="小总结-">小总结 ()</h4>
<p>需要正确的理解仓储/镜像/容器这几个概念:</p>
<p>Docker本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一-个可交付的运行环境，这个打好的运行环境就似乎image镜像文件。只有通过这个镜像文件才能生成Docker容器。image文件可以看作是容器的模板。Docker根据image文件生成容器的实例。同一个image文件，可以生成多个同时运行的容器实例。</p>
<p>image文件生成的容器实例，本身也是一一个文件，称为镜像文件。</p>
<p>一个容器运行一种服务，当我们需要的时候，就可以通过docker客户端创建一-个对应的运行实例，也就是我们的容器至于仓储，就是放了一堆镜像的地方，我们可以把镜像发布到仓储中，需要的时候从仓储中拉下来就可以了。|</p>
<h3 id="安装步骤">安装步骤</h3>
<h4 id="centos68安装docker">Centos6.8安装Docker</h4>
<p>1、yum install -y epel-release</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_19-48-53.png" alt=""></p>
<p>2、yum install -y docker-io</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_19-49-37.png" alt=""></p>
<p>3、安装后的配置文件： etc/sysconfig/docker</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_19-50-17.png" alt=""></p>
<p>4、启动 Docker后台服务: service docker start</p>
<p>5、docker version 验证</p>
<h4 id="centos70安装docker">Centos7.0安装Docker</h4>
<p><a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<h3 id="永远的helloworld">永远的helloworld</h3>
<h4 id="阿里云镜像加速">阿里云镜像加速</h4>
<p>是什么</p>
<p>​	https://promotion.aliyun.com/ntms/act/kubernetes.html</p>
<p>注册一个属于自己的阿里云账户( 可复用淘宝账号)</p>
<p>获得加速器地址连接</p>
<p>​	登录阿里云开发者平台</p>
<p>​	获取加速器地址</p>
<p>配置本机Docker运行镜像加速器</p>
<p>​	鉴于国内网络问题，后续拉取Docker镜像十分缓慢，我们可以需要配置加速器来解决，
我使用的是阿里云的本人自己账号的镜像地址(需要自己注册有一个属于你自己的): ht:po/. mirror aliyuncns .com</p>
<ul>
<li>vim /etc/sysconfig/docker
将获得的自己账户下的阿里云加速地址配置进
other_ args-=&quot;&ndash;registry-mirror=https://你自 己的账号加速信息.mirror .aliyuncs.com</li>
</ul>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-02_20-19-10.png" alt=""></p>
<p>重新启动 Docker 后台服务：service docker restart</p>
<p>Linux系统下配置完加速器需要检查是否生效</p>
<h4 id="网易云加速">网易云加速</h4>
<p>基本上同上述阿里云</p>
<p>启动Docker后台容器(测试运行 hello-world )</p>
<p>​	docker run hello world</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_10-54-57.png" alt=""></p>
<p>run干了什么</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_10-55-24.png" alt=""></p>
<h3 id="底层原理">底层原理</h3>
<h4 id="docker是怎样工作的">Docker是怎样工作的</h4>
<p>Docker是一个Client-Server结构的系统，Docker守 护进程运行在主机上，然后通过Socket连 接从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器。<strong>容器，是一个运行时环境，就是我们前面说到的集装箱。</strong></p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_10-58-47.png" alt=""></p>
<h4 id="为什么docker比较比vm快">为什么Docker比较比vm快</h4>
<p>1、<strong>docker</strong>有着比虚拟机更少的抽象层。由亍docker不需要<strong>Hypervisor</strong>实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。
2、<strong>docker</strong>利用的是宿主机的内核,而不需要<strong>Guest OS</strong>。因此,当新建一个 容器时,docker不需要和虚拟机一样 重新加载- - 个操作系统内核仍而避免引寻、加载操作系统内核返个比较费时费资源的过程,当新建&ndash;个虚拟机时,虚拟机软件需要加载GuestOS,返个新建过程是分钟级别的。而docker由于直接利用宿主机的操作系统,则省略了返个过程,因此新建一-个docker容器只需要几秒钟。</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_11-00-34.png" alt=""></p>
<h1 id="第三章-docker常用命令">第三章 Docker常用命令</h1>
<h3 id="帮助命令">帮助命令</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker Version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker info
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker --help
</span></span><span class="line"><span class="cl">	自己查看官网解释，高手都是自己练出来的，百度上只不过是翻译了下，加了点例子
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="镜像命令">镜像命令</h3>
<h4 id="docker-images-列出本机上的镜像">docker images 列出本机上的镜像</h4>
<h4 id="httpsrawgithubusercontentcomcold-binimg-for-cold-bin-blogmasterimgsnipaste_2020-10-03_11-09-33pngoptions-说明"><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_11-09-33.png" alt="">OPTIONS 说明：</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">-a 列出本地所有的镜像<span class="o">(</span>含中间映射层<span class="o">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>-q 只显示镜像ID<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>--digests 显示镜像的摘要信息<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>--no-trunc 显示完整的镜像信息<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="docker-search-某个xxx镜像的名字">docker search 某个XXX镜像的名字</h4>
<p>​	网站 <a href="https://www.dockerhub.com">www.dockerhub.com</a></p>
<p>​	docker search [OPTIONS] 镜像名字</p>
<p>​	OPTIONS 说明</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">--no-trun 显示完整的镜像描述<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>-s 列出收藏数不小于指定值的镜像<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>--automated 只列出 automated build类型的镜像<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="docker-pull-某个镜像的名字">docker pull 某个镜像的名字</h4>
<p>​	下载镜像</p>
<p>​	 docker pull 镜像名字[:TAG]</p>
<h4 id="docker-rmi-某个xxx镜像的名字id">docker rmi 某个XXX镜像的名字ID</h4>
<p>​	删除镜像</p>
<p>​	删除单个 docker rm -f 镜像ID</p>
<p>​	删除多个 docker rm -f 镜像名1:TAG 镜像名2:TAG</p>
<p>​	删除多个 docker rmi -f ${docker images -qa}</p>
<h3 id="容器命令">容器命令</h3>
<p>有镜像才能创建容器，这是根本前提(下载一个Centos镜像演示)</p>
<p>​	docker pull centos</p>
<h4 id="新建并启动容器">新建并启动容器</h4>
<p>​	docker run [OPTIONS] IMAGE [COMMAND][ARG]</p>
<p>​	OPTIONS 说明</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">OPTIONS说明</span><span class="p">(</span><span class="n">常用</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="n">有些是一个减号</span><span class="err">，</span><span class="n">有些是两个减号</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;容器新名字&#34;</span><span class="p">:</span><span class="n">为容器指定一个名称</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">d</span><span class="p">:</span><span class="n">后台运行容器</span><span class="err">，</span><span class="n">并返回容器ID</span><span class="err">，</span><span class="w"> </span><span class="n">也即启动守护式容器</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">i</span><span class="p">:</span><span class="n">以交互模式运行容器</span><span class="err">，</span><span class="n">通常与</span><span class="o">-</span><span class="n">t同时使用</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">t</span><span class="p">:</span><span class="n">为容器重新分配一个伪输入终端</span><span class="err">，</span><span class="n">通常与</span><span class="o">-</span><span class="n">i同时使用</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">P</span><span class="p">:</span><span class="n">随机端口映射</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">p</span><span class="p">:</span><span class="n">指定端口映射</span><span class="err">，</span><span class="n">有以下四种格式</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">ip</span><span class="p">:</span><span class="n">hostPort</span><span class="p">:</span><span class="n">containerPort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">ip</span><span class="p">::</span><span class="n">containerPort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">hostPort</span><span class="p">:</span><span class="n">containerPort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">containerPort</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_11-40-34.png" alt=""></p>
<h4 id="列出当前所有正在运行的容器">列出当前所有<strong>正在运行</strong>的容器</h4>
<p>​	dockers ps [OPTIONS]</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JAVA" data-lang="JAVA"><span class="line"><span class="cl"><span class="n">OPTIONS说明</span><span class="p">(</span><span class="n">常用</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="n">列出当前所有正在运行的容器</span><span class="o">+</span><span class="n">历史上运行过的</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-|</span><span class="p">:</span><span class="n">显示最近创建的容器</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">n</span><span class="p">:</span><span class="n">显示最近n个创建的容器</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">q</span><span class="w"> </span><span class="p">:</span><span class="n">静默模式</span><span class="err">，</span><span class="n">只显示容器编号</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">trunc</span><span class="w"> </span><span class="p">:</span><span class="n">不截断输出</span><span class="err">。</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="退出容器">退出容器</h4>
<p>两种退出方式</p>
<p>​	exit 容器停止退出</p>
<p>​	ctrl+P+Q 容器不停止退出</p>
<h4 id="启动容器">启动容器</h4>
<p>docker start 容器ID或容器签名</p>
<h4 id="重启容器">重启容器</h4>
<p>docker restart 容器ID或容器签名</p>
<h4 id="停止容器">停止容器</h4>
<p>docker stop 容器ID或容器签名</p>
<h4 id="强制停止容器">强制停止容器</h4>
<p>docker kill 容器ID或容器签名</p>
<h4 id="删除已停止的容器">删除已停止的容器</h4>
<p>docker rm 容器ID  -f</p>
<p>​	一次性删除多个容器</p>
<p>​	docker rm -f $(docker ps -a -q)</p>
<p>​	docker ps -a -q | xargs docker rm</p>
<h3 id="重要">重要</h3>
<h4 id="启动守护式容器">启动守护式容器</h4>
<p>#使用镜像centos:latest以后台模式启动一个容器
docker run -d centos</p>
<p>问题:然后docker ps -a进行查看,<strong>会发现容器已经退出</strong>
很重要的要说明的一点: <strong>Docker容器后台运行,就必须有一个前台进程.</strong>
容器运行的命令如果不是那些<strong>一直挂起的命令</strong> (比如运行top，tail) ，就是会自动退出的。
这个是<strong>docker</strong>的机制问题,比如你的web容器，我们以<strong>nginx</strong>为例，正常情况下,我们配置启动服务只需要启动响应的<strong>service</strong>即可。例如
service nginx start
但是,这样做,<strong>nginx</strong>为后台进程模式运行,就导致<strong>docker</strong>前台没有运行的应用,这样的容器后台启动后，会立即自杀因为他觉得他没事可做了.所以，最佳的解决方案是将你要运行的程序以前台进程的形式运行</p>
<h4 id="查看容器日志">查看容器日志</h4>
<p>docker logs -f -t &ndash;tail 容器ID</p>
<p>​	-t 是加入时间戳</p>
<p>​	-f 跟随最新的日志打印</p>
<p>​	&ndash;tail 数字显示最后多少条</p>
<h4 id="查看容器内的进程">查看容器内的进程</h4>
<p>docker top 容器ID</p>
<h4 id="查看容器内部细节">查看容器内部细节</h4>
<p>docker inspect 容器ID</p>
<h4 id="进入正在运行的容器并以命令行交互">进入正在运行的容器并以命令行交互</h4>
<p>docker exec -it 容器ID bashShell</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_13-23-17.png" alt=""></p>
<p>重新进入docker attach 容器ID</p>
<p>上述两个区别</p>
<p>attach 直接进入容器启动命令的终端，不会启动新的进程</p>
<p>exec 实在容器中打开新的终端，并且可以穷的那个新的进程</p>
<h4 id="从容器内拷贝文件到主机上">从容器内拷贝文件到主机上</h4>
<p>docker cp 容器ID:容器内路径 目的主机路径</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_13-26-40.png" alt=""></p>
<h3 id="小总结">小总结</h3>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_13-30-12.png" alt=""></p>
<p><img src="/20201003133051.png" alt=""></p>
<h1 id="第-四-章-docker-镜像">第 四 章 Docker 镜像</h1>
<h2 id="是什么-1">是什么</h2>
<p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<h3 id="unionfs联合文件系统">UnionFS(联合文件系统)</h3>
<p>UnionFS (状节又件示统)
UnionFS (联合文件系统) : Union文件系统(UnionFS)是一一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修作为一 次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a singlevirtualfilesystem)。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像(没有父镜像)可以制作各种具.体的应用镜像。</p>
<p>特性:一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文
件系统会包含所有底层的文件和目录</p>
<h3 id="docker镜像加载原理">Docker镜像加载原理</h3>
<p><strong>Docker镜像加载原理:</strong>
<strong>docker</strong>的镜像实际上由一层一层的文件系统组成，这种层级的文件系统<strong>UnionFS。</strong></p>
<p><strong>botfs(boot file system)<strong>主要包含</strong>bootloader</strong>和<strong>kernel</strong>, <strong>bootloader</strong>主 要是引导加载<strong>kernel</strong>, <strong>Linux</strong>刚启动时会加载bootfs文件系统，在<strong>Docker</strong>镜像的最底层是<strong>bootfs</strong>。这一-层与我们典型的<strong>Linux/Unix</strong>系统是- - -样的，包含boot加载器和内核。当boot加载完成之 后整个内核就都在内存中了，此时内存的使用权己由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p><strong>rootfs (root file system)，<strong>在</strong>bootfs</strong>之 上。 包含的就是典型Linux系统中的**/dev, /proc, /bin, /etc<strong>等标准目录和文件。<strong>rootfs</strong>就 是各种不同的操作系统发行版，比如</strong>Ubuntu**，<strong>Centos</strong>等等。</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_13-38-28.png" alt=""></p>
<p>平时我们安装的虚拟机的Centos都是好几个G ，为什么docker这里才要200m</p>
<p><img src="/QQ%E6%88%AA%E5%9B%BE20201003133908.png" alt=""></p>
<p>对于一个精简的<strong>OS, rootfs</strong>可 以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用<strong>Host</strong>的<strong>kernel</strong>,自只需要提供rootfs就行了。由此可见对于不同的<strong>linux</strong>发行版, <strong>bootfs</strong>基本是一致的, <strong>rootfs</strong>会有差别，因此不同的发行版可以公用<strong>bootfs</strong>。</p>
<h3 id="分层的镜像">分层的镜像</h3>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_13-40-06.png" alt=""></p>
<h3 id="分层的镜像-1">分层的镜像</h3>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_14-02-22.png" alt=""></p>
<h3 id="为什么-docker纪念馆想要采用这种分层结构">为什么 Docker纪念馆想要采用这种分层结构</h3>
<p>最大的一个好处就是-<strong>共享资源</strong>
比如:<strong>有多个镜像都从相同的base镜像构建而来</strong>，那么宿主机只需在磁盘上保存一份<strong>base</strong>镜像,
同时内存中也只需加载一份<strong>base</strong>镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p>
<h2 id="特点">特点</h2>
<p>Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到<strong>镜像的顶部</strong>，这一层通常被称为<strong>容器层</strong>，容器层之下都叫<strong>镜像层</strong></p>
<h2 id="docker镜像commit操作">Docker镜像Commit操作</h2>
<p>docker commit 提交容器副本使之称为一个新的镜像</p>
<p>docker commit -m=&ldquo;提交的描述信息&rdquo; -a=&ldquo;作者&rdquo; 容器ID 要创建的目标镜像名:[标签名]</p>
<h4 id="案例演示">案例演示：</h4>
<p>1、从Hub上下载tomcat镜像到本地并成功运行</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_14-26-27.png" alt=""></p>
<p>docker run -d -p 8080:8080 tomcat</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">-</span><span class="n">p主机端口</span><span class="err">：</span><span class="n">docker容器端口</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">P</span><span class="p">:</span><span class="n">随机分配端口</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">i</span><span class="p">:</span><span class="n">交互</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">t</span><span class="p">:</span><span class="n">终端</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>2、故意删除上一步镜像生产tomcat容器的文档</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_14-28-22.png" alt=""></p>
<p>3、也即当前的tomcat运行实例是一个没有文档内容的容器，以他为模板commit一个没有doc的tomcat新镜像 atguigu/tomcat02</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_14-29-38.png" alt=""></p>
<p>4、启动我们的新镜像并和原来的对比</p>
<p>​	启动atuigu/tomcat02 没有doc</p>
<p>​	启动原来tomcat他有doc</p>
<h1 id="第-五-章-docker容器数据卷">第 五 章 Docker容器数据卷</h1>
<h2 id="是什么-2">是什么</h2>
<p>先来看看<strong>Docker</strong>的理念:
*将运用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们对数据的要求希望是持久化的
*容器之间希望有可能共享数据
<strong>Docker</strong>容器产生的数据，如果不通过<strong>docker</strong> <strong>commit</strong>生成新的镜像，使得数据做为镜像的一部分保存下来，
那么当容器删除后，数据自然也就没有了。
为了能保存数据在docker中我们使用卷。|</p>
<p>一句话：有点类似我们Redis里面的rdb和aof文件</p>
<h2 id="能干嘛-1">能干嘛</h2>
<p>卷就是目录或文件，存在于一个或多个容器中，由<strong>docker</strong>挂载到容器，但不属于联合文件系统，因此能够绕过Union FileSystem提供一些用 于持续存储或共享数据的特性:
卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不 会在容器删除时删除其挂载的数据卷</p>
<p>特点:
1:数据卷可在容器之间共享或重用数据
2:卷中的更改可以直接生效
3:数据卷中的更改不会包含在镜像的更新中
4:数据卷的生命周期一直持续到没有容器使用它为止</p>
<p><strong>容器的持久化</strong></p>
<p><strong>容器间继承+共享数据</strong></p>
<h2 id="数据卷">数据卷</h2>
<h3 id="容器内添加">容器内添加</h3>
<h4 id="直接命令添加">直接命令添加</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-30-44.png" alt=""></p>
<p>docker run -it -v /宿主机绝对路径目录:/容器内目录 镜像名</p>
<p><strong>使用该命令添加挂载需要注意：</strong></p>
<ul>
<li>
<p><strong>如果挂载一个空的数据卷到容器中的一个非空目录中，那么这个目录下的文件会被复制到数据卷中</strong></p>
</li>
<li>
<p><strong>如果挂载一个非空的数据卷到容器中的一个目录中，那么容器中的目录中会显示数据卷中的数据。如果原来容器中的目录中有数据，那么这些原始数据会被隐藏掉</strong></p>
<p><strong>假如，将容器里的应用程序的配置文件挂载到一个不是空的主机目录上，这个主机目录的文件会覆盖掉配置文件，配置文件隐藏，导致容器应用启动的时候，启动不成功，原因是配置文件改了。</strong></p>
</li>
</ul>
<p>查看数据卷是否挂载成功</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-31-52.png" alt=""></p>
<p>容器和宿主机之间数据共享</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-32-19.png" alt=""></p>
<p>容器停止退出后，主机修改后的数据是否同步</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-33-03.png" alt=""></p>
<p>命令(带权限)</p>
<p>​	docker run -it -v /宿主机绝对路径目录:/容器内目录**:ro** 镜像名    -&gt;表示容器只有读权限，没有写权限。因此，但是宿主机有写权限。</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-33-49.png" alt=""></p>
<h4 id="dockerfile添加">DockerFile添加</h4>
<p>根目录下新建mydocker文件夹并进入</p>
<p>可在Dockerfile中使用VOLUME指令来给镜像添加一个或多个数据卷</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-35-17.png" alt=""></p>
<p>File构建</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-35-37.png" alt=""></p>
<p>build后生成镜像</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-36-01.png" alt=""></p>
<p>获得一个新镜像zzyy/centos</p>
<p>run容器</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-36-31.png" alt=""></p>
<p>通过上述步骤，容器内的卷目录地址已经知道，对应的主机目录在哪</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-37-05.png" alt=""></p>
<p><strong>主机对应默认地址</strong></p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-37-22.png" alt=""></p>
<p>备注</p>
<p>Docker挂载主机目录Docker访问出现cannot open directory . Permission denied
解决办法:在挂载目录后多加一个&ndash;privileged=true参数即可</p>
<h2 id="数据卷容器">数据卷容器</h2>
<h3 id="是什么-3">是什么</h3>
<p>命名的容器挂载数据卷，其它容器通过挂载这个(父容器)实现数据共享，挂载数据卷的容器，称之为数据卷容器.</p>
<h3 id="总体介绍">总体介绍</h3>
<p>以上一步新建的zzyy/centos为模板并运行容器 doc1/doc2/doc3</p>
<p>他们已经具有容器卷</p>
<p>​	/dataVolumeContainer1</p>
<p>​	/dataVolumeContainer2</p>
<h3 id="容器间传递共享--volumes--from">容器间传递共享(&ndash;volumes -from)</h3>
<h4 id="先启动一个父容器doc1">先启动一个父容器doc1</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-40-46.png" alt=""></p>
<p>启动后在 dataVolumeContainer1中新增内容</p>
<h4 id="doc2doc3-继承doc1">doc2/doc3 继承doc1</h4>
<p>​	<strong>&ndash;volumes -from</strong></p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-41-51.png" alt=""></p>
<p>doc2/doc3 分别在dataVolumeContainer2各自新增内容</p>
<h4 id="回到doc1可以看到0203各自添加的都能共享了">回到doc1可以看到02/03各自添加的都能共享了</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-42-46.png" alt=""></p>
<h4 id="删除doc1-doc2修改后doc3是否可以访问">删除doc1 doc2修改后doc3是否可以访问</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-43-31.png" alt=""></p>
<h4 id="删除doc02后doc3是否访问">删除doc02后doc3是否访问</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-43-57.png" alt=""></p>
<p>在进一步</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-44-11.png" alt=""></p>
<h4 id="新建doc04继承doc03-然后删除doc03">新建doc04继承doc03 然后删除doc03</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_15-44-56.png" alt=""></p>
<p><strong>结论：容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用它为止</strong></p>
<h1 id="第-六-章-dockerfile解析">第 六 章 DockerFile解析</h1>
<h2 id="是什么-4">是什么</h2>
<h3 id="dockerfile是用来构建docker镜像的构建文件由一系列命令和参数构成的脚本">Dockerfile是用来构建Docker镜像的构建文件，由一系列命令和参数构成的脚本</h3>
<h3 id="构建三步骤">构建三步骤</h3>
<p>​	编写Dockerfile文件</p>
<p>​	docker build</p>
<p>​	docker run</p>
<h3 id="文件什么样">文件什么样？？？</h3>
<p>​	熟悉的Centos为例</p>
<p><a href="http://hub.docker.com/_/centos">http://hub.docker.com/_/centos</a></p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-32-12.png" alt=""></p>
<h2 id="dockerfile构建过程解析">DockerFile构建过程解析</h2>
<p>Dockerfile内容基础知识</p>
<p>1、每条保留字指令都必须为大写字母且后面要跟随至少一个参数
2、指令按照从上到下，顺序执行
3、#表示注释
4、每条指令都会创建一个新的镜像层，并对镜像进行提交</p>
<h3 id="docker执行dockerfile的大致流程">Docker执行Dockerfile的大致流程</h3>
<p>1、docker从基础镜像运行一个容器
2、执行一条指令并对容器作出修改
3、执行类似docker commit的操作提交一个新的镜像层
4、docker再基 于刚提交的镜像运行一一个新容器
5、执行dockerfile中的 下一条指令直到所有指令都执行完成</p>
<h3 id="小总结-1">小总结</h3>
<p>从应用软件的角度来看，Dockerfile、 Docker镜像与Docker容器分别代表软件的三个不同阶段，
Dockerfile是软件的原材料
Docker镜像是软件的交付品
Docker容器则可以认为是软件的运行态。
Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-35-08.png" alt=""></p>
<p>1、Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉 及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;
2、Docker镜像，在用Dockerfile定义一文件之后，docker build时会产生一个Docker镜像，当运行Docker镜像时，会真正开始提供服务;
3、Docker容器，容器是直接提供服务的。</p>
<h2 id="dockerfile体系结构保留字指令">DockerFile体系结构(保留字指令)</h2>
<img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-47-26.png" style="zoom:200%;" />
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-47-58.png" alt=""></p>
<p>小总结</p>
<p><strong>其中单一run指令后面需要写多行时，后面不能使用注释符号</strong></p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-48-16.png" alt=""></p>
<h2 id="案例">案例</h2>
<h3 id="base-镜像scratch">Base 镜像(scratch)</h3>
<p>Docker Hub中 99%的镜像都是通过在base镜像中安装和配置需要的软件构建出来的</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-52-43.png" alt=""></p>
<h3 id="自定义镜像mycentos">自定义镜像mycentos</h3>
<h4 id="1编写">1、编写</h4>
<p>​	Hub默认Centos镜像是什么情况</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-53-44.png" alt=""></p>
<p>准备Dockerfile文件</p>
<p>myCentOS内容Dockerfile</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-54-40.png" alt=""></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">FROM centos
</span></span><span class="line"><span class="cl">MAINTAINER ZZYY&lt;zzyy167@126.com&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ENV MYPATH /usr/local
</span></span><span class="line"><span class="cl">WORKDIR <span class="nv">$MYPATH</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#来自centos的原始镜像，没有好的yum源，先把yum源提上去，再下vim</span>
</span></span><span class="line"><span class="cl">RUN <span class="nb">cd</span> /etc/yum.repos.d/
</span></span><span class="line"><span class="cl">RUN sed -i <span class="s1">&#39;s/mirrorlist/#mirrorlist/g&#39;</span> /etc/yum.repos.d/CentOS-*
</span></span><span class="line"><span class="cl">RUN sed -i <span class="s1">&#39;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#39;</span> /etc/yum.repos.d/CentOS-*
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">RUN yum -y install vim
</span></span><span class="line"><span class="cl">RUN yum -y install net-tools
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">EXPOSE <span class="m">80</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CMD <span class="nb">echo</span> <span class="nv">$MYPATH</span>
</span></span><span class="line"><span class="cl">CMD <span class="nb">echo</span> <span class="s2">&#34;success--------------ok&#34;</span>
</span></span><span class="line"><span class="cl">CMD /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2构建">2、构建</h4>
<p>docker build -t 新镜像名字:TAG .</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-56-15.png" alt=""></p>
<h4 id="3运行">3、运行</h4>
<p>docker run -it 新镜像名字:TAG</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_17-57-09.png" alt=""></p>
<h4 id="4列出镜像的变更历史">4、列出镜像的变更历史</h4>
<p>docker history 镜像名</p>
<p>CMD/ENTRYPOINT 镜像案例</p>
<p>都是指定一个容器启动时要运行的命令</p>
<h3 id="cmd">CMD</h3>
<p>​	Dockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被dockerrun之后的参数替换</p>
<p>​	Case</p>
<p>​	tomcat的讲解演示 docker run -it -p 8080:8080 tomcat ls -l</p>
<h5 id="entrypoint">ENTRYPOINT</h5>
<p>​	docker run 之后的参数会被当做参数传递给 ENTRYPOINT 之后形成新的命令组合</p>
<p>​	Case</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-02-41.png" alt=""></p>
<p>制作CMD版可以查询IP信息的容器</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-03-11.png" alt=""></p>
<h5 id="curl的命令解释">curl的命令解释</h5>
<p><strong>curl</strong>命令可以用来执行下载、发送各种<strong>HTTP</strong>请求，指定<strong>HTTP</strong>头部等操作。</p>
<p>如果系统没有<strong>curl</strong>可以使用<strong>yum install curl</strong>安装，也可以下载安装。
<strong>curl是将下载文件输出到stdout</strong>
使用命令: curl http://www .baidu.com
执行后，www.baidu.com的html就会显示在屏幕上了</p>
<p>这是最简单的使用方法。用这个命令获得了htp://curl.haxx.se指向的页面，同样，如果这里的URL指向的是&ndash;个文件或者一幅图都可以直接下载到本地。如果下载的是HTML文档，那么缺省的将只显示文件头部，即HTML文档的header。要全部显示，请加参数-i</p>
<p>WHY</p>
<p>我们可以看到可执行文件找不到的报错，<strong>executable file not found。</strong>
之前我们说过，<strong>跟在镜像名后面的是command,运行时会替换CMD的默认值。</strong>
因此这里的-i替换了原来的CMD，而不是添加在原来的curl -s htp://ip.cn后面。而-i 根本不是命令，所以自然找不到。
那么如果我们希望加入-i这参数，我们就必须重新完整的输入这个命令:
<strong>$ docker run myip curl -s <a href="http://ip.cn">http://ip.cn</a> -i</strong></p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-05-28.png" alt=""></p>
<h3 id="自定义镜像tomcat">自定义镜像Tomcat</h3>
<h5 id="1mkdir--p-zzyymydockerfiletomcat9">1、mkdir -p /zzyy/mydockerfile/tomcat9</h5>
<h5 id="2在上述目录下-touch-ctxt">2、在上述目录下 touch c.txt</h5>
<h5 id="3将jdk和tomcat安装的压缩包拷贝进上一步目录">3、将jdk和tomcat安装的压缩包拷贝进上一步目录</h5>
<h5 id="4在zzyyusemydockerfiletomcat9目录下新建dockerfile文件">4、在zzyyuse/mydockerfile/tomcat9目录下新建Dockerfile文件</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> centos</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">MAINTAINER</span><span class="s"> zzyy&lt;zzyybs@ 126.com&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c">#把宿主机当前上下文的c .txt拷贝到容器/usr/local/路径下</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> c.txt /usr/local/cincontainer.txt<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c">#把java与tomcat添加到容器中</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ADD</span> jdk-8u171-linux x64.tar .gz /usr/local/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ADD</span> apache-tomcat-9.0.8.tar.gz /usr/ocal/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c">#安装vim编辑器</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install vim<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c">#设置工 作访问时候的WORKDIR路径， 登录落脚点</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> MYPATH /usr/local<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $MYPATH</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c">#配:置java与tomcat环境变量</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> JAVA_ HOME /usr/localjdk1 .8.0_ <span class="m">171</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> CLASSPATH <span class="nv">$JAVA_</span> HOME/lib/dt.jar:<span class="nv">$JAVA_</span> HOME/lib/tools.jar<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> CATALINA_ HOME /usr/local/apache-tomcat-9.0.8<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> CATALINA_ BASE /usr/ocal/apache-tomcat-9.0.8<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> PATH <span class="nv">$PATH</span>:<span class="nv">$JAVA_</span> HOME/bin:<span class="nv">$CATALINA_</span> HOME/ib:<span class="nv">$CATALINA_</span> HOME/bin<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c">#容器运行时监听的端口</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 8080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c">#启动时运行tomcat</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ENTRYPOINT [&#34;/usrl/local/apache-tomcat-9.0.8/bin/startup.sh&#34; ]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># CMD [&#34;/usr/local/apache-tomcat-9.0.8/bin/catalina.sh&#34;,&#34;run&#34;]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /usr/local/apache-tomcat-9.0.8/bin/startup.sh <span class="o">&amp;&amp;</span> tail -F /usr/local/apache-tomcat-9.0.8/in/logs/catalina.out<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>目录内容</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-12-29.png" alt=""></p>
<h5 id="5构建">5、构建</h5>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-12-48.png" alt=""></p>
<p>构建完成</p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-13-20.png" alt=""></p>
<h5 id="6run">6、run</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">docker run -d -p 9080:8080 -name myt9<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span> -v /zyuse/mydockerfiletomcat9/test:/usrlocal/apache-tomcat9.0.8/webapps/test<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span> -v /zzyyuse/mydockerfile/tomcat9/tomcat9logs/:/usrlocal/apache-tomcat-9.0.8/logs -privileged<span class="o">=</span><span class="nb">true</span> zzyytomcat9<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-14-42.png" alt=""></p>
<p>备注</p>
<p>Docker挂载主机目录Docker访问出现cannot open directory : Permission denied解决办法:在挂载目录后多加一个&ndash;privileged=true参数即可</p>
<h5 id="7验证">7、验证</h5>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-58-14.png" alt=""></p>
<h5 id="8综合前述容器卷测试的web服务test发布">8、综合前述容器卷测试的web服务test发布</h5>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_18-58-56.png" alt=""></p>
<p>web.xml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1 .0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;web-app</span> <span class="na">xmIns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XML Schema-instance&#34;</span>
</span></span><span class="line"><span class="cl"><span class="na">xmIns=</span><span class="s">&#34;http://java sun.com/xm/ns/javaee&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">xsi:schemaL</span> <span class="na">ocation=</span><span class="s">&#34;http://java. sun.com/xml/ns/javaee htp:/:/java. sun.com/xml/ns/javaee/web-app_ 2_ _5.xsd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="na">id=</span><span class="s">&#34;WebApp_ ID&#34;</span> <span class="na">version=</span><span class="s">&#34;2.5&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;display-name&gt;</span>test<span class="nt">&lt;/display-name&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/web-app&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>a.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34; pageEncoding=&#34;UTF-8&#34;%&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html PUBLIC“//W3C//DTD HTML 4.01 Transitional//EN&#34; http://www.w3.org/TR/html4/loose.dtd&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">&lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=UTF-8&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;title&gt;Insert title here &lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">welcome-
</span></span><span class="line"><span class="cl">&lt;%=&#34;i am in docker tomcat self &#34;%&gt;
</span></span><span class="line"><span class="cl">&lt;br&gt;
</span></span><span class="line"><span class="cl">&lt;br&gt;
</span></span><span class="line"><span class="cl">&lt;% System.out,.printIn(&#34;==========docker tomcat self&#34;);%&gt;
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/htmI&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34; pageEncoding=&#34;UTF-8&#34;%&gt;
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html PUBLIC“//W3C//DTD HTML 4.01 Transitional//EN&#34; http://www.w3.org/TR/html4/loose.dtd&#34;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Type&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;text/html; charset=UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Insert title here <span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">welcome-
</span></span><span class="line"><span class="cl"><span class="err">&lt;</span>%=&#34;i am in docker tomcat self &#34;%&gt;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="err">&lt;</span>% System.out,.printIn(&#34;==========docker tomcat self&#34;);%&gt;
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">htmI</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="小总结-2">小总结</h2>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-03_19-00-48.png" alt=""></p>
<h1 id="第-七-章-docker常用安装">第 七 章 Docker常用安装</h1>
<h3 id="总体步骤">总体步骤</h3>
<blockquote>
<p>搜索镜像</p>
<p>拉取镜像</p>
<p>查看镜像</p>
<p>启动镜像</p>
<p>停止容器</p>
<p>移除容器</p>
</blockquote>
<h3 id="安装mysql">安装Mysql</h3>
<h4 id="docker-hub-上查找mysql镜像">docker hub 上查找mysql镜像</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_11-38-56.png" alt=""></p>
<h4 id="从-docker-hub阿里云加速器拉取mysql镜像到本地标签为56">从 docker hub(阿里云加速器)拉取mysql镜像到本地标签为5.6</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_11-40-13.png" alt=""></p>
<h4 id="使用mysql56镜像创建容器也叫运行镜像">使用mysql5.6镜像创建容器(也叫运行镜像)</h4>
<p>使用mysql镜像</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -p 12345:3306 --name mysql 
</span></span><span class="line"><span class="cl">-v /ggcc/mysql/conf:/etc/mysql/conf.d 
</span></span><span class="line"><span class="cl">-v /ggcc/mysql/logs:/logs 
</span></span><span class="line"><span class="cl">-v /ggcc/mysql/data:/var/lib/mysql 
</span></span><span class="line"><span class="cl">-e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="m">123456</span> -d mysql:5.6
</span></span><span class="line"><span class="cl">----------------------------------------------
</span></span><span class="line"><span class="cl">命令说明:
</span></span><span class="line"><span class="cl">-p 12345:3306:将主机的12345端口映射到docker容器的3306端口。
</span></span><span class="line"><span class="cl">-name mysq:运行服务名字
</span></span><span class="line"><span class="cl">-V /ggcc/mysql/conf:/etc/mysql/conf.d :将主机/zzyyuse/mysq<span class="p">|</span>录下的conf/my.cnf挂载到容器的/etc/mysql/conf.d
</span></span><span class="line"><span class="cl">-v /ggcc/mysqlogs/logs: 将主机/zzyyuse/mysq<span class="p">|</span>目 录下的logs 目录挂载到容器的/logs。
</span></span><span class="line"><span class="cl">-V /ggcc/mysqldata:/var/lib/mysql :将主机lzzyyuse/mysql目录下的data目录挂载到容器的/var/lib/mysql .
</span></span><span class="line"><span class="cl">-e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>123456: 初始化root用户的密码。.
</span></span><span class="line"><span class="cl">-d mysql:5.6:后台程序运行mysql5.6 
</span></span><span class="line"><span class="cl">----------------------------------------------
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it Mysql运行成功后的容器ID /bin/bash
</span></span><span class="line"><span class="cl">----------------------------------------------
</span></span><span class="line"><span class="cl">数据备份小测试
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> mysql服务容器ID sh -c <span class="s1">&#39;exec mysqldump --all-databases -uroot -p&#34;123456&#34;&#39;</span> &gt;/ggcc/all-database.sql
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_11-59-32.png" alt=""></p>
<h4 id="数据备份测试">数据备份测试</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-02-59.png" alt=""></p>
<h3 id="安装redis">安装Redis</h3>
<h4 id="从docker-hu上阿里云加速器拉取redis镜像到本地标签为32">从docker hu上(阿里云加速器)拉取redis镜像到本地标签为：3.2</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-05-08.png" alt=""></p>
<h4 id="使用redis32镜像创建容器也叫运行镜像">使用redis3.2镜像创建容器(也叫运行镜像)</h4>
<p>​	使用镜像</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -p 6379:6379 -v /ggcc/myredis/data:/data -v /ggcc/myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf -d redis redis-server /usr/local/etc/redis/redis.conf --appendonly yes
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="在主机ggccmyredisconfredisconf目录上新建redisconf文件">在主机/ggcc/myredis/conf/redis.conf目录上新建redis.conf文件</h4>
<p>vim /ggcc/myredis/conf/redis.conf/redis.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">   1
</span><span class="lnt">   2
</span><span class="lnt">   3
</span><span class="lnt">   4
</span><span class="lnt">   5
</span><span class="lnt">   6
</span><span class="lnt">   7
</span><span class="lnt">   8
</span><span class="lnt">   9
</span><span class="lnt">  10
</span><span class="lnt">  11
</span><span class="lnt">  12
</span><span class="lnt">  13
</span><span class="lnt">  14
</span><span class="lnt">  15
</span><span class="lnt">  16
</span><span class="lnt">  17
</span><span class="lnt">  18
</span><span class="lnt">  19
</span><span class="lnt">  20
</span><span class="lnt">  21
</span><span class="lnt">  22
</span><span class="lnt">  23
</span><span class="lnt">  24
</span><span class="lnt">  25
</span><span class="lnt">  26
</span><span class="lnt">  27
</span><span class="lnt">  28
</span><span class="lnt">  29
</span><span class="lnt">  30
</span><span class="lnt">  31
</span><span class="lnt">  32
</span><span class="lnt">  33
</span><span class="lnt">  34
</span><span class="lnt">  35
</span><span class="lnt">  36
</span><span class="lnt">  37
</span><span class="lnt">  38
</span><span class="lnt">  39
</span><span class="lnt">  40
</span><span class="lnt">  41
</span><span class="lnt">  42
</span><span class="lnt">  43
</span><span class="lnt">  44
</span><span class="lnt">  45
</span><span class="lnt">  46
</span><span class="lnt">  47
</span><span class="lnt">  48
</span><span class="lnt">  49
</span><span class="lnt">  50
</span><span class="lnt">  51
</span><span class="lnt">  52
</span><span class="lnt">  53
</span><span class="lnt">  54
</span><span class="lnt">  55
</span><span class="lnt">  56
</span><span class="lnt">  57
</span><span class="lnt">  58
</span><span class="lnt">  59
</span><span class="lnt">  60
</span><span class="lnt">  61
</span><span class="lnt">  62
</span><span class="lnt">  63
</span><span class="lnt">  64
</span><span class="lnt">  65
</span><span class="lnt">  66
</span><span class="lnt">  67
</span><span class="lnt">  68
</span><span class="lnt">  69
</span><span class="lnt">  70
</span><span class="lnt">  71
</span><span class="lnt">  72
</span><span class="lnt">  73
</span><span class="lnt">  74
</span><span class="lnt">  75
</span><span class="lnt">  76
</span><span class="lnt">  77
</span><span class="lnt">  78
</span><span class="lnt">  79
</span><span class="lnt">  80
</span><span class="lnt">  81
</span><span class="lnt">  82
</span><span class="lnt">  83
</span><span class="lnt">  84
</span><span class="lnt">  85
</span><span class="lnt">  86
</span><span class="lnt">  87
</span><span class="lnt">  88
</span><span class="lnt">  89
</span><span class="lnt">  90
</span><span class="lnt">  91
</span><span class="lnt">  92
</span><span class="lnt">  93
</span><span class="lnt">  94
</span><span class="lnt">  95
</span><span class="lnt">  96
</span><span class="lnt">  97
</span><span class="lnt">  98
</span><span class="lnt">  99
</span><span class="lnt"> 100
</span><span class="lnt"> 101
</span><span class="lnt"> 102
</span><span class="lnt"> 103
</span><span class="lnt"> 104
</span><span class="lnt"> 105
</span><span class="lnt"> 106
</span><span class="lnt"> 107
</span><span class="lnt"> 108
</span><span class="lnt"> 109
</span><span class="lnt"> 110
</span><span class="lnt"> 111
</span><span class="lnt"> 112
</span><span class="lnt"> 113
</span><span class="lnt"> 114
</span><span class="lnt"> 115
</span><span class="lnt"> 116
</span><span class="lnt"> 117
</span><span class="lnt"> 118
</span><span class="lnt"> 119
</span><span class="lnt"> 120
</span><span class="lnt"> 121
</span><span class="lnt"> 122
</span><span class="lnt"> 123
</span><span class="lnt"> 124
</span><span class="lnt"> 125
</span><span class="lnt"> 126
</span><span class="lnt"> 127
</span><span class="lnt"> 128
</span><span class="lnt"> 129
</span><span class="lnt"> 130
</span><span class="lnt"> 131
</span><span class="lnt"> 132
</span><span class="lnt"> 133
</span><span class="lnt"> 134
</span><span class="lnt"> 135
</span><span class="lnt"> 136
</span><span class="lnt"> 137
</span><span class="lnt"> 138
</span><span class="lnt"> 139
</span><span class="lnt"> 140
</span><span class="lnt"> 141
</span><span class="lnt"> 142
</span><span class="lnt"> 143
</span><span class="lnt"> 144
</span><span class="lnt"> 145
</span><span class="lnt"> 146
</span><span class="lnt"> 147
</span><span class="lnt"> 148
</span><span class="lnt"> 149
</span><span class="lnt"> 150
</span><span class="lnt"> 151
</span><span class="lnt"> 152
</span><span class="lnt"> 153
</span><span class="lnt"> 154
</span><span class="lnt"> 155
</span><span class="lnt"> 156
</span><span class="lnt"> 157
</span><span class="lnt"> 158
</span><span class="lnt"> 159
</span><span class="lnt"> 160
</span><span class="lnt"> 161
</span><span class="lnt"> 162
</span><span class="lnt"> 163
</span><span class="lnt"> 164
</span><span class="lnt"> 165
</span><span class="lnt"> 166
</span><span class="lnt"> 167
</span><span class="lnt"> 168
</span><span class="lnt"> 169
</span><span class="lnt"> 170
</span><span class="lnt"> 171
</span><span class="lnt"> 172
</span><span class="lnt"> 173
</span><span class="lnt"> 174
</span><span class="lnt"> 175
</span><span class="lnt"> 176
</span><span class="lnt"> 177
</span><span class="lnt"> 178
</span><span class="lnt"> 179
</span><span class="lnt"> 180
</span><span class="lnt"> 181
</span><span class="lnt"> 182
</span><span class="lnt"> 183
</span><span class="lnt"> 184
</span><span class="lnt"> 185
</span><span class="lnt"> 186
</span><span class="lnt"> 187
</span><span class="lnt"> 188
</span><span class="lnt"> 189
</span><span class="lnt"> 190
</span><span class="lnt"> 191
</span><span class="lnt"> 192
</span><span class="lnt"> 193
</span><span class="lnt"> 194
</span><span class="lnt"> 195
</span><span class="lnt"> 196
</span><span class="lnt"> 197
</span><span class="lnt"> 198
</span><span class="lnt"> 199
</span><span class="lnt"> 200
</span><span class="lnt"> 201
</span><span class="lnt"> 202
</span><span class="lnt"> 203
</span><span class="lnt"> 204
</span><span class="lnt"> 205
</span><span class="lnt"> 206
</span><span class="lnt"> 207
</span><span class="lnt"> 208
</span><span class="lnt"> 209
</span><span class="lnt"> 210
</span><span class="lnt"> 211
</span><span class="lnt"> 212
</span><span class="lnt"> 213
</span><span class="lnt"> 214
</span><span class="lnt"> 215
</span><span class="lnt"> 216
</span><span class="lnt"> 217
</span><span class="lnt"> 218
</span><span class="lnt"> 219
</span><span class="lnt"> 220
</span><span class="lnt"> 221
</span><span class="lnt"> 222
</span><span class="lnt"> 223
</span><span class="lnt"> 224
</span><span class="lnt"> 225
</span><span class="lnt"> 226
</span><span class="lnt"> 227
</span><span class="lnt"> 228
</span><span class="lnt"> 229
</span><span class="lnt"> 230
</span><span class="lnt"> 231
</span><span class="lnt"> 232
</span><span class="lnt"> 233
</span><span class="lnt"> 234
</span><span class="lnt"> 235
</span><span class="lnt"> 236
</span><span class="lnt"> 237
</span><span class="lnt"> 238
</span><span class="lnt"> 239
</span><span class="lnt"> 240
</span><span class="lnt"> 241
</span><span class="lnt"> 242
</span><span class="lnt"> 243
</span><span class="lnt"> 244
</span><span class="lnt"> 245
</span><span class="lnt"> 246
</span><span class="lnt"> 247
</span><span class="lnt"> 248
</span><span class="lnt"> 249
</span><span class="lnt"> 250
</span><span class="lnt"> 251
</span><span class="lnt"> 252
</span><span class="lnt"> 253
</span><span class="lnt"> 254
</span><span class="lnt"> 255
</span><span class="lnt"> 256
</span><span class="lnt"> 257
</span><span class="lnt"> 258
</span><span class="lnt"> 259
</span><span class="lnt"> 260
</span><span class="lnt"> 261
</span><span class="lnt"> 262
</span><span class="lnt"> 263
</span><span class="lnt"> 264
</span><span class="lnt"> 265
</span><span class="lnt"> 266
</span><span class="lnt"> 267
</span><span class="lnt"> 268
</span><span class="lnt"> 269
</span><span class="lnt"> 270
</span><span class="lnt"> 271
</span><span class="lnt"> 272
</span><span class="lnt"> 273
</span><span class="lnt"> 274
</span><span class="lnt"> 275
</span><span class="lnt"> 276
</span><span class="lnt"> 277
</span><span class="lnt"> 278
</span><span class="lnt"> 279
</span><span class="lnt"> 280
</span><span class="lnt"> 281
</span><span class="lnt"> 282
</span><span class="lnt"> 283
</span><span class="lnt"> 284
</span><span class="lnt"> 285
</span><span class="lnt"> 286
</span><span class="lnt"> 287
</span><span class="lnt"> 288
</span><span class="lnt"> 289
</span><span class="lnt"> 290
</span><span class="lnt"> 291
</span><span class="lnt"> 292
</span><span class="lnt"> 293
</span><span class="lnt"> 294
</span><span class="lnt"> 295
</span><span class="lnt"> 296
</span><span class="lnt"> 297
</span><span class="lnt"> 298
</span><span class="lnt"> 299
</span><span class="lnt"> 300
</span><span class="lnt"> 301
</span><span class="lnt"> 302
</span><span class="lnt"> 303
</span><span class="lnt"> 304
</span><span class="lnt"> 305
</span><span class="lnt"> 306
</span><span class="lnt"> 307
</span><span class="lnt"> 308
</span><span class="lnt"> 309
</span><span class="lnt"> 310
</span><span class="lnt"> 311
</span><span class="lnt"> 312
</span><span class="lnt"> 313
</span><span class="lnt"> 314
</span><span class="lnt"> 315
</span><span class="lnt"> 316
</span><span class="lnt"> 317
</span><span class="lnt"> 318
</span><span class="lnt"> 319
</span><span class="lnt"> 320
</span><span class="lnt"> 321
</span><span class="lnt"> 322
</span><span class="lnt"> 323
</span><span class="lnt"> 324
</span><span class="lnt"> 325
</span><span class="lnt"> 326
</span><span class="lnt"> 327
</span><span class="lnt"> 328
</span><span class="lnt"> 329
</span><span class="lnt"> 330
</span><span class="lnt"> 331
</span><span class="lnt"> 332
</span><span class="lnt"> 333
</span><span class="lnt"> 334
</span><span class="lnt"> 335
</span><span class="lnt"> 336
</span><span class="lnt"> 337
</span><span class="lnt"> 338
</span><span class="lnt"> 339
</span><span class="lnt"> 340
</span><span class="lnt"> 341
</span><span class="lnt"> 342
</span><span class="lnt"> 343
</span><span class="lnt"> 344
</span><span class="lnt"> 345
</span><span class="lnt"> 346
</span><span class="lnt"> 347
</span><span class="lnt"> 348
</span><span class="lnt"> 349
</span><span class="lnt"> 350
</span><span class="lnt"> 351
</span><span class="lnt"> 352
</span><span class="lnt"> 353
</span><span class="lnt"> 354
</span><span class="lnt"> 355
</span><span class="lnt"> 356
</span><span class="lnt"> 357
</span><span class="lnt"> 358
</span><span class="lnt"> 359
</span><span class="lnt"> 360
</span><span class="lnt"> 361
</span><span class="lnt"> 362
</span><span class="lnt"> 363
</span><span class="lnt"> 364
</span><span class="lnt"> 365
</span><span class="lnt"> 366
</span><span class="lnt"> 367
</span><span class="lnt"> 368
</span><span class="lnt"> 369
</span><span class="lnt"> 370
</span><span class="lnt"> 371
</span><span class="lnt"> 372
</span><span class="lnt"> 373
</span><span class="lnt"> 374
</span><span class="lnt"> 375
</span><span class="lnt"> 376
</span><span class="lnt"> 377
</span><span class="lnt"> 378
</span><span class="lnt"> 379
</span><span class="lnt"> 380
</span><span class="lnt"> 381
</span><span class="lnt"> 382
</span><span class="lnt"> 383
</span><span class="lnt"> 384
</span><span class="lnt"> 385
</span><span class="lnt"> 386
</span><span class="lnt"> 387
</span><span class="lnt"> 388
</span><span class="lnt"> 389
</span><span class="lnt"> 390
</span><span class="lnt"> 391
</span><span class="lnt"> 392
</span><span class="lnt"> 393
</span><span class="lnt"> 394
</span><span class="lnt"> 395
</span><span class="lnt"> 396
</span><span class="lnt"> 397
</span><span class="lnt"> 398
</span><span class="lnt"> 399
</span><span class="lnt"> 400
</span><span class="lnt"> 401
</span><span class="lnt"> 402
</span><span class="lnt"> 403
</span><span class="lnt"> 404
</span><span class="lnt"> 405
</span><span class="lnt"> 406
</span><span class="lnt"> 407
</span><span class="lnt"> 408
</span><span class="lnt"> 409
</span><span class="lnt"> 410
</span><span class="lnt"> 411
</span><span class="lnt"> 412
</span><span class="lnt"> 413
</span><span class="lnt"> 414
</span><span class="lnt"> 415
</span><span class="lnt"> 416
</span><span class="lnt"> 417
</span><span class="lnt"> 418
</span><span class="lnt"> 419
</span><span class="lnt"> 420
</span><span class="lnt"> 421
</span><span class="lnt"> 422
</span><span class="lnt"> 423
</span><span class="lnt"> 424
</span><span class="lnt"> 425
</span><span class="lnt"> 426
</span><span class="lnt"> 427
</span><span class="lnt"> 428
</span><span class="lnt"> 429
</span><span class="lnt"> 430
</span><span class="lnt"> 431
</span><span class="lnt"> 432
</span><span class="lnt"> 433
</span><span class="lnt"> 434
</span><span class="lnt"> 435
</span><span class="lnt"> 436
</span><span class="lnt"> 437
</span><span class="lnt"> 438
</span><span class="lnt"> 439
</span><span class="lnt"> 440
</span><span class="lnt"> 441
</span><span class="lnt"> 442
</span><span class="lnt"> 443
</span><span class="lnt"> 444
</span><span class="lnt"> 445
</span><span class="lnt"> 446
</span><span class="lnt"> 447
</span><span class="lnt"> 448
</span><span class="lnt"> 449
</span><span class="lnt"> 450
</span><span class="lnt"> 451
</span><span class="lnt"> 452
</span><span class="lnt"> 453
</span><span class="lnt"> 454
</span><span class="lnt"> 455
</span><span class="lnt"> 456
</span><span class="lnt"> 457
</span><span class="lnt"> 458
</span><span class="lnt"> 459
</span><span class="lnt"> 460
</span><span class="lnt"> 461
</span><span class="lnt"> 462
</span><span class="lnt"> 463
</span><span class="lnt"> 464
</span><span class="lnt"> 465
</span><span class="lnt"> 466
</span><span class="lnt"> 467
</span><span class="lnt"> 468
</span><span class="lnt"> 469
</span><span class="lnt"> 470
</span><span class="lnt"> 471
</span><span class="lnt"> 472
</span><span class="lnt"> 473
</span><span class="lnt"> 474
</span><span class="lnt"> 475
</span><span class="lnt"> 476
</span><span class="lnt"> 477
</span><span class="lnt"> 478
</span><span class="lnt"> 479
</span><span class="lnt"> 480
</span><span class="lnt"> 481
</span><span class="lnt"> 482
</span><span class="lnt"> 483
</span><span class="lnt"> 484
</span><span class="lnt"> 485
</span><span class="lnt"> 486
</span><span class="lnt"> 487
</span><span class="lnt"> 488
</span><span class="lnt"> 489
</span><span class="lnt"> 490
</span><span class="lnt"> 491
</span><span class="lnt"> 492
</span><span class="lnt"> 493
</span><span class="lnt"> 494
</span><span class="lnt"> 495
</span><span class="lnt"> 496
</span><span class="lnt"> 497
</span><span class="lnt"> 498
</span><span class="lnt"> 499
</span><span class="lnt"> 500
</span><span class="lnt"> 501
</span><span class="lnt"> 502
</span><span class="lnt"> 503
</span><span class="lnt"> 504
</span><span class="lnt"> 505
</span><span class="lnt"> 506
</span><span class="lnt"> 507
</span><span class="lnt"> 508
</span><span class="lnt"> 509
</span><span class="lnt"> 510
</span><span class="lnt"> 511
</span><span class="lnt"> 512
</span><span class="lnt"> 513
</span><span class="lnt"> 514
</span><span class="lnt"> 515
</span><span class="lnt"> 516
</span><span class="lnt"> 517
</span><span class="lnt"> 518
</span><span class="lnt"> 519
</span><span class="lnt"> 520
</span><span class="lnt"> 521
</span><span class="lnt"> 522
</span><span class="lnt"> 523
</span><span class="lnt"> 524
</span><span class="lnt"> 525
</span><span class="lnt"> 526
</span><span class="lnt"> 527
</span><span class="lnt"> 528
</span><span class="lnt"> 529
</span><span class="lnt"> 530
</span><span class="lnt"> 531
</span><span class="lnt"> 532
</span><span class="lnt"> 533
</span><span class="lnt"> 534
</span><span class="lnt"> 535
</span><span class="lnt"> 536
</span><span class="lnt"> 537
</span><span class="lnt"> 538
</span><span class="lnt"> 539
</span><span class="lnt"> 540
</span><span class="lnt"> 541
</span><span class="lnt"> 542
</span><span class="lnt"> 543
</span><span class="lnt"> 544
</span><span class="lnt"> 545
</span><span class="lnt"> 546
</span><span class="lnt"> 547
</span><span class="lnt"> 548
</span><span class="lnt"> 549
</span><span class="lnt"> 550
</span><span class="lnt"> 551
</span><span class="lnt"> 552
</span><span class="lnt"> 553
</span><span class="lnt"> 554
</span><span class="lnt"> 555
</span><span class="lnt"> 556
</span><span class="lnt"> 557
</span><span class="lnt"> 558
</span><span class="lnt"> 559
</span><span class="lnt"> 560
</span><span class="lnt"> 561
</span><span class="lnt"> 562
</span><span class="lnt"> 563
</span><span class="lnt"> 564
</span><span class="lnt"> 565
</span><span class="lnt"> 566
</span><span class="lnt"> 567
</span><span class="lnt"> 568
</span><span class="lnt"> 569
</span><span class="lnt"> 570
</span><span class="lnt"> 571
</span><span class="lnt"> 572
</span><span class="lnt"> 573
</span><span class="lnt"> 574
</span><span class="lnt"> 575
</span><span class="lnt"> 576
</span><span class="lnt"> 577
</span><span class="lnt"> 578
</span><span class="lnt"> 579
</span><span class="lnt"> 580
</span><span class="lnt"> 581
</span><span class="lnt"> 582
</span><span class="lnt"> 583
</span><span class="lnt"> 584
</span><span class="lnt"> 585
</span><span class="lnt"> 586
</span><span class="lnt"> 587
</span><span class="lnt"> 588
</span><span class="lnt"> 589
</span><span class="lnt"> 590
</span><span class="lnt"> 591
</span><span class="lnt"> 592
</span><span class="lnt"> 593
</span><span class="lnt"> 594
</span><span class="lnt"> 595
</span><span class="lnt"> 596
</span><span class="lnt"> 597
</span><span class="lnt"> 598
</span><span class="lnt"> 599
</span><span class="lnt"> 600
</span><span class="lnt"> 601
</span><span class="lnt"> 602
</span><span class="lnt"> 603
</span><span class="lnt"> 604
</span><span class="lnt"> 605
</span><span class="lnt"> 606
</span><span class="lnt"> 607
</span><span class="lnt"> 608
</span><span class="lnt"> 609
</span><span class="lnt"> 610
</span><span class="lnt"> 611
</span><span class="lnt"> 612
</span><span class="lnt"> 613
</span><span class="lnt"> 614
</span><span class="lnt"> 615
</span><span class="lnt"> 616
</span><span class="lnt"> 617
</span><span class="lnt"> 618
</span><span class="lnt"> 619
</span><span class="lnt"> 620
</span><span class="lnt"> 621
</span><span class="lnt"> 622
</span><span class="lnt"> 623
</span><span class="lnt"> 624
</span><span class="lnt"> 625
</span><span class="lnt"> 626
</span><span class="lnt"> 627
</span><span class="lnt"> 628
</span><span class="lnt"> 629
</span><span class="lnt"> 630
</span><span class="lnt"> 631
</span><span class="lnt"> 632
</span><span class="lnt"> 633
</span><span class="lnt"> 634
</span><span class="lnt"> 635
</span><span class="lnt"> 636
</span><span class="lnt"> 637
</span><span class="lnt"> 638
</span><span class="lnt"> 639
</span><span class="lnt"> 640
</span><span class="lnt"> 641
</span><span class="lnt"> 642
</span><span class="lnt"> 643
</span><span class="lnt"> 644
</span><span class="lnt"> 645
</span><span class="lnt"> 646
</span><span class="lnt"> 647
</span><span class="lnt"> 648
</span><span class="lnt"> 649
</span><span class="lnt"> 650
</span><span class="lnt"> 651
</span><span class="lnt"> 652
</span><span class="lnt"> 653
</span><span class="lnt"> 654
</span><span class="lnt"> 655
</span><span class="lnt"> 656
</span><span class="lnt"> 657
</span><span class="lnt"> 658
</span><span class="lnt"> 659
</span><span class="lnt"> 660
</span><span class="lnt"> 661
</span><span class="lnt"> 662
</span><span class="lnt"> 663
</span><span class="lnt"> 664
</span><span class="lnt"> 665
</span><span class="lnt"> 666
</span><span class="lnt"> 667
</span><span class="lnt"> 668
</span><span class="lnt"> 669
</span><span class="lnt"> 670
</span><span class="lnt"> 671
</span><span class="lnt"> 672
</span><span class="lnt"> 673
</span><span class="lnt"> 674
</span><span class="lnt"> 675
</span><span class="lnt"> 676
</span><span class="lnt"> 677
</span><span class="lnt"> 678
</span><span class="lnt"> 679
</span><span class="lnt"> 680
</span><span class="lnt"> 681
</span><span class="lnt"> 682
</span><span class="lnt"> 683
</span><span class="lnt"> 684
</span><span class="lnt"> 685
</span><span class="lnt"> 686
</span><span class="lnt"> 687
</span><span class="lnt"> 688
</span><span class="lnt"> 689
</span><span class="lnt"> 690
</span><span class="lnt"> 691
</span><span class="lnt"> 692
</span><span class="lnt"> 693
</span><span class="lnt"> 694
</span><span class="lnt"> 695
</span><span class="lnt"> 696
</span><span class="lnt"> 697
</span><span class="lnt"> 698
</span><span class="lnt"> 699
</span><span class="lnt"> 700
</span><span class="lnt"> 701
</span><span class="lnt"> 702
</span><span class="lnt"> 703
</span><span class="lnt"> 704
</span><span class="lnt"> 705
</span><span class="lnt"> 706
</span><span class="lnt"> 707
</span><span class="lnt"> 708
</span><span class="lnt"> 709
</span><span class="lnt"> 710
</span><span class="lnt"> 711
</span><span class="lnt"> 712
</span><span class="lnt"> 713
</span><span class="lnt"> 714
</span><span class="lnt"> 715
</span><span class="lnt"> 716
</span><span class="lnt"> 717
</span><span class="lnt"> 718
</span><span class="lnt"> 719
</span><span class="lnt"> 720
</span><span class="lnt"> 721
</span><span class="lnt"> 722
</span><span class="lnt"> 723
</span><span class="lnt"> 724
</span><span class="lnt"> 725
</span><span class="lnt"> 726
</span><span class="lnt"> 727
</span><span class="lnt"> 728
</span><span class="lnt"> 729
</span><span class="lnt"> 730
</span><span class="lnt"> 731
</span><span class="lnt"> 732
</span><span class="lnt"> 733
</span><span class="lnt"> 734
</span><span class="lnt"> 735
</span><span class="lnt"> 736
</span><span class="lnt"> 737
</span><span class="lnt"> 738
</span><span class="lnt"> 739
</span><span class="lnt"> 740
</span><span class="lnt"> 741
</span><span class="lnt"> 742
</span><span class="lnt"> 743
</span><span class="lnt"> 744
</span><span class="lnt"> 745
</span><span class="lnt"> 746
</span><span class="lnt"> 747
</span><span class="lnt"> 748
</span><span class="lnt"> 749
</span><span class="lnt"> 750
</span><span class="lnt"> 751
</span><span class="lnt"> 752
</span><span class="lnt"> 753
</span><span class="lnt"> 754
</span><span class="lnt"> 755
</span><span class="lnt"> 756
</span><span class="lnt"> 757
</span><span class="lnt"> 758
</span><span class="lnt"> 759
</span><span class="lnt"> 760
</span><span class="lnt"> 761
</span><span class="lnt"> 762
</span><span class="lnt"> 763
</span><span class="lnt"> 764
</span><span class="lnt"> 765
</span><span class="lnt"> 766
</span><span class="lnt"> 767
</span><span class="lnt"> 768
</span><span class="lnt"> 769
</span><span class="lnt"> 770
</span><span class="lnt"> 771
</span><span class="lnt"> 772
</span><span class="lnt"> 773
</span><span class="lnt"> 774
</span><span class="lnt"> 775
</span><span class="lnt"> 776
</span><span class="lnt"> 777
</span><span class="lnt"> 778
</span><span class="lnt"> 779
</span><span class="lnt"> 780
</span><span class="lnt"> 781
</span><span class="lnt"> 782
</span><span class="lnt"> 783
</span><span class="lnt"> 784
</span><span class="lnt"> 785
</span><span class="lnt"> 786
</span><span class="lnt"> 787
</span><span class="lnt"> 788
</span><span class="lnt"> 789
</span><span class="lnt"> 790
</span><span class="lnt"> 791
</span><span class="lnt"> 792
</span><span class="lnt"> 793
</span><span class="lnt"> 794
</span><span class="lnt"> 795
</span><span class="lnt"> 796
</span><span class="lnt"> 797
</span><span class="lnt"> 798
</span><span class="lnt"> 799
</span><span class="lnt"> 800
</span><span class="lnt"> 801
</span><span class="lnt"> 802
</span><span class="lnt"> 803
</span><span class="lnt"> 804
</span><span class="lnt"> 805
</span><span class="lnt"> 806
</span><span class="lnt"> 807
</span><span class="lnt"> 808
</span><span class="lnt"> 809
</span><span class="lnt"> 810
</span><span class="lnt"> 811
</span><span class="lnt"> 812
</span><span class="lnt"> 813
</span><span class="lnt"> 814
</span><span class="lnt"> 815
</span><span class="lnt"> 816
</span><span class="lnt"> 817
</span><span class="lnt"> 818
</span><span class="lnt"> 819
</span><span class="lnt"> 820
</span><span class="lnt"> 821
</span><span class="lnt"> 822
</span><span class="lnt"> 823
</span><span class="lnt"> 824
</span><span class="lnt"> 825
</span><span class="lnt"> 826
</span><span class="lnt"> 827
</span><span class="lnt"> 828
</span><span class="lnt"> 829
</span><span class="lnt"> 830
</span><span class="lnt"> 831
</span><span class="lnt"> 832
</span><span class="lnt"> 833
</span><span class="lnt"> 834
</span><span class="lnt"> 835
</span><span class="lnt"> 836
</span><span class="lnt"> 837
</span><span class="lnt"> 838
</span><span class="lnt"> 839
</span><span class="lnt"> 840
</span><span class="lnt"> 841
</span><span class="lnt"> 842
</span><span class="lnt"> 843
</span><span class="lnt"> 844
</span><span class="lnt"> 845
</span><span class="lnt"> 846
</span><span class="lnt"> 847
</span><span class="lnt"> 848
</span><span class="lnt"> 849
</span><span class="lnt"> 850
</span><span class="lnt"> 851
</span><span class="lnt"> 852
</span><span class="lnt"> 853
</span><span class="lnt"> 854
</span><span class="lnt"> 855
</span><span class="lnt"> 856
</span><span class="lnt"> 857
</span><span class="lnt"> 858
</span><span class="lnt"> 859
</span><span class="lnt"> 860
</span><span class="lnt"> 861
</span><span class="lnt"> 862
</span><span class="lnt"> 863
</span><span class="lnt"> 864
</span><span class="lnt"> 865
</span><span class="lnt"> 866
</span><span class="lnt"> 867
</span><span class="lnt"> 868
</span><span class="lnt"> 869
</span><span class="lnt"> 870
</span><span class="lnt"> 871
</span><span class="lnt"> 872
</span><span class="lnt"> 873
</span><span class="lnt"> 874
</span><span class="lnt"> 875
</span><span class="lnt"> 876
</span><span class="lnt"> 877
</span><span class="lnt"> 878
</span><span class="lnt"> 879
</span><span class="lnt"> 880
</span><span class="lnt"> 881
</span><span class="lnt"> 882
</span><span class="lnt"> 883
</span><span class="lnt"> 884
</span><span class="lnt"> 885
</span><span class="lnt"> 886
</span><span class="lnt"> 887
</span><span class="lnt"> 888
</span><span class="lnt"> 889
</span><span class="lnt"> 890
</span><span class="lnt"> 891
</span><span class="lnt"> 892
</span><span class="lnt"> 893
</span><span class="lnt"> 894
</span><span class="lnt"> 895
</span><span class="lnt"> 896
</span><span class="lnt"> 897
</span><span class="lnt"> 898
</span><span class="lnt"> 899
</span><span class="lnt"> 900
</span><span class="lnt"> 901
</span><span class="lnt"> 902
</span><span class="lnt"> 903
</span><span class="lnt"> 904
</span><span class="lnt"> 905
</span><span class="lnt"> 906
</span><span class="lnt"> 907
</span><span class="lnt"> 908
</span><span class="lnt"> 909
</span><span class="lnt"> 910
</span><span class="lnt"> 911
</span><span class="lnt"> 912
</span><span class="lnt"> 913
</span><span class="lnt"> 914
</span><span class="lnt"> 915
</span><span class="lnt"> 916
</span><span class="lnt"> 917
</span><span class="lnt"> 918
</span><span class="lnt"> 919
</span><span class="lnt"> 920
</span><span class="lnt"> 921
</span><span class="lnt"> 922
</span><span class="lnt"> 923
</span><span class="lnt"> 924
</span><span class="lnt"> 925
</span><span class="lnt"> 926
</span><span class="lnt"> 927
</span><span class="lnt"> 928
</span><span class="lnt"> 929
</span><span class="lnt"> 930
</span><span class="lnt"> 931
</span><span class="lnt"> 932
</span><span class="lnt"> 933
</span><span class="lnt"> 934
</span><span class="lnt"> 935
</span><span class="lnt"> 936
</span><span class="lnt"> 937
</span><span class="lnt"> 938
</span><span class="lnt"> 939
</span><span class="lnt"> 940
</span><span class="lnt"> 941
</span><span class="lnt"> 942
</span><span class="lnt"> 943
</span><span class="lnt"> 944
</span><span class="lnt"> 945
</span><span class="lnt"> 946
</span><span class="lnt"> 947
</span><span class="lnt"> 948
</span><span class="lnt"> 949
</span><span class="lnt"> 950
</span><span class="lnt"> 951
</span><span class="lnt"> 952
</span><span class="lnt"> 953
</span><span class="lnt"> 954
</span><span class="lnt"> 955
</span><span class="lnt"> 956
</span><span class="lnt"> 957
</span><span class="lnt"> 958
</span><span class="lnt"> 959
</span><span class="lnt"> 960
</span><span class="lnt"> 961
</span><span class="lnt"> 962
</span><span class="lnt"> 963
</span><span class="lnt"> 964
</span><span class="lnt"> 965
</span><span class="lnt"> 966
</span><span class="lnt"> 967
</span><span class="lnt"> 968
</span><span class="lnt"> 969
</span><span class="lnt"> 970
</span><span class="lnt"> 971
</span><span class="lnt"> 972
</span><span class="lnt"> 973
</span><span class="lnt"> 974
</span><span class="lnt"> 975
</span><span class="lnt"> 976
</span><span class="lnt"> 977
</span><span class="lnt"> 978
</span><span class="lnt"> 979
</span><span class="lnt"> 980
</span><span class="lnt"> 981
</span><span class="lnt"> 982
</span><span class="lnt"> 983
</span><span class="lnt"> 984
</span><span class="lnt"> 985
</span><span class="lnt"> 986
</span><span class="lnt"> 987
</span><span class="lnt"> 988
</span><span class="lnt"> 989
</span><span class="lnt"> 990
</span><span class="lnt"> 991
</span><span class="lnt"> 992
</span><span class="lnt"> 993
</span><span class="lnt"> 994
</span><span class="lnt"> 995
</span><span class="lnt"> 996
</span><span class="lnt"> 997
</span><span class="lnt"> 998
</span><span class="lnt"> 999
</span><span class="lnt">1000
</span><span class="lnt">1001
</span><span class="lnt">1002
</span><span class="lnt">1003
</span><span class="lnt">1004
</span><span class="lnt">1005
</span><span class="lnt">1006
</span><span class="lnt">1007
</span><span class="lnt">1008
</span><span class="lnt">1009
</span><span class="lnt">1010
</span><span class="lnt">1011
</span><span class="lnt">1012
</span><span class="lnt">1013
</span><span class="lnt">1014
</span><span class="lnt">1015
</span><span class="lnt">1016
</span><span class="lnt">1017
</span><span class="lnt">1018
</span><span class="lnt">1019
</span><span class="lnt">1020
</span><span class="lnt">1021
</span><span class="lnt">1022
</span><span class="lnt">1023
</span><span class="lnt">1024
</span><span class="lnt">1025
</span><span class="lnt">1026
</span><span class="lnt">1027
</span><span class="lnt">1028
</span><span class="lnt">1029
</span><span class="lnt">1030
</span><span class="lnt">1031
</span><span class="lnt">1032
</span><span class="lnt">1033
</span><span class="lnt">1034
</span><span class="lnt">1035
</span><span class="lnt">1036
</span><span class="lnt">1037
</span><span class="lnt">1038
</span><span class="lnt">1039
</span><span class="lnt">1040
</span><span class="lnt">1041
</span><span class="lnt">1042
</span><span class="lnt">1043
</span><span class="lnt">1044
</span><span class="lnt">1045
</span><span class="lnt">1046
</span><span class="lnt">1047
</span><span class="lnt">1048
</span><span class="lnt">1049
</span><span class="lnt">1050
</span><span class="lnt">1051
</span><span class="lnt">1052
</span><span class="lnt">1053
</span><span class="lnt">1054
</span><span class="lnt">1055
</span><span class="lnt">1056
</span><span class="lnt">1057
</span><span class="lnt">1058
</span><span class="lnt">1059
</span><span class="lnt">1060
</span><span class="lnt">1061
</span><span class="lnt">1062
</span><span class="lnt">1063
</span><span class="lnt">1064
</span><span class="lnt">1065
</span><span class="lnt">1066
</span><span class="lnt">1067
</span><span class="lnt">1068
</span><span class="lnt">1069
</span><span class="lnt">1070
</span><span class="lnt">1071
</span><span class="lnt">1072
</span><span class="lnt">1073
</span><span class="lnt">1074
</span><span class="lnt">1075
</span><span class="lnt">1076
</span><span class="lnt">1077
</span><span class="lnt">1078
</span><span class="lnt">1079
</span><span class="lnt">1080
</span><span class="lnt">1081
</span><span class="lnt">1082
</span><span class="lnt">1083
</span><span class="lnt">1084
</span><span class="lnt">1085
</span><span class="lnt">1086
</span><span class="lnt">1087
</span><span class="lnt">1088
</span><span class="lnt">1089
</span><span class="lnt">1090
</span><span class="lnt">1091
</span><span class="lnt">1092
</span><span class="lnt">1093
</span><span class="lnt">1094
</span><span class="lnt">1095
</span><span class="lnt">1096
</span><span class="lnt">1097
</span><span class="lnt">1098
</span><span class="lnt">1099
</span><span class="lnt">1100
</span><span class="lnt">1101
</span><span class="lnt">1102
</span><span class="lnt">1103
</span><span class="lnt">1104
</span><span class="lnt">1105
</span><span class="lnt">1106
</span><span class="lnt">1107
</span><span class="lnt">1108
</span><span class="lnt">1109
</span><span class="lnt">1110
</span><span class="lnt">1111
</span><span class="lnt">1112
</span><span class="lnt">1113
</span><span class="lnt">1114
</span><span class="lnt">1115
</span><span class="lnt">1116
</span><span class="lnt">1117
</span><span class="lnt">1118
</span><span class="lnt">1119
</span><span class="lnt">1120
</span><span class="lnt">1121
</span><span class="lnt">1122
</span><span class="lnt">1123
</span><span class="lnt">1124
</span><span class="lnt">1125
</span><span class="lnt">1126
</span><span class="lnt">1127
</span><span class="lnt">1128
</span><span class="lnt">1129
</span><span class="lnt">1130
</span><span class="lnt">1131
</span><span class="lnt">1132
</span><span class="lnt">1133
</span><span class="lnt">1134
</span><span class="lnt">1135
</span><span class="lnt">1136
</span><span class="lnt">1137
</span><span class="lnt">1138
</span><span class="lnt">1139
</span><span class="lnt">1140
</span><span class="lnt">1141
</span><span class="lnt">1142
</span><span class="lnt">1143
</span><span class="lnt">1144
</span><span class="lnt">1145
</span><span class="lnt">1146
</span><span class="lnt">1147
</span><span class="lnt">1148
</span><span class="lnt">1149
</span><span class="lnt">1150
</span><span class="lnt">1151
</span><span class="lnt">1152
</span><span class="lnt">1153
</span><span class="lnt">1154
</span><span class="lnt">1155
</span><span class="lnt">1156
</span><span class="lnt">1157
</span><span class="lnt">1158
</span><span class="lnt">1159
</span><span class="lnt">1160
</span><span class="lnt">1161
</span><span class="lnt">1162
</span><span class="lnt">1163
</span><span class="lnt">1164
</span><span class="lnt">1165
</span><span class="lnt">1166
</span><span class="lnt">1167
</span><span class="lnt">1168
</span><span class="lnt">1169
</span><span class="lnt">1170
</span><span class="lnt">1171
</span><span class="lnt">1172
</span><span class="lnt">1173
</span><span class="lnt">1174
</span><span class="lnt">1175
</span><span class="lnt">1176
</span><span class="lnt">1177
</span><span class="lnt">1178
</span><span class="lnt">1179
</span><span class="lnt">1180
</span><span class="lnt">1181
</span><span class="lnt">1182
</span><span class="lnt">1183
</span><span class="lnt">1184
</span><span class="lnt">1185
</span><span class="lnt">1186
</span><span class="lnt">1187
</span><span class="lnt">1188
</span><span class="lnt">1189
</span><span class="lnt">1190
</span><span class="lnt">1191
</span><span class="lnt">1192
</span><span class="lnt">1193
</span><span class="lnt">1194
</span><span class="lnt">1195
</span><span class="lnt">1196
</span><span class="lnt">1197
</span><span class="lnt">1198
</span><span class="lnt">1199
</span><span class="lnt">1200
</span><span class="lnt">1201
</span><span class="lnt">1202
</span><span class="lnt">1203
</span><span class="lnt">1204
</span><span class="lnt">1205
</span><span class="lnt">1206
</span><span class="lnt">1207
</span><span class="lnt">1208
</span><span class="lnt">1209
</span><span class="lnt">1210
</span><span class="lnt">1211
</span><span class="lnt">1212
</span><span class="lnt">1213
</span><span class="lnt">1214
</span><span class="lnt">1215
</span><span class="lnt">1216
</span><span class="lnt">1217
</span><span class="lnt">1218
</span><span class="lnt">1219
</span><span class="lnt">1220
</span><span class="lnt">1221
</span><span class="lnt">1222
</span><span class="lnt">1223
</span><span class="lnt">1224
</span><span class="lnt">1225
</span><span class="lnt">1226
</span><span class="lnt">1227
</span><span class="lnt">1228
</span><span class="lnt">1229
</span><span class="lnt">1230
</span><span class="lnt">1231
</span><span class="lnt">1232
</span><span class="lnt">1233
</span><span class="lnt">1234
</span><span class="lnt">1235
</span><span class="lnt">1236
</span><span class="lnt">1237
</span><span class="lnt">1238
</span><span class="lnt">1239
</span><span class="lnt">1240
</span><span class="lnt">1241
</span><span class="lnt">1242
</span><span class="lnt">1243
</span><span class="lnt">1244
</span><span class="lnt">1245
</span><span class="lnt">1246
</span><span class="lnt">1247
</span><span class="lnt">1248
</span><span class="lnt">1249
</span><span class="lnt">1250
</span><span class="lnt">1251
</span><span class="lnt">1252
</span><span class="lnt">1253
</span><span class="lnt">1254
</span><span class="lnt">1255
</span><span class="lnt">1256
</span><span class="lnt">1257
</span><span class="lnt">1258
</span><span class="lnt">1259
</span><span class="lnt">1260
</span><span class="lnt">1261
</span><span class="lnt">1262
</span><span class="lnt">1263
</span><span class="lnt">1264
</span><span class="lnt">1265
</span><span class="lnt">1266
</span><span class="lnt">1267
</span><span class="lnt">1268
</span><span class="lnt">1269
</span><span class="lnt">1270
</span><span class="lnt">1271
</span><span class="lnt">1272
</span><span class="lnt">1273
</span><span class="lnt">1274
</span><span class="lnt">1275
</span><span class="lnt">1276
</span><span class="lnt">1277
</span><span class="lnt">1278
</span><span class="lnt">1279
</span><span class="lnt">1280
</span><span class="lnt">1281
</span><span class="lnt">1282
</span><span class="lnt">1283
</span><span class="lnt">1284
</span><span class="lnt">1285
</span><span class="lnt">1286
</span><span class="lnt">1287
</span><span class="lnt">1288
</span><span class="lnt">1289
</span><span class="lnt">1290
</span><span class="lnt">1291
</span><span class="lnt">1292
</span><span class="lnt">1293
</span><span class="lnt">1294
</span><span class="lnt">1295
</span><span class="lnt">1296
</span><span class="lnt">1297
</span><span class="lnt">1298
</span><span class="lnt">1299
</span><span class="lnt">1300
</span><span class="lnt">1301
</span><span class="lnt">1302
</span><span class="lnt">1303
</span><span class="lnt">1304
</span><span class="lnt">1305
</span><span class="lnt">1306
</span><span class="lnt">1307
</span><span class="lnt">1308
</span><span class="lnt">1309
</span><span class="lnt">1310
</span><span class="lnt">1311
</span><span class="lnt">1312
</span><span class="lnt">1313
</span><span class="lnt">1314
</span><span class="lnt">1315
</span><span class="lnt">1316
</span><span class="lnt">1317
</span><span class="lnt">1318
</span><span class="lnt">1319
</span><span class="lnt">1320
</span><span class="lnt">1321
</span><span class="lnt">1322
</span><span class="lnt">1323
</span><span class="lnt">1324
</span><span class="lnt">1325
</span><span class="lnt">1326
</span><span class="lnt">1327
</span><span class="lnt">1328
</span><span class="lnt">1329
</span><span class="lnt">1330
</span><span class="lnt">1331
</span><span class="lnt">1332
</span><span class="lnt">1333
</span><span class="lnt">1334
</span><span class="lnt">1335
</span><span class="lnt">1336
</span><span class="lnt">1337
</span><span class="lnt">1338
</span><span class="lnt">1339
</span><span class="lnt">1340
</span><span class="lnt">1341
</span><span class="lnt">1342
</span><span class="lnt">1343
</span><span class="lnt">1344
</span><span class="lnt">1345
</span><span class="lnt">1346
</span><span class="lnt">1347
</span><span class="lnt">1348
</span><span class="lnt">1349
</span><span class="lnt">1350
</span><span class="lnt">1351
</span><span class="lnt">1352
</span><span class="lnt">1353
</span><span class="lnt">1354
</span><span class="lnt">1355
</span><span class="lnt">1356
</span><span class="lnt">1357
</span><span class="lnt">1358
</span><span class="lnt">1359
</span><span class="lnt">1360
</span><span class="lnt">1361
</span><span class="lnt">1362
</span><span class="lnt">1363
</span><span class="lnt">1364
</span><span class="lnt">1365
</span><span class="lnt">1366
</span><span class="lnt">1367
</span><span class="lnt">1368
</span><span class="lnt">1369
</span><span class="lnt">1370
</span><span class="lnt">1371
</span><span class="lnt">1372
</span><span class="lnt">1373
</span><span class="lnt">1374
</span><span class="lnt">1375
</span><span class="lnt">1376
</span><span class="lnt">1377
</span><span class="lnt">1378
</span><span class="lnt">1379
</span><span class="lnt">1380
</span><span class="lnt">1381
</span><span class="lnt">1382
</span><span class="lnt">1383
</span><span class="lnt">1384
</span><span class="lnt">1385
</span><span class="lnt">1386
</span><span class="lnt">1387
</span><span class="lnt">1388
</span><span class="lnt">1389
</span><span class="lnt">1390
</span><span class="lnt">1391
</span><span class="lnt">1392
</span><span class="lnt">1393
</span><span class="lnt">1394
</span><span class="lnt">1395
</span><span class="lnt">1396
</span><span class="lnt">1397
</span><span class="lnt">1398
</span><span class="lnt">1399
</span><span class="lnt">1400
</span><span class="lnt">1401
</span><span class="lnt">1402
</span><span class="lnt">1403
</span><span class="lnt">1404
</span><span class="lnt">1405
</span><span class="lnt">1406
</span><span class="lnt">1407
</span><span class="lnt">1408
</span><span class="lnt">1409
</span><span class="lnt">1410
</span><span class="lnt">1411
</span><span class="lnt">1412
</span><span class="lnt">1413
</span><span class="lnt">1414
</span><span class="lnt">1415
</span><span class="lnt">1416
</span><span class="lnt">1417
</span><span class="lnt">1418
</span><span class="lnt">1419
</span><span class="lnt">1420
</span><span class="lnt">1421
</span><span class="lnt">1422
</span><span class="lnt">1423
</span><span class="lnt">1424
</span><span class="lnt">1425
</span><span class="lnt">1426
</span><span class="lnt">1427
</span><span class="lnt">1428
</span><span class="lnt">1429
</span><span class="lnt">1430
</span><span class="lnt">1431
</span><span class="lnt">1432
</span><span class="lnt">1433
</span><span class="lnt">1434
</span><span class="lnt">1435
</span><span class="lnt">1436
</span><span class="lnt">1437
</span><span class="lnt">1438
</span><span class="lnt">1439
</span><span class="lnt">1440
</span><span class="lnt">1441
</span><span class="lnt">1442
</span><span class="lnt">1443
</span><span class="lnt">1444
</span><span class="lnt">1445
</span><span class="lnt">1446
</span><span class="lnt">1447
</span><span class="lnt">1448
</span><span class="lnt">1449
</span><span class="lnt">1450
</span><span class="lnt">1451
</span><span class="lnt">1452
</span><span class="lnt">1453
</span><span class="lnt">1454
</span><span class="lnt">1455
</span><span class="lnt">1456
</span><span class="lnt">1457
</span><span class="lnt">1458
</span><span class="lnt">1459
</span><span class="lnt">1460
</span><span class="lnt">1461
</span><span class="lnt">1462
</span><span class="lnt">1463
</span><span class="lnt">1464
</span><span class="lnt">1465
</span><span class="lnt">1466
</span><span class="lnt">1467
</span><span class="lnt">1468
</span><span class="lnt">1469
</span><span class="lnt">1470
</span><span class="lnt">1471
</span><span class="lnt">1472
</span><span class="lnt">1473
</span><span class="lnt">1474
</span><span class="lnt">1475
</span><span class="lnt">1476
</span><span class="lnt">1477
</span><span class="lnt">1478
</span><span class="lnt">1479
</span><span class="lnt">1480
</span><span class="lnt">1481
</span><span class="lnt">1482
</span><span class="lnt">1483
</span><span class="lnt">1484
</span><span class="lnt">1485
</span><span class="lnt">1486
</span><span class="lnt">1487
</span><span class="lnt">1488
</span><span class="lnt">1489
</span><span class="lnt">1490
</span><span class="lnt">1491
</span><span class="lnt">1492
</span><span class="lnt">1493
</span><span class="lnt">1494
</span><span class="lnt">1495
</span><span class="lnt">1496
</span><span class="lnt">1497
</span><span class="lnt">1498
</span><span class="lnt">1499
</span><span class="lnt">1500
</span><span class="lnt">1501
</span><span class="lnt">1502
</span><span class="lnt">1503
</span><span class="lnt">1504
</span><span class="lnt">1505
</span><span class="lnt">1506
</span><span class="lnt">1507
</span><span class="lnt">1508
</span><span class="lnt">1509
</span><span class="lnt">1510
</span><span class="lnt">1511
</span><span class="lnt">1512
</span><span class="lnt">1513
</span><span class="lnt">1514
</span><span class="lnt">1515
</span><span class="lnt">1516
</span><span class="lnt">1517
</span><span class="lnt">1518
</span><span class="lnt">1519
</span><span class="lnt">1520
</span><span class="lnt">1521
</span><span class="lnt">1522
</span><span class="lnt">1523
</span><span class="lnt">1524
</span><span class="lnt">1525
</span><span class="lnt">1526
</span><span class="lnt">1527
</span><span class="lnt">1528
</span><span class="lnt">1529
</span><span class="lnt">1530
</span><span class="lnt">1531
</span><span class="lnt">1532
</span><span class="lnt">1533
</span><span class="lnt">1534
</span><span class="lnt">1535
</span><span class="lnt">1536
</span><span class="lnt">1537
</span><span class="lnt">1538
</span><span class="lnt">1539
</span><span class="lnt">1540
</span><span class="lnt">1541
</span><span class="lnt">1542
</span><span class="lnt">1543
</span><span class="lnt">1544
</span><span class="lnt">1545
</span><span class="lnt">1546
</span><span class="lnt">1547
</span><span class="lnt">1548
</span><span class="lnt">1549
</span><span class="lnt">1550
</span><span class="lnt">1551
</span><span class="lnt">1552
</span><span class="lnt">1553
</span><span class="lnt">1554
</span><span class="lnt">1555
</span><span class="lnt">1556
</span><span class="lnt">1557
</span><span class="lnt">1558
</span><span class="lnt">1559
</span><span class="lnt">1560
</span><span class="lnt">1561
</span><span class="lnt">1562
</span><span class="lnt">1563
</span><span class="lnt">1564
</span><span class="lnt">1565
</span><span class="lnt">1566
</span><span class="lnt">1567
</span><span class="lnt">1568
</span><span class="lnt">1569
</span><span class="lnt">1570
</span><span class="lnt">1571
</span><span class="lnt">1572
</span><span class="lnt">1573
</span><span class="lnt">1574
</span><span class="lnt">1575
</span><span class="lnt">1576
</span><span class="lnt">1577
</span><span class="lnt">1578
</span><span class="lnt">1579
</span><span class="lnt">1580
</span><span class="lnt">1581
</span><span class="lnt">1582
</span><span class="lnt">1583
</span><span class="lnt">1584
</span><span class="lnt">1585
</span><span class="lnt">1586
</span><span class="lnt">1587
</span><span class="lnt">1588
</span><span class="lnt">1589
</span><span class="lnt">1590
</span><span class="lnt">1591
</span><span class="lnt">1592
</span><span class="lnt">1593
</span><span class="lnt">1594
</span><span class="lnt">1595
</span><span class="lnt">1596
</span><span class="lnt">1597
</span><span class="lnt">1598
</span><span class="lnt">1599
</span><span class="lnt">1600
</span><span class="lnt">1601
</span><span class="lnt">1602
</span><span class="lnt">1603
</span><span class="lnt">1604
</span><span class="lnt">1605
</span><span class="lnt">1606
</span><span class="lnt">1607
</span><span class="lnt">1608
</span><span class="lnt">1609
</span><span class="lnt">1610
</span><span class="lnt">1611
</span><span class="lnt">1612
</span><span class="lnt">1613
</span><span class="lnt">1614
</span><span class="lnt">1615
</span><span class="lnt">1616
</span><span class="lnt">1617
</span><span class="lnt">1618
</span><span class="lnt">1619
</span><span class="lnt">1620
</span><span class="lnt">1621
</span><span class="lnt">1622
</span><span class="lnt">1623
</span><span class="lnt">1624
</span><span class="lnt">1625
</span><span class="lnt">1626
</span><span class="lnt">1627
</span><span class="lnt">1628
</span><span class="lnt">1629
</span><span class="lnt">1630
</span><span class="lnt">1631
</span><span class="lnt">1632
</span><span class="lnt">1633
</span><span class="lnt">1634
</span><span class="lnt">1635
</span><span class="lnt">1636
</span><span class="lnt">1637
</span><span class="lnt">1638
</span><span class="lnt">1639
</span><span class="lnt">1640
</span><span class="lnt">1641
</span><span class="lnt">1642
</span><span class="lnt">1643
</span><span class="lnt">1644
</span><span class="lnt">1645
</span><span class="lnt">1646
</span><span class="lnt">1647
</span><span class="lnt">1648
</span><span class="lnt">1649
</span><span class="lnt">1650
</span><span class="lnt">1651
</span><span class="lnt">1652
</span><span class="lnt">1653
</span><span class="lnt">1654
</span><span class="lnt">1655
</span><span class="lnt">1656
</span><span class="lnt">1657
</span><span class="lnt">1658
</span><span class="lnt">1659
</span><span class="lnt">1660
</span><span class="lnt">1661
</span><span class="lnt">1662
</span><span class="lnt">1663
</span><span class="lnt">1664
</span><span class="lnt">1665
</span><span class="lnt">1666
</span><span class="lnt">1667
</span><span class="lnt">1668
</span><span class="lnt">1669
</span><span class="lnt">1670
</span><span class="lnt">1671
</span><span class="lnt">1672
</span><span class="lnt">1673
</span><span class="lnt">1674
</span><span class="lnt">1675
</span><span class="lnt">1676
</span><span class="lnt">1677
</span><span class="lnt">1678
</span><span class="lnt">1679
</span><span class="lnt">1680
</span><span class="lnt">1681
</span><span class="lnt">1682
</span><span class="lnt">1683
</span><span class="lnt">1684
</span><span class="lnt">1685
</span><span class="lnt">1686
</span><span class="lnt">1687
</span><span class="lnt">1688
</span><span class="lnt">1689
</span><span class="lnt">1690
</span><span class="lnt">1691
</span><span class="lnt">1692
</span><span class="lnt">1693
</span><span class="lnt">1694
</span><span class="lnt">1695
</span><span class="lnt">1696
</span><span class="lnt">1697
</span><span class="lnt">1698
</span><span class="lnt">1699
</span><span class="lnt">1700
</span><span class="lnt">1701
</span><span class="lnt">1702
</span><span class="lnt">1703
</span><span class="lnt">1704
</span><span class="lnt">1705
</span><span class="lnt">1706
</span><span class="lnt">1707
</span><span class="lnt">1708
</span><span class="lnt">1709
</span><span class="lnt">1710
</span><span class="lnt">1711
</span><span class="lnt">1712
</span><span class="lnt">1713
</span><span class="lnt">1714
</span><span class="lnt">1715
</span><span class="lnt">1716
</span><span class="lnt">1717
</span><span class="lnt">1718
</span><span class="lnt">1719
</span><span class="lnt">1720
</span><span class="lnt">1721
</span><span class="lnt">1722
</span><span class="lnt">1723
</span><span class="lnt">1724
</span><span class="lnt">1725
</span><span class="lnt">1726
</span><span class="lnt">1727
</span><span class="lnt">1728
</span><span class="lnt">1729
</span><span class="lnt">1730
</span><span class="lnt">1731
</span><span class="lnt">1732
</span><span class="lnt">1733
</span><span class="lnt">1734
</span><span class="lnt">1735
</span><span class="lnt">1736
</span><span class="lnt">1737
</span><span class="lnt">1738
</span><span class="lnt">1739
</span><span class="lnt">1740
</span><span class="lnt">1741
</span><span class="lnt">1742
</span><span class="lnt">1743
</span><span class="lnt">1744
</span><span class="lnt">1745
</span><span class="lnt">1746
</span><span class="lnt">1747
</span><span class="lnt">1748
</span><span class="lnt">1749
</span><span class="lnt">1750
</span><span class="lnt">1751
</span><span class="lnt">1752
</span><span class="lnt">1753
</span><span class="lnt">1754
</span><span class="lnt">1755
</span><span class="lnt">1756
</span><span class="lnt">1757
</span><span class="lnt">1758
</span><span class="lnt">1759
</span><span class="lnt">1760
</span><span class="lnt">1761
</span><span class="lnt">1762
</span><span class="lnt">1763
</span><span class="lnt">1764
</span><span class="lnt">1765
</span><span class="lnt">1766
</span><span class="lnt">1767
</span><span class="lnt">1768
</span><span class="lnt">1769
</span><span class="lnt">1770
</span><span class="lnt">1771
</span><span class="lnt">1772
</span><span class="lnt">1773
</span><span class="lnt">1774
</span><span class="lnt">1775
</span><span class="lnt">1776
</span><span class="lnt">1777
</span><span class="lnt">1778
</span><span class="lnt">1779
</span><span class="lnt">1780
</span><span class="lnt">1781
</span><span class="lnt">1782
</span><span class="lnt">1783
</span><span class="lnt">1784
</span><span class="lnt">1785
</span><span class="lnt">1786
</span><span class="lnt">1787
</span><span class="lnt">1788
</span><span class="lnt">1789
</span><span class="lnt">1790
</span><span class="lnt">1791
</span><span class="lnt">1792
</span><span class="lnt">1793
</span><span class="lnt">1794
</span><span class="lnt">1795
</span><span class="lnt">1796
</span><span class="lnt">1797
</span><span class="lnt">1798
</span><span class="lnt">1799
</span><span class="lnt">1800
</span><span class="lnt">1801
</span><span class="lnt">1802
</span><span class="lnt">1803
</span><span class="lnt">1804
</span><span class="lnt">1805
</span><span class="lnt">1806
</span><span class="lnt">1807
</span><span class="lnt">1808
</span><span class="lnt">1809
</span><span class="lnt">1810
</span><span class="lnt">1811
</span><span class="lnt">1812
</span><span class="lnt">1813
</span><span class="lnt">1814
</span><span class="lnt">1815
</span><span class="lnt">1816
</span><span class="lnt">1817
</span><span class="lnt">1818
</span><span class="lnt">1819
</span><span class="lnt">1820
</span><span class="lnt">1821
</span><span class="lnt">1822
</span><span class="lnt">1823
</span><span class="lnt">1824
</span><span class="lnt">1825
</span><span class="lnt">1826
</span><span class="lnt">1827
</span><span class="lnt">1828
</span><span class="lnt">1829
</span><span class="lnt">1830
</span><span class="lnt">1831
</span><span class="lnt">1832
</span><span class="lnt">1833
</span><span class="lnt">1834
</span><span class="lnt">1835
</span><span class="lnt">1836
</span><span class="lnt">1837
</span><span class="lnt">1838
</span><span class="lnt">1839
</span><span class="lnt">1840
</span><span class="lnt">1841
</span><span class="lnt">1842
</span><span class="lnt">1843
</span><span class="lnt">1844
</span><span class="lnt">1845
</span><span class="lnt">1846
</span><span class="lnt">1847
</span><span class="lnt">1848
</span><span class="lnt">1849
</span><span class="lnt">1850
</span><span class="lnt">1851
</span><span class="lnt">1852
</span><span class="lnt">1853
</span><span class="lnt">1854
</span><span class="lnt">1855
</span><span class="lnt">1856
</span><span class="lnt">1857
</span><span class="lnt">1858
</span><span class="lnt">1859
</span><span class="lnt">1860
</span><span class="lnt">1861
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">example</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">started</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">argument</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">server</span><span class="w"> </span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">redis</span><span class="p">.</span><span class="na">conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">units</span><span class="p">:</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">needed</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specify</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">usual</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">1k</span><span class="w"> </span><span class="n">5GB</span><span class="w"> </span><span class="n">4M</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1k</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">1000</span><span class="w"> </span><span class="n">bytes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1kb</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">1024</span><span class="w"> </span><span class="n">bytes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1m</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">1000000</span><span class="w"> </span><span class="n">bytes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1mb</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">1024</span><span class="o">*</span><span class="n">1024</span><span class="w"> </span><span class="n">bytes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1g</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">1000000000</span><span class="w"> </span><span class="n">bytes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1gb</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">1024</span><span class="o">*</span><span class="n">1024</span><span class="o">*</span><span class="n">1024</span><span class="w"> </span><span class="n">bytes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">insensitive</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">1GB</span><span class="w"> </span><span class="n">1Gb</span><span class="w"> </span><span class="n">1gB</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">##################################</span><span class="w"> </span><span class="n">INCLUDES</span><span class="w"> </span><span class="err">###################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Include</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">here</span><span class="p">.</span><span class="w">  </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">goes</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">servers</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">need</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">customize</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">few</span><span class="w"> </span><span class="n">per</span><span class="o">-</span><span class="n">server</span><span class="w"> </span><span class="n">settings</span><span class="p">.</span><span class="w">  </span><span class="n">Include</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">include</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">wisely</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Notice</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="s">&#34;include&#34;</span><span class="w"> </span><span class="n">won</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">rewritten</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="s">&#34;CONFIG REWRITE&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">admin</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Sentinel</span><span class="p">.</span><span class="w"> </span><span class="n">Since</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">processed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="err">&#39;</span><span class="n">d</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">put</span><span class="w"> </span><span class="n">includes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">beginning</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">overwriting</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">interested</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">includes</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="n">configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">local</span><span class="p">.</span><span class="na">conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">other</span><span class="p">.</span><span class="na">conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">##################################</span><span class="w"> </span><span class="n">MODULES</span><span class="w"> </span><span class="err">#####################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Load</span><span class="w"> </span><span class="n">modules</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">startup</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">modules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">abort</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">loadmodule</span><span class="w"> </span><span class="n">directives</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">loadmodule</span><span class="w"> </span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">my_module</span><span class="p">.</span><span class="na">so</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">loadmodule</span><span class="w"> </span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">other_module</span><span class="p">.</span><span class="na">so</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">##################################</span><span class="w"> </span><span class="n">NETWORK</span><span class="w"> </span><span class="err">#####################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="s">&#34;bind&#34;</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">listens</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">interfaces</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">listen</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">interfaces</span><span class="w"> </span><span class="n">using</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;bind&#34;</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="p">,</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">IP</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Examples</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">bind</span><span class="w"> </span><span class="n">192</span><span class="p">.</span><span class="na">168</span><span class="p">.</span><span class="na">1</span><span class="p">.</span><span class="na">100</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">bind</span><span class="w"> </span><span class="n">127</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">1</span><span class="w"> </span><span class="p">::</span><span class="n">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">~~~</span><span class="w"> </span><span class="n">WARNING</span><span class="w"> </span><span class="o">~~~</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">computer</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">directly</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">internet</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">interfaces</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">expose</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">everybody</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">internet</span><span class="p">.</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">uncomment</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">bind</span><span class="w"> </span><span class="n">directive</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">listen</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">into</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">IPv4</span><span class="w"> </span><span class="n">loopback</span><span class="w"> </span><span class="kd">interface</span> <span class="nf">address</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">computer</span><span class="w"> </span><span class="n">it</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">running</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">IF</span><span class="w"> </span><span class="n">YOU</span><span class="w"> </span><span class="n">ARE</span><span class="w"> </span><span class="n">SURE</span><span class="w"> </span><span class="n">YOU</span><span class="w"> </span><span class="n">WANT</span><span class="w"> </span><span class="n">YOUR</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="n">TO</span><span class="w"> </span><span class="n">LISTEN</span><span class="w"> </span><span class="n">TO</span><span class="w"> </span><span class="n">ALL</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">INTERFACES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">JUST</span><span class="w"> </span><span class="n">COMMENT</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">FOLLOWING</span><span class="w"> </span><span class="n">LINE</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="n">bind</span><span class="w"> </span><span class="n">127</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Protected</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">protection</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">that</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">internet</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">accessed</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">exploited</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="kd">protected</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="k">if</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="n">explicitly</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="s">&#34;bind&#34;</span><span class="w"> </span><span class="n">directive</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">configured</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">accepts</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">connecting</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">IPv4</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">IPv6</span><span class="w"> </span><span class="n">loopback</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="n">127</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">1</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="p">::</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Unix</span><span class="w"> </span><span class="n">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">sockets</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">protected</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="p">.</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">hosts</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">connect</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">authentication</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">configured</span><span class="p">,</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">interfaces</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">explicitly</span><span class="w"> </span><span class="n">listed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;bind&#34;</span><span class="w"> </span><span class="n">directive</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="o">-</span><span class="n">mode</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Accept</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="nf">6379</span><span class="w"> </span><span class="p">(</span><span class="n">IANA</span><span class="w"> </span><span class="err">#</span><span class="n">815344</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">listen</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">port</span><span class="w"> </span><span class="n">6379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="nf">listen</span><span class="p">()</span><span class="w"> </span><span class="n">backlog</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">requests</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">second</span><span class="w"> </span><span class="n">environments</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">backlog</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">issues</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">kernel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">silently</span><span class="w"> </span><span class="n">truncate</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">somaxconn</span><span class="w"> </span><span class="n">so</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">somaxconn</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tcp_max_syn_backlog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">desired</span><span class="w"> </span><span class="n">effect</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">tcp</span><span class="o">-</span><span class="n">backlog</span><span class="w"> </span><span class="n">511</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Unix</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Unix</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">listen</span><span class="w"> </span><span class="k">for</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">incoming</span><span class="w"> </span><span class="n">connections</span><span class="p">.</span><span class="w"> </span><span class="n">There</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">listen</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">unix</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">specified</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">unixsocket</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">redis</span><span class="p">.</span><span class="na">sock</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">unixsocketperm</span><span class="w"> </span><span class="n">700</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Close</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">idle</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="nf">seconds</span><span class="w"> </span><span class="p">(</span><span class="n">0</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">disable</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">timeout</span><span class="w"> </span><span class="n">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="n">keepalive</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">SO_KEEPALIVE</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="n">ACKs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">absence</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">communication</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">reasons</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">Detect</span><span class="w"> </span><span class="n">dead</span><span class="w"> </span><span class="n">peers</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">Take</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">alive</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">equipment</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">middle</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">On</span><span class="w"> </span><span class="n">Linux</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="nf">value</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="n">seconds</span><span class="p">)</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">period</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">ACKs</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">needed</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">On</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">kernels</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">period</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">configuration</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">reasonable</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">300</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">new</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">3</span><span class="p">.</span><span class="na">2</span><span class="p">.</span><span class="na">1</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">tcp</span><span class="o">-</span><span class="n">keepalive</span><span class="w"> </span><span class="n">300</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#################################</span><span class="w"> </span><span class="n">TLS</span><span class="o">/</span><span class="n">SSL</span><span class="w"> </span><span class="err">#####################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">TLS</span><span class="o">/</span><span class="n">SSL</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">disabled</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;tls-port&#34;</span><span class="w"> </span><span class="n">configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="n">TLS</span><span class="o">-</span><span class="n">listening</span><span class="w"> </span><span class="n">ports</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">port</span><span class="w"> </span><span class="n">6379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">X</span><span class="p">.</span><span class="na">509</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">authenticating</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">clients</span><span class="p">,</span><span class="w"> </span><span class="n">masters</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">peers</span><span class="p">.</span><span class="w">  </span><span class="n">These</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">PEM</span><span class="w"> </span><span class="n">formatted</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">cert</span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="n">redis</span><span class="p">.</span><span class="na">crt</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="n">redis</span><span class="p">.</span><span class="na">key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">DH</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">Diffie</span><span class="o">-</span><span class="n">Hellman</span><span class="w"> </span><span class="p">(</span><span class="n">DH</span><span class="p">)</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">exchange</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">dh</span><span class="o">-</span><span class="n">params</span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="n">redis</span><span class="p">.</span><span class="na">dh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">CA</span><span class="w"> </span><span class="nf">certificate</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="n">TLS</span><span class="o">/</span><span class="n">SSL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">peers</span><span class="p">.</span><span class="w">  </span><span class="n">Redis</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">one</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">these</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implicitly</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">wide</span><span class="w"> </span><span class="n">configuration</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">cert</span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="na">crt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">cert</span><span class="o">-</span><span class="n">dir</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="p">(</span><span class="n">including</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">servers</span><span class="p">)</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">required</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">certificates</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="s">&#34;no&#34;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">certificates</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">accepted</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="s">&#34;optional&#34;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">certificates</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">accepted</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">provided</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">required</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">clients</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">clients</span><span class="w"> </span><span class="n">optional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">establish</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">connection</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">links</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">replication</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">bus</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">plain</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">enable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bus</span><span class="w"> </span><span class="n">protocol</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">directive</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">cluster</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">support</span><span class="p">.</span><span class="w"> </span><span class="n">Allowed</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">insensitive</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="s">&#34;TLSv1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;TLSv1.1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;TLSv1.2&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;TLSv1.3&#34;</span><span class="w"> </span><span class="p">(</span><span class="n">OpenSSL</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">1</span><span class="p">.</span><span class="na">1</span><span class="p">.</span><span class="na">1</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">combination</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">TLSv1</span><span class="p">.</span><span class="na">2</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">TLSv1</span><span class="p">.</span><span class="na">3</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">protocols</span><span class="w"> </span><span class="s">&#34;TLSv1.2 TLSv1.3&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">ciphers</span><span class="p">.</span><span class="w">  </span><span class="n">See</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nf">ciphers</span><span class="p">(</span><span class="n">1ssl</span><span class="p">)</span><span class="w"> </span><span class="n">manpage</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">applies</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">TLSv1</span><span class="p">.</span><span class="na">2</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">ciphers</span><span class="w"> </span><span class="n">DEFAULT</span><span class="p">:</span><span class="o">!</span><span class="n">MEDIUM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">TLSv1</span><span class="p">.</span><span class="na">3</span><span class="w"> </span><span class="n">ciphersuites</span><span class="p">.</span><span class="w">  </span><span class="n">See</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nf">ciphers</span><span class="p">(</span><span class="n">1ssl</span><span class="p">)</span><span class="w"> </span><span class="n">manpage</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">specifically</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">TLSv1</span><span class="p">.</span><span class="na">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">ciphersuites</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">ciphersuites</span><span class="w"> </span><span class="n">TLS_CHACHA20_POLY1305_SHA256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">choosing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">cipher</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">preference</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">preference</span><span class="p">.</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">follows</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">preference</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">prefer</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ciphers</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="n">caching</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">expensive</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">reconnections</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">disable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">caching</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">session</span><span class="o">-</span><span class="n">caching</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Change</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="n">cached</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">sets</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">unlimited</span><span class="w"> </span><span class="n">size</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">20480</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">session</span><span class="o">-</span><span class="n">cache</span><span class="o">-</span><span class="n">size</span><span class="w"> </span><span class="n">5000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Change</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">cached</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="n">sessions</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">300</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">seconds</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tls</span><span class="o">-</span><span class="n">session</span><span class="o">-</span><span class="n">cache</span><span class="o">-</span><span class="n">timeout</span><span class="w"> </span><span class="n">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#################################</span><span class="w"> </span><span class="n">GENERAL</span><span class="w"> </span><span class="err">#####################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">daemon</span><span class="p">.</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="err">&#39;</span><span class="n">yes</span><span class="err">&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">redis</span><span class="p">.</span><span class="na">pid</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">daemonized</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">daemonize</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">upstart</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">systemd</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">interact</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">your</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">supervision</span><span class="w"> </span><span class="n">tree</span><span class="p">.</span><span class="w"> </span><span class="n">Options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">supervised</span><span class="w"> </span><span class="n">no</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">supervision</span><span class="w"> </span><span class="n">interaction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">supervised</span><span class="w"> </span><span class="n">upstart</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signal</span><span class="w"> </span><span class="n">upstart</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">putting</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">SIGSTOP</span><span class="w"> </span><span class="n">mode</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">supervised</span><span class="w"> </span><span class="n">systemd</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signal</span><span class="w"> </span><span class="n">systemd</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">READY</span><span class="o">=</span><span class="n">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">$NOTIFY_SOCKET</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">supervised</span><span class="w"> </span><span class="n">auto</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">detect</span><span class="w"> </span><span class="n">upstart</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">systemd</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="n">on</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">                        </span><span class="n">UPSTART_JOB</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">NOTIFY_SOCKET</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variables</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="p">:</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">supervision</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">signal</span><span class="w"> </span><span class="s">&#34;process is ready.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">       </span><span class="n">They</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">continuous</span><span class="w"> </span><span class="n">liveness</span><span class="w"> </span><span class="n">pings</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">supervisor</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">supervised</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">startup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">removes</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">exit</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">non</span><span class="w"> </span><span class="n">daemonized</span><span class="p">,</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">none</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">configuration</span><span class="p">.</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">daemonized</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="n">file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">specified</span><span class="p">,</span><span class="w"> </span><span class="n">defaulting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&#34;/var/run/redis.pid&#34;</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Creating</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">effort</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">it</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">happens</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">normally</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pidfile</span><span class="w"> </span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">redis_6379</span><span class="p">.</span><span class="na">pid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">verbosity</span><span class="w"> </span><span class="n">level</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">of</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">information</span><span class="p">,</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">development</span><span class="o">/</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="p">(</span><span class="n">many</span><span class="w"> </span><span class="n">rarely</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">mess</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">level</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">notice</span><span class="w"> </span><span class="p">(</span><span class="n">moderately</span><span class="w"> </span><span class="n">verbose</span><span class="p">,</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">production</span><span class="w"> </span><span class="n">probably</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="n">only</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">critical</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">logged</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">loglevel</span><span class="w"> </span><span class="n">notice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="w"> </span><span class="n">Also</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">force</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">standard</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">daemonize</span><span class="p">,</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">sent</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="kc">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">logfile</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="err">&#39;</span><span class="n">syslog</span><span class="o">-</span><span class="n">enabled</span><span class="err">&#39;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">yes</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">optionally</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">syslog</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">suit</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">needs</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">syslog</span><span class="o">-</span><span class="n">enabled</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">syslog</span><span class="w"> </span><span class="n">identity</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">syslog</span><span class="o">-</span><span class="n">ident</span><span class="w"> </span><span class="n">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">syslog</span><span class="w"> </span><span class="n">facility</span><span class="p">.</span><span class="w"> </span><span class="n">Must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">USER</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">LOCAL0</span><span class="o">-</span><span class="n">LOCAL7</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">syslog</span><span class="o">-</span><span class="n">facility</span><span class="w"> </span><span class="n">local0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">databases</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">per</span><span class="o">-</span><span class="n">connection</span><span class="w"> </span><span class="n">basis</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">dbid</span><span class="o">&gt;</span><span class="w"> </span><span class="n">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">dbid</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="err">&#39;</span><span class="n">databases</span><span class="err">&#39;</span><span class="o">-</span><span class="n">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">databases</span><span class="w"> </span><span class="n">16</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">shows</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">ASCII</span><span class="w"> </span><span class="n">art</span><span class="w"> </span><span class="n">logo</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">started</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">TTY</span><span class="p">.</span><span class="w"> </span><span class="n">Basically</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">means</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">normally</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">logo</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">displayed</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">interactive</span><span class="w"> </span><span class="n">sessions</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">pre</span><span class="o">-</span><span class="n">4</span><span class="p">.</span><span class="na">0</span><span class="w"> </span><span class="n">behavior</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">ASCII</span><span class="w"> </span><span class="n">art</span><span class="w"> </span><span class="n">logo</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">startup</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">yes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">always</span><span class="o">-</span><span class="n">show</span><span class="o">-</span><span class="n">logo</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">################################</span><span class="w"> </span><span class="n">SNAPSHOTTING</span><span class="w">  </span><span class="err">################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Save</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">disk</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">save</span><span class="w"> </span><span class="o">&lt;</span><span class="n">seconds</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">changes</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">Will</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">given</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="n">occurred</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">In</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">below</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">behaviour</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">save</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">after</span><span class="w"> </span><span class="n">900</span><span class="w"> </span><span class="nf">sec</span><span class="w"> </span><span class="p">(</span><span class="n">15</span><span class="w"> </span><span class="n">min</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">changed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">after</span><span class="w"> </span><span class="n">300</span><span class="w"> </span><span class="nf">sec</span><span class="w"> </span><span class="p">(</span><span class="n">5</span><span class="w"> </span><span class="n">min</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">changed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">after</span><span class="w"> </span><span class="n">60</span><span class="w"> </span><span class="n">sec</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">10000</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">changed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">Note</span><span class="p">:</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="n">completely</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">commenting</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="s">&#34;save&#34;</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">previously</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">save</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">points</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">adding</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">argument</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">like</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">example</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">save</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">save</span><span class="w"> </span><span class="n">900</span><span class="w"> </span><span class="n">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">save</span><span class="w"> </span><span class="n">300</span><span class="w"> </span><span class="n">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">save</span><span class="w"> </span><span class="n">60</span><span class="w"> </span><span class="n">10000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">accepting</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">snapshots</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">enabled</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">point</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">latest</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">failed</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="nf">aware</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">way</span><span class="p">)</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">persisting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">properly</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">chances</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">notice</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">some</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">disaster</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">happen</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">again</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">setup</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">proper</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">persistence</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">usual</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">problems</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">disk</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">stop</span><span class="o">-</span><span class="n">writes</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">bgsave</span><span class="o">-</span><span class="n">error</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Compress</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">LZF</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">dump</span><span class="w"> </span><span class="p">.</span><span class="na">rdb</span><span class="w"> </span><span class="n">databases</span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">that</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="n">yes</span><span class="err">&#39;</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">it</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">almost</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">win</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="n">no</span><span class="err">&#39;</span><span class="w"> </span><span class="n">but</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">bigger</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">compressible</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">keys</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">rdbcompression</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Since</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">5</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">CRC64</span><span class="w"> </span><span class="n">checksum</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">placed</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">resistant</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">corruption</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">hit</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nf">pay</span><span class="w"> </span><span class="p">(</span><span class="n">around</span><span class="w"> </span><span class="n">10</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">loading</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="n">it</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">performances</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">checksum</span><span class="w"> </span><span class="n">disabled</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">checksum</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tell</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">loading</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">skip</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">check</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">rdbchecksum</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">dump</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">dbfilename</span><span class="w"> </span><span class="n">dump</span><span class="p">.</span><span class="na">rdb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">persistence</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">enabled</span><span class="p">.</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">disabled</span><span class="p">,</span><span class="w"> </span><span class="n">however</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">environments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">regulations</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">concerns</span><span class="p">,</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">persisted</span><span class="w"> </span><span class="n">on</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">masters</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">feed</span><span class="w"> </span><span class="n">replicas</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">replicas</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">synchronization</span><span class="p">,</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">deleted</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">ASAP</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">ONLY</span><span class="w"> </span><span class="n">WORKS</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">AOF</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">persistence</span><span class="w"> </span><span class="n">disabled</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">completely</span><span class="w"> </span><span class="n">ignored</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="nf">alternative</span><span class="w"> </span><span class="p">(</span><span class="n">and</span><span class="w"> </span><span class="n">sometimes</span><span class="w"> </span><span class="n">better</span><span class="p">)</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">obtain</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">effect</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">instances</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">replicas</span><span class="p">,</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">option</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">rdb</span><span class="o">-</span><span class="n">del</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">files</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">directory</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">directory</span><span class="p">,</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="n">specified</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">&#39;</span><span class="n">dbfilename</span><span class="err">&#39;</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Append</span><span class="w"> </span><span class="n">Only</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">directory</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">dir</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#################################</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="err">#################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Master</span><span class="o">-</span><span class="n">Replica</span><span class="w"> </span><span class="n">replication</span><span class="p">.</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">replicaof</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">few</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">understand</span><span class="w"> </span><span class="n">ASAP</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">replication</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="o">+------------------+</span><span class="w">      </span><span class="o">+---------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">Master</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="n">Replica</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">receive</span><span class="w"> </span><span class="n">writes</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="p">(</span><span class="n">exact</span><span class="w"> </span><span class="n">copy</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="o">+------------------+</span><span class="w">      </span><span class="o">+---------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">asynchronous</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">stop</span><span class="w"> </span><span class="n">accepting</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">replicas</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">partial</span><span class="w"> </span><span class="n">resynchronization</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">master</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">lost</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">relatively</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">time</span><span class="p">.</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">backlog</span><span class="w"> </span><span class="nf">size</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">next</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">sections</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sensible</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">needs</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">3</span><span class="p">)</span><span class="w"> </span><span class="n">Replication</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">automatic</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">intervention</span><span class="p">.</span><span class="w"> </span><span class="n">After</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">network</span><span class="w"> </span><span class="n">partition</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reconnect</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">masters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">and</span><span class="w"> </span><span class="n">resynchronize</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">them</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replicaof</span><span class="w"> </span><span class="o">&lt;</span><span class="n">masterip</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">masterport</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="nf">protected</span><span class="w"> </span><span class="p">(</span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;requirepass&#34;</span><span class="w"> </span><span class="n">configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">below</span><span class="p">)</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">tell</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="n">before</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">synchronization</span><span class="w"> </span><span class="n">process</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">refuse</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">masterauth</span><span class="w"> </span><span class="o">&lt;</span><span class="n">master</span><span class="o">-</span><span class="n">password</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="nf">ACLs</span><span class="w"> </span><span class="p">(</span><span class="k">for</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">version</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">6</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">greater</span><span class="p">),</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">capable</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">PSYNC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">and</span><span class="o">/</span><span class="n">or</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">replication</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">it</span><span class="err">&#39;</span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">replication</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">masteruser</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">such</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">masteruser</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">masteruser</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">its</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="n">form</span><span class="p">:</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">loses</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">progress</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">act</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">ways</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">serve</span><span class="o">-</span><span class="n">stale</span><span class="o">-</span><span class="n">data</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="n">yes</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="p">)</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">still</span><span class="w"> </span><span class="n">reply</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">requests</span><span class="p">,</span><span class="w"> </span><span class="n">possibly</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">synchronization</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">serve</span><span class="o">-</span><span class="n">stale</span><span class="o">-</span><span class="n">data</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="n">no</span><span class="err">&#39;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">reply</span><span class="w"> </span><span class="n">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="s">&#34;SYNC with master in progress&#34;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">but</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">INFO</span><span class="p">,</span><span class="w"> </span><span class="n">replicaOF</span><span class="p">,</span><span class="w"> </span><span class="n">AUTH</span><span class="p">,</span><span class="w"> </span><span class="n">PING</span><span class="p">,</span><span class="w"> </span><span class="n">SHUTDOWN</span><span class="p">,</span><span class="w"> </span><span class="n">REPLCONF</span><span class="p">,</span><span class="w"> </span><span class="n">ROLE</span><span class="p">,</span><span class="w"> </span><span class="n">CONFIG</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">SUBSCRIBE</span><span class="p">,</span><span class="w"> </span><span class="n">UNSUBSCRIBE</span><span class="p">,</span><span class="w"> </span><span class="n">PSUBSCRIBE</span><span class="p">,</span><span class="w"> </span><span class="n">PUNSUBSCRIBE</span><span class="p">,</span><span class="w"> </span><span class="n">PUBLISH</span><span class="p">,</span><span class="w"> </span><span class="n">PUBSUB</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">COMMAND</span><span class="p">,</span><span class="w"> </span><span class="n">POST</span><span class="p">,</span><span class="w"> </span><span class="n">HOST</span><span class="p">:</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">LATENCY</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">replica</span><span class="o">-</span><span class="n">serve</span><span class="o">-</span><span class="n">stale</span><span class="o">-</span><span class="n">data</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">not</span><span class="p">.</span><span class="w"> </span><span class="n">Writing</span><span class="w"> </span><span class="n">against</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">ephemeral</span><span class="w"> </span><span class="nf">data</span><span class="w"> </span><span class="p">(</span><span class="n">because</span><span class="w"> </span><span class="n">data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">easily</span><span class="w"> </span><span class="n">deleted</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">resync</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="p">)</span><span class="w"> </span><span class="n">but</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">problems</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">misconfiguration</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Since</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">2</span><span class="p">.</span><span class="na">6</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="p">:</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">designed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">untrusted</span><span class="w"> </span><span class="n">clients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">internet</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">protection</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">misuse</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Still</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">exports</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">administrative</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">DEBUG</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">limited</span><span class="w"> </span><span class="n">extent</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">improve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="err">&#39;</span><span class="n">rename</span><span class="o">-</span><span class="n">command</span><span class="err">&#39;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">shadow</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">administrative</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">replica</span><span class="o">-</span><span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Replication</span><span class="w"> </span><span class="n">SYNC</span><span class="w"> </span><span class="n">strategy</span><span class="p">:</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">reconnecting</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">receiving</span><span class="w"> </span><span class="n">differences</span><span class="p">,</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;full synchronization&#34;</span><span class="p">.</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">transmitted</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replicas</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">transmission</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">ways</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">Disk</span><span class="o">-</span><span class="n">backed</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">creates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">                 </span><span class="n">file</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">disk</span><span class="p">.</span><span class="w"> </span><span class="n">Later</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">transferred</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">parent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">                 </span><span class="n">process</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">incrementally</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">Diskless</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">creates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">directly</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">              </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">sockets</span><span class="p">,</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">touching</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">all</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">With</span><span class="w"> </span><span class="n">disk</span><span class="o">-</span><span class="n">backed</span><span class="w"> </span><span class="n">replication</span><span class="p">,</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">generated</span><span class="p">,</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">replicas</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">queued</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">served</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">soon</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">child</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">producing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">finishes</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="w"> </span><span class="n">With</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">instead</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">starts</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">arriving</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">queued</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">terminates</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">waits</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">configurable</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="n">seconds</span><span class="p">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">hope</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">multiple</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">arrive</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">parallelized</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">With</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">disks</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="nf">fast</span><span class="w"> </span><span class="p">(</span><span class="n">large</span><span class="w"> </span><span class="n">bandwidth</span><span class="p">)</span><span class="w"> </span><span class="n">networks</span><span class="p">,</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">replication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">better</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">repl</span><span class="o">-</span><span class="n">diskless</span><span class="o">-</span><span class="n">sync</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">delay</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">waits</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">spawn</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">transfers</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">socket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replicas</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">starts</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">serve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">arriving</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">queued</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">transfer</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">waits</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">arrive</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">5</span><span class="w"> </span><span class="n">seconds</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">disable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">entirely</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">ASAP</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">repl</span><span class="o">-</span><span class="n">diskless</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">delay</span><span class="w"> </span><span class="n">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">-----------------------------------------------------------------------------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">WARNING</span><span class="p">:</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="p">.</span><span class="w"> </span><span class="n">Since</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">setup</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">immediately</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">disk</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">loss</span><span class="w"> </span><span class="n">during</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">failovers</span><span class="p">.</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">modules</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">also</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">abort</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">synchronization</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">doing</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">-----------------------------------------------------------------------------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Replica</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">directly</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">completely</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">recived</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">cases</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">network</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">storing</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">loading</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">increase</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="nf">time</span><span class="w"> </span><span class="p">(</span><span class="n">and</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="n">increase</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="err">&#39;</span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Copy</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">Write</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">salve</span><span class="w"> </span><span class="n">buffers</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">However</span><span class="p">,</span><span class="w"> </span><span class="n">parsing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">directly</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">have</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">flush</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="n">rdb</span><span class="w"> </span><span class="n">was</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">received</span><span class="p">.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;disabled&#34;</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="nf">load</span><span class="w"> </span><span class="p">(</span><span class="n">store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">rdb</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">first</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;on-empty-db&#34;</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">diskless</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">completely</span><span class="w"> </span><span class="n">safe</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;swapdb&#34;</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">RAM</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">parsing</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">                 </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">directly</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">requires</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">                 </span><span class="n">sufficient</span><span class="w"> </span><span class="n">memory</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">risk</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">OOM</span><span class="w"> </span><span class="n">kill</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">repl</span><span class="o">-</span><span class="n">diskless</span><span class="o">-</span><span class="n">load</span><span class="w"> </span><span class="n">disabled</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Replicas</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">PINGs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">predefined</span><span class="w"> </span><span class="n">interval</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">interval</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">repl_ping_replica_period</span><span class="w"> </span><span class="n">option</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">seconds</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">ping</span><span class="o">-</span><span class="n">replica</span><span class="o">-</span><span class="n">period</span><span class="w"> </span><span class="n">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">sets</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="k">for</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">Bulk</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">SYNC</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">replica</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">Master</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nf">replicas</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">pings</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">3</span><span class="p">)</span><span class="w"> </span><span class="n">Replica</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nf">masters</span><span class="w"> </span><span class="p">(</span><span class="n">REPLCONF</span><span class="w"> </span><span class="n">ACK</span><span class="w"> </span><span class="n">pings</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">greater</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">ping</span><span class="o">-</span><span class="n">replica</span><span class="o">-</span><span class="n">period</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">detected</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">timeout</span><span class="w"> </span><span class="n">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Disable</span><span class="w"> </span><span class="n">TCP_NODELAY</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">SYNC</span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="s">&#34;yes&#34;</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">smaller</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">bandwidth</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">replicas</span><span class="p">.</span><span class="w"> </span><span class="n">But</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="k">for</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">side</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">40</span><span class="w"> </span><span class="n">milliseconds</span><span class="w"> </span><span class="n">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">kernels</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">configuration</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="s">&#34;no&#34;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">reduced</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">bandwidth</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">replication</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">optimize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">latency</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">conditions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">hops</span><span class="w"> </span><span class="n">away</span><span class="p">,</span><span class="w"> </span><span class="n">turning</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&#34;yes&#34;</span><span class="w"> </span><span class="n">may</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="n">idea</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">repl</span><span class="o">-</span><span class="n">disable</span><span class="o">-</span><span class="n">tcp</span><span class="o">-</span><span class="n">nodelay</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">backlog</span><span class="w"> </span><span class="n">size</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">backlog</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">accumulates</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">disconnected</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">wants</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reconnect</span><span class="w"> </span><span class="n">again</span><span class="p">,</span><span class="w"> </span><span class="n">often</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="n">resync</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">needed</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">partial</span><span class="w"> </span><span class="n">resync</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enough</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">passing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">portion</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">missed</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">disconnected</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">bigger</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">backlog</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">longer</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">disconnected</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">partial</span><span class="w"> </span><span class="n">resynchronization</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">backlog</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">allocated</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">connected</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">backlog</span><span class="o">-</span><span class="n">size</span><span class="w"> </span><span class="n">1mb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">After</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">longer</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">backlog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">freed</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">configures</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">that</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">elapse</span><span class="p">,</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">disconnected</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">backlog</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">freed</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">backlog</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">timeout</span><span class="p">,</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">promoted</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">masters</span><span class="w"> </span><span class="n">later</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="s">&#34;partially
</span></span></span><span class="line"><span class="cl"><span class="s"># resynchronize&#34;</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replicas</span><span class="p">:</span><span class="w"> </span><span class="n">hence</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">accumulate</span><span class="w"> </span><span class="n">backlog</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">backlog</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">backlog</span><span class="o">-</span><span class="n">ttl</span><span class="w"> </span><span class="n">3600</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">integer</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">INFO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Sentinel</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">promote</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">longer</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">correctly</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">considered</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">promotion</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="n">10</span><span class="p">,</span><span class="w"> </span><span class="n">100</span><span class="p">,</span><span class="w"> </span><span class="n">25</span><span class="w"> </span><span class="n">Sentinel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">pick</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="n">10</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lowest</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">marks</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Sentinel</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">promotion</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">100</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">replica</span><span class="o">-</span><span class="n">priority</span><span class="w"> </span><span class="n">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">accepting</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">than</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">connected</span><span class="p">,</span><span class="w"> </span><span class="n">having</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="n">seconds</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="s">&#34;online&#34;</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">calculated</span><span class="w"> </span><span class="n">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="n">received</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="n">sent</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">second</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">GUARANTEE</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">write</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">window</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">exposure</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">lost</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="n">replicas</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">available</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">seconds</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">require</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">3</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">min</span><span class="o">-</span><span class="n">replicas</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">write</span><span class="w"> </span><span class="n">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">min</span><span class="o">-</span><span class="n">replicas</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">lag</span><span class="w"> </span><span class="n">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">disables</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">feature</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">min</span><span class="o">-</span><span class="n">replicas</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">write</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nf">0</span><span class="w"> </span><span class="p">(</span><span class="n">feature</span><span class="w"> </span><span class="n">disabled</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">min</span><span class="o">-</span><span class="n">replicas</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">lag</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">attached</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">ways</span><span class="p">.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;INFO replication&#34;</span><span class="w"> </span><span class="n">section</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">offers</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">information</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="p">,</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">tools</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Sentinel</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">discover</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">instances</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Another</span><span class="w"> </span><span class="n">place</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;ROLE&#34;</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">listed</span><span class="w"> </span><span class="n">IP</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">normally</span><span class="w"> </span><span class="n">reported</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">obtained</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">way</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">IP</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">auto</span><span class="w"> </span><span class="n">detected</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">checking</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="n">address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">connect</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">Port</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">communicated</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">handshake</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">normally</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">listen</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">connections</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">forwarding</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="nf">Translation</span><span class="w"> </span><span class="p">(</span><span class="n">NAT</span><span class="p">)</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">used</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">reachable</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">IP</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">port</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">pairs</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">IP</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">INFO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">ROLE</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">There</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="n">just</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">IP</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">announce</span><span class="o">-</span><span class="n">ip</span><span class="w"> </span><span class="n">5</span><span class="p">.</span><span class="na">5</span><span class="p">.</span><span class="na">5</span><span class="p">.</span><span class="na">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">announce</span><span class="o">-</span><span class="n">port</span><span class="w"> </span><span class="n">1234</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">###############################</span><span class="w"> </span><span class="n">KEYS</span><span class="w"> </span><span class="n">TRACKING</span><span class="w"> </span><span class="err">#################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">assisted</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">caching</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalidation</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">remembers</span><span class="p">,</span><span class="w"> </span><span class="n">using</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">16</span><span class="w"> </span><span class="n">millions</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">slots</span><span class="p">,</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="n">subsets</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">keys</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">turn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">invalidation</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">clients</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">understand</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">page</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">https</span><span class="p">:</span><span class="c1">//redis.io/topics/client-side-caching</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">tracking</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">assumed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">cached</span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">invalidation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">table</span><span class="p">.</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">modified</span><span class="p">,</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">flushed</span><span class="w"> </span><span class="n">away</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">invalidation</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sent</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">clients</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">workload</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">heavily</span><span class="w"> </span><span class="n">dominated</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">reads</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">fetched</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">clients</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">invalidation</span><span class="w"> </span><span class="n">table</span><span class="p">.</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">1M</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">keys</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">limit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">evict</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">invalidation</span><span class="w"> </span><span class="n">table</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">modified</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reclaim</span><span class="w"> </span><span class="n">memory</span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">turn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invalidate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cached</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="w"> </span><span class="n">Basically</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">table</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">trade</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">spend</span><span class="w"> </span><span class="n">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">who</span><span class="w"> </span><span class="n">cached</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ability</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">clients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retain</span><span class="w"> </span><span class="n">cached</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">memory</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">limits</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">retain</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">invalidation</span><span class="w"> </span><span class="n">table</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;stats&#34;</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="n">section</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">invalidation</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">moment</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="p">:</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">tracking</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">broadcasting</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useless</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tracking</span><span class="o">-</span><span class="n">table</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">keys</span><span class="w"> </span><span class="n">1000000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">##################################</span><span class="w"> </span><span class="n">SECURITY</span><span class="w"> </span><span class="err">###################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">pretty</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">outside</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="n">passwords</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">modern</span><span class="w"> </span><span class="n">box</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">strong</span><span class="w"> </span><span class="n">passwords</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">easy</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">break</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">really</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="n">secret</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">memorized</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">human</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">password</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">easily</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">urandom</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">whatever</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">unguessable</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">brute</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="n">attack</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">possible</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">format</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">user</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="n">acl</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">user</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="o">+</span><span class="nd">@list</span><span class="w"> </span><span class="o">+</span><span class="nd">@connection</span><span class="w"> </span><span class="o">~</span><span class="n">jobs</span><span class="p">:</span><span class="o">*</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">&gt;</span><span class="n">ffa9203c493aa99</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="s">&#34;default&#34;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">connections</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;nopass&#34;</span><span class="w"> </span><span class="n">rule</span><span class="p">,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">immediately</span><span class="w"> </span><span class="n">authenticated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;default&#34;</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">provided</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="w"> </span><span class="n">Otherwise</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;default&#34;</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">flagged</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="s">&#34;nopass&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">require</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="p">(</span><span class="n">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">HELLO</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="n">option</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">describe</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">on</span><span class="w">           </span><span class="n">Enable</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">off</span><span class="w">          </span><span class="n">Disable</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">it</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">longer</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">authenticate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">with</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">however</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="n">connections</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">will</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="o">+&lt;</span><span class="n">command</span><span class="o">&gt;</span><span class="w">   </span><span class="n">Allow</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">command</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="o">-&lt;</span><span class="n">command</span><span class="o">&gt;</span><span class="w">   </span><span class="n">Disallow</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">command</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="o">+</span><span class="err">@</span><span class="o">&lt;</span><span class="n">category</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Allow</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">with</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="nd">@admin</span><span class="p">,</span><span class="w"> </span><span class="nd">@set</span><span class="p">,</span><span class="w"> </span><span class="nd">@sortedset</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="na">c</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">described</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">defined</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">The</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="nd">@all</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">commands</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">currently</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">present</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">via</span><span class="w"> </span><span class="n">modules</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="o">+&lt;</span><span class="n">command</span><span class="o">&gt;|</span><span class="n">subcommand</span><span class="w">    </span><span class="n">Allow</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">subcommand</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">otherwise</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">                           </span><span class="n">disabled</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">                           </span><span class="n">allowed</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">negative</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="o">-</span><span class="n">DEBUG</span><span class="o">|</span><span class="n">SEGFAULT</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">                           </span><span class="n">only</span><span class="w"> </span><span class="n">additive</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="s">&#34;+&#34;</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">allcommands</span><span class="w">  </span><span class="n">Alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">+</span><span class="nd">@all.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">implies</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ability</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">execute</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">modules</span><span class="w"> </span><span class="n">system</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">nocommands</span><span class="w">   </span><span class="n">Alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">-</span><span class="nd">@all.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="o">~&lt;</span><span class="n">pattern</span><span class="o">&gt;</span><span class="w">   </span><span class="n">Add</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">mentioned</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">commands</span><span class="p">.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">~*</span><span class="w"> </span><span class="n">allows</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">keys</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">pattern</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">glob</span><span class="o">-</span><span class="n">style</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">KEYS</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">patterns</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">allkeys</span><span class="w">      </span><span class="n">Alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">~*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">resetkeys</span><span class="w">    </span><span class="n">Flush</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">patterns</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="o">&gt;&lt;</span><span class="n">password</span><span class="o">&gt;</span><span class="w">  </span><span class="n">Add</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">passowrd</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="o">&gt;</span><span class="n">mypass</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="s">&#34;mypass&#34;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">This</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">clears</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;nopass&#34;</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">later</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="n">password</span><span class="o">&gt;</span><span class="w">  </span><span class="n">Remove</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">passwords</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">nopass</span><span class="w">       </span><span class="n">All</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">passwords</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">removed</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">is</span><span class="w"> </span><span class="n">flagged</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">requiring</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">password</span><span class="p">:</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">every</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">password</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">immediately</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">without</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">any</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">required</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;resetpass&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">directive</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">clear</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">condition</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">resetpass</span><span class="w">    </span><span class="n">Flush</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">passwords</span><span class="p">.</span><span class="w"> </span><span class="n">Moreover</span><span class="w"> </span><span class="n">removes</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="s">&#34;nopass&#34;</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="w"> </span><span class="n">After</span><span class="w"> </span><span class="s">&#34;resetpass&#34;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">associated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">passwords</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">adding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">some</span><span class="w"> </span><span class="nf">password</span><span class="w"> </span><span class="p">(</span><span class="n">or</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="s">&#34;nopass&#34;</span><span class="w"> </span><span class="n">later</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">reset</span><span class="w">        </span><span class="n">Performs</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">actions</span><span class="p">:</span><span class="w"> </span><span class="n">resetpass</span><span class="p">,</span><span class="w"> </span><span class="n">resetkeys</span><span class="p">,</span><span class="w"> </span><span class="n">off</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="o">-</span><span class="nd">@all.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">immediately</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">               </span><span class="n">after</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">creation</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">order</span><span class="p">:</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">passwords</span><span class="p">,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">patterns</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">additive</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">subtractive</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">CHANGE</span><span class="w"> </span><span class="n">MEANING</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ordering</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">example</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">user</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">+</span><span class="nd">@all</span><span class="w"> </span><span class="o">-</span><span class="n">DEBUG</span><span class="w"> </span><span class="o">~*</span><span class="w"> </span><span class="o">&gt;</span><span class="n">somepassword</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="s">&#34;alice&#34;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="o">+</span><span class="nd">@all</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">use</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">removed</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">invert</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">different</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">user</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">-</span><span class="n">DEBUG</span><span class="w"> </span><span class="o">+</span><span class="nd">@all</span><span class="w"> </span><span class="o">~*</span><span class="w"> </span><span class="o">&gt;</span><span class="n">somepassword</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Now</span><span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="n">had</span><span class="w"> </span><span class="n">yet</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">allowed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">commands</span><span class="p">,</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">added</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">everything</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Basically</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="n">left</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">right</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">please</span><span class="w"> </span><span class="n">refer</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">web</span><span class="w"> </span><span class="n">site</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//redis.io/topics/acl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">LOG</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">tracks</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">authentication</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">associated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">ACLs</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">troubleshoot</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">blocked</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">ACLs</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">memory</span><span class="p">.</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">reclaim</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">with</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="n">RESET</span><span class="p">.</span><span class="w"> </span><span class="n">Define</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">below</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">acllog</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">len</span><span class="w"> </span><span class="n">128</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">configuring</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">stand</span><span class="o">-</span><span class="n">alone</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">listing</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">mixed</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">activate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">exteranl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">refuse</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">start</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">exactly</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">redis</span><span class="p">.</span><span class="na">conf</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">describe</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">aclfile</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="n">users</span><span class="p">.</span><span class="na">acl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">IMPORTANT</span><span class="w"> </span><span class="n">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">6</span><span class="w"> </span><span class="s">&#34;requirepass&#34;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">compatiblity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ACL</span><span class="w"> </span><span class="n">system</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">effect</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">setting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="w"> </span><span class="n">Clients</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="n">using</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">usually</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">explicitly</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">AUTH</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">protocol</span><span class="p">:</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">requirepass</span><span class="w"> </span><span class="n">foobared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="nf">renaming</span><span class="w"> </span><span class="p">(</span><span class="n">DEPRECATED</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">------------------------------------------------------------------------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">WARNING</span><span class="p">:</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span><span class="p">.</span><span class="w"> </span><span class="n">Instead</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">ACLs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">remove</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">put</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">admin</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">you</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">administrative</span><span class="w"> </span><span class="n">purposes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">------------------------------------------------------------------------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">shared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CONFIG</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">renamed</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">something</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">guess</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">internal</span><span class="o">-</span><span class="n">use</span><span class="w"> </span><span class="n">tools</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">general</span><span class="w"> </span><span class="n">clients</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Example</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">rename</span><span class="o">-</span><span class="n">command</span><span class="w"> </span><span class="n">CONFIG</span><span class="w"> </span><span class="n">b840fc02d524045429941cc15f59e41cb7be6c52</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">completely</span><span class="w"> </span><span class="n">kill</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">renaming</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">into</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">string</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">rename</span><span class="o">-</span><span class="n">command</span><span class="w"> </span><span class="n">CONFIG</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">changing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">logged</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">transmitted</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">problems</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">###################################</span><span class="w"> </span><span class="n">CLIENTS</span><span class="w"> </span><span class="err">####################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">10000</span><span class="w"> </span><span class="n">clients</span><span class="p">,</span><span class="w"> </span><span class="n">however</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">limit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">limit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">minus</span><span class="w"> </span><span class="nf">32</span><span class="w"> </span><span class="p">(</span><span class="n">as</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">reserves</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">few</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">descriptors</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="n">uses</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Once</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">sending</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="err">&#39;</span><span class="n">max</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">reached</span><span class="err">&#39;</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">IMPORTANT</span><span class="p">:</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">also</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">bus</span><span class="p">:</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">two</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">connections</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">incoming</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">outgoing</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">accordingly</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="n">clusters</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">maxclients</span><span class="w"> </span><span class="n">10000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">##############################</span><span class="w"> </span><span class="n">MEMORY</span><span class="w"> </span><span class="n">MANAGEMENT</span><span class="w"> </span><span class="err">################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">bytes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">keys</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">according</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">eviction</span><span class="w"> </span><span class="n">policy</span><span class="w"> </span><span class="nf">selected</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">maxmemory</span><span class="o">-</span><span class="n">policy</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">according</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">policy</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">policy</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="n">noeviction</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reply</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">memory</span><span class="p">,</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">SET</span><span class="p">,</span><span class="w"> </span><span class="n">LPUSH</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">on</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">continue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reply</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">GET</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">LRU</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">LFU</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="nf">instance</span><span class="w"> </span><span class="p">(</span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">&#39;</span><span class="n">noeviction</span><span class="err">&#39;</span><span class="w"> </span><span class="n">policy</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">WARNING</span><span class="p">:</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">attached</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">maxmemory</span><span class="w"> </span><span class="n">on</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">buffers</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">feed</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">subtracted</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">problems</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">resyncs</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">trigger</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">evicted</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">DELs</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">evicted</span><span class="w"> </span><span class="n">triggering</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">deletion</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">keys</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">completely</span><span class="w"> </span><span class="n">emptied</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="kt">short</span><span class="p">...</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">attached</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">suggested</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lower</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">maxmemory</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">RAM</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="nf">buffers</span><span class="w"> </span><span class="p">(</span><span class="n">but</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">policy</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="err">&#39;</span><span class="n">noeviction</span><span class="err">&#39;</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">maxmemory</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bytes</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">MAXMEMORY</span><span class="w"> </span><span class="n">POLICY</span><span class="p">:</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">maxmemory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="p">.</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">behaviors</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="kd">volatile</span><span class="o">-</span><span class="n">lru</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Evict</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">approximated</span><span class="w"> </span><span class="n">LRU</span><span class="p">,</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">expire</span><span class="w"> </span><span class="n">set</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">allkeys</span><span class="o">-</span><span class="n">lru</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Evict</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">approximated</span><span class="w"> </span><span class="n">LRU</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="kd">volatile</span><span class="o">-</span><span class="n">lfu</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Evict</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">approximated</span><span class="w"> </span><span class="n">LFU</span><span class="p">,</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">expire</span><span class="w"> </span><span class="n">set</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">allkeys</span><span class="o">-</span><span class="n">lfu</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Evict</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">approximated</span><span class="w"> </span><span class="n">LFU</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="kd">volatile</span><span class="o">-</span><span class="n">random</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">having</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">expire</span><span class="w"> </span><span class="n">set</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">allkeys</span><span class="o">-</span><span class="n">random</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="kd">volatile</span><span class="o">-</span><span class="n">ttl</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">nearest</span><span class="w"> </span><span class="n">expire</span><span class="w"> </span><span class="nf">time</span><span class="w"> </span><span class="p">(</span><span class="n">minor</span><span class="w"> </span><span class="n">TTL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">noeviction</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">evict</span><span class="w"> </span><span class="n">anything</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">operations</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">LRU</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">Least</span><span class="w"> </span><span class="n">Recently</span><span class="w"> </span><span class="n">Used</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">LFU</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">Least</span><span class="w"> </span><span class="n">Frequently</span><span class="w"> </span><span class="n">Used</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Both</span><span class="w"> </span><span class="n">LRU</span><span class="p">,</span><span class="w"> </span><span class="n">LFU</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="kd">volatile</span><span class="o">-</span><span class="n">ttl</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">approximated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">randomized</span><span class="w"> </span><span class="n">algorithms</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="p">:</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">policies</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">write</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">       </span><span class="n">operations</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">suitable</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">eviction</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">       </span><span class="n">At</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">are</span><span class="p">:</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">setnx</span><span class="w"> </span><span class="n">setex</span><span class="w"> </span><span class="n">append</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">       </span><span class="n">incr</span><span class="w"> </span><span class="n">decr</span><span class="w"> </span><span class="n">rpush</span><span class="w"> </span><span class="n">lpush</span><span class="w"> </span><span class="n">rpushx</span><span class="w"> </span><span class="n">lpushx</span><span class="w"> </span><span class="n">linsert</span><span class="w"> </span><span class="n">lset</span><span class="w"> </span><span class="n">rpoplpush</span><span class="w"> </span><span class="n">sadd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">       </span><span class="n">sinter</span><span class="w"> </span><span class="n">sinterstore</span><span class="w"> </span><span class="n">sunion</span><span class="w"> </span><span class="n">sunionstore</span><span class="w"> </span><span class="n">sdiff</span><span class="w"> </span><span class="n">sdiffstore</span><span class="w"> </span><span class="n">zadd</span><span class="w"> </span><span class="n">zincrby</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">       </span><span class="n">zunionstore</span><span class="w"> </span><span class="n">zinterstore</span><span class="w"> </span><span class="n">hset</span><span class="w"> </span><span class="n">hsetnx</span><span class="w"> </span><span class="n">hmset</span><span class="w"> </span><span class="n">hincrby</span><span class="w"> </span><span class="n">incrby</span><span class="w"> </span><span class="n">decrby</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">       </span><span class="n">getset</span><span class="w"> </span><span class="n">mset</span><span class="w"> </span><span class="n">msetnx</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="n">sort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">is</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">maxmemory</span><span class="o">-</span><span class="n">policy</span><span class="w"> </span><span class="n">noeviction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">LRU</span><span class="p">,</span><span class="w"> </span><span class="n">LFU</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">TTL</span><span class="w"> </span><span class="n">algorithms</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">precise</span><span class="w"> </span><span class="n">algorithms</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">approximated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">algorithms</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">memory</span><span class="p">),</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">tune</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="n">or</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">accuracy</span><span class="p">.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">five</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">pick</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">was</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">recently</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">5</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">Approximates</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">closely</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="n">LRU</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">costs</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">CPU</span><span class="p">.</span><span class="w"> </span><span class="n">3</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">accurate</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">maxmemory</span><span class="o">-</span><span class="n">samples</span><span class="w"> </span><span class="n">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">5</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">ignore</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">maxmemory</span><span class="w"> </span><span class="n">setting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">unless</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">promoted</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">failover</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">manually</span><span class="p">).</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">means</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">eviction</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">handled</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="n">sending</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">DEL</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">evict</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">side</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">behavior</span><span class="w"> </span><span class="n">ensures</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">masters</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">stay</span><span class="w"> </span><span class="n">consistent</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">usually</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="p">,</span><span class="w"> </span><span class="n">however</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">writable</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">setting</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">performed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">idempotent</span><span class="p">,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nf">default</span><span class="w"> </span><span class="p">(</span><span class="n">but</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">sure</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">understand</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">doing</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">evict</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">more</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="nf">maxmemory</span><span class="w"> </span><span class="p">(</span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="n">buffers</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">may</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">larger</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">structures</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">sometimes</span><span class="w"> </span><span class="n">take</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">memory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="p">).</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">monitor</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">they</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">hit</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">real</span><span class="w"> </span><span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">maxmemory</span><span class="w"> </span><span class="n">setting</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">ignore</span><span class="o">-</span><span class="n">maxmemory</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">reclaims</span><span class="w"> </span><span class="n">expired</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">ways</span><span class="p">:</span><span class="w"> </span><span class="n">upon</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">are</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">expired</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">background</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;active expire key&#34;</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">slowly</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">interactively</span><span class="w"> </span><span class="n">scanned</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">looking</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">expired</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reclaim</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">memory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">expired</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">accessed</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">effort</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">expire</span><span class="w"> </span><span class="n">cycle</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">having</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">than</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">ten</span><span class="w"> </span><span class="n">percent</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">expired</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">memory</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">consuming</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">25</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">increase</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">expire</span><span class="w"> </span><span class="s">&#34;effort&#34;</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">normally</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;1&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">greater</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="s">&#34;10&#34;</span><span class="p">.</span><span class="w"> </span><span class="n">At</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">CPU</span><span class="p">,</span><span class="w"> </span><span class="n">longer</span><span class="w"> </span><span class="nf">cycles</span><span class="w"> </span><span class="p">(</span><span class="n">and</span><span class="w"> </span><span class="n">technically</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">introduce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">latency</span><span class="p">),</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">tollerate</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">expired</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">present</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">tradeoff</span><span class="w"> </span><span class="n">betweeen</span><span class="w"> </span><span class="n">memory</span><span class="p">,</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">latecy</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">active</span><span class="o">-</span><span class="n">expire</span><span class="o">-</span><span class="n">effort</span><span class="w"> </span><span class="n">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#############################</span><span class="w"> </span><span class="n">LAZY</span><span class="w"> </span><span class="n">FREEING</span><span class="w"> </span><span class="err">####################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">primitives</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">keys</span><span class="p">.</span><span class="w"> </span><span class="n">One</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">DEL</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">blocking</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">deletion</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">stops</span><span class="w"> </span><span class="n">processing</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reclaim</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">synchronous</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">way</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">deleted</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">needed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DEL</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">comparable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">other</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">O</span><span class="p">(</span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="nf">O</span><span class="p">(</span><span class="n">log_N</span><span class="p">)</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">Redis</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">aggregated</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="n">millions</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">elements</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="k">for</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">time</span><span class="w"> </span><span class="p">(</span><span class="n">even</span><span class="w"> </span><span class="n">seconds</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">operation</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">reasons</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">offers</span><span class="w"> </span><span class="n">non</span><span class="w"> </span><span class="n">blocking</span><span class="w"> </span><span class="n">deletion</span><span class="w"> </span><span class="n">primitives</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="nf">UNLINK</span><span class="w"> </span><span class="p">(</span><span class="n">non</span><span class="w"> </span><span class="n">blocking</span><span class="w"> </span><span class="n">DEL</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ASYNC</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">FLUSHALL</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">FLUSHDB</span><span class="w"> </span><span class="n">commands</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reclaim</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">background</span><span class="p">.</span><span class="w"> </span><span class="n">Those</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="w"> </span><span class="n">Another</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">incrementally</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">possible</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">DEL</span><span class="p">,</span><span class="w"> </span><span class="n">UNLINK</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">ASYNC</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">FLUSHALL</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">FLUSHDB</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">controlled</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">understand</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">good</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">idea</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">sometimes</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">flush</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">whole</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">effect</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">operations</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Specifically</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">deletes</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">independently</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">scenarios</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">On</span><span class="w"> </span><span class="n">eviction</span><span class="p">,</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">maxmemory</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">maxmemory</span><span class="w"> </span><span class="n">policy</span><span class="w"> </span><span class="n">configurations</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">room</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">going</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="n">limit</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">Because</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">expire</span><span class="p">:</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nf">live</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">EXPIRE</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">deleted</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">memory</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">3</span><span class="p">)</span><span class="w"> </span><span class="n">Because</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">effect</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">stores</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">may</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">already</span><span class="w"> </span><span class="n">exist</span><span class="p">.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RENAME</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">content</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">replaced</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">one</span><span class="p">.</span><span class="w"> </span><span class="n">Similarly</span><span class="w"> </span><span class="n">SUNIONSTORE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">or</span><span class="w"> </span><span class="n">SORT</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="n">keys</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">command</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">itself</span><span class="w"> </span><span class="n">removes</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">replace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">4</span><span class="p">)</span><span class="w"> </span><span class="n">During</span><span class="w"> </span><span class="n">replication</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">performs</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="n">resynchronization</span><span class="w"> </span><span class="n">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">its</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">whole</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">load</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">transferred</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">cases</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">blocking</span><span class="w"> </span><span class="n">way</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">DEL</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">called</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">specifically</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">blocking</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">UNLINK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">called</span><span class="p">,</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directives</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lazyfree</span><span class="o">-</span><span class="n">lazy</span><span class="o">-</span><span class="n">eviction</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lazyfree</span><span class="o">-</span><span class="n">lazy</span><span class="o">-</span><span class="n">expire</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lazyfree</span><span class="o">-</span><span class="n">lazy</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">del</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">replica</span><span class="o">-</span><span class="n">lazy</span><span class="o">-</span><span class="n">flush</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">possible</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">DEL</span><span class="w"> </span><span class="n">calls</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">UNLINK</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">easy</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">behavior</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DEL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">act</span><span class="w"> </span><span class="n">exactly</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">UNLINK</span><span class="p">,</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">directive</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lazyfree</span><span class="o">-</span><span class="n">lazy</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">del</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">################################</span><span class="w"> </span><span class="n">THREADED</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="err">#################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">mostly</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">threaded</span><span class="p">,</span><span class="w"> </span><span class="n">however</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="n">threaded</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">UNLINK</span><span class="p">,</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">accesses</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">threads</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Now</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">writes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">threads</span><span class="p">.</span><span class="w"> </span><span class="n">Since</span><span class="w"> </span><span class="n">especially</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">slow</span><span class="p">,</span><span class="w"> </span><span class="n">normally</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">pipelining</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">speedup</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">performances</span><span class="w"> </span><span class="n">per</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">core</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">spawn</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="n">more</span><span class="p">.</span><span class="w"> </span><span class="n">Using</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">easily</span><span class="w"> </span><span class="n">speedup</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">resorting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pipelining</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="n">sharding</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">threading</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">disabled</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">suggest</span><span class="w"> </span><span class="n">enabling</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">machines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">4</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">cores</span><span class="p">,</span><span class="w"> </span><span class="n">leaving</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">spare</span><span class="w"> </span><span class="n">core</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Using</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">8</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">unlikely</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">much</span><span class="p">.</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">recommend</span><span class="w"> </span><span class="n">using</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">threaded</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">problems</span><span class="p">,</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quite</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">feature</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">four</span><span class="w"> </span><span class="n">cores</span><span class="w"> </span><span class="n">boxes</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">2</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">3</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">threads</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">8</span><span class="w"> </span><span class="n">cores</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">6</span><span class="w"> </span><span class="n">threads</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">io</span><span class="o">-</span><span class="n">threads</span><span class="w"> </span><span class="n">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="n">io</span><span class="o">-</span><span class="n">threads</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">usually</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">enabled</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">writes</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">syscall</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">buffers</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">threading</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">parsing</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">setting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">yes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">io</span><span class="o">-</span><span class="n">threads</span><span class="o">-</span><span class="k">do</span><span class="o">-</span><span class="n">reads</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Usually</span><span class="w"> </span><span class="n">threading</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">doesn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">much</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">NOTE</span><span class="w"> </span><span class="n">1</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">via</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">CONFIG</span><span class="w"> </span><span class="n">SET</span><span class="p">.</span><span class="w"> </span><span class="n">Aso</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">currently</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">SSL</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">enabled</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">NOTE</span><span class="w"> </span><span class="n">2</span><span class="p">:</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">speedup</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">redis</span><span class="o">-</span><span class="n">benchmark</span><span class="p">,</span><span class="w"> </span><span class="n">make</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">itself</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">threaded</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">--</span><span class="n">threads</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">theads</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">you</span><span class="err">&#39;</span><span class="n">ll</span><span class="w"> </span><span class="n">not</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">notice</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">improvements</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">############################</span><span class="w"> </span><span class="n">KERNEL</span><span class="w"> </span><span class="n">OOM</span><span class="w"> </span><span class="n">CONTROL</span><span class="w"> </span><span class="err">##############################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">On</span><span class="w"> </span><span class="n">Linux</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">hint</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">OOM</span><span class="w"> </span><span class="n">killer</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">processes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">killed</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">memory</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Enabling</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">actively</span><span class="w"> </span><span class="n">control</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">oom_score_adj</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">processes</span><span class="p">,</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">role</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">scores</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">processes</span><span class="w"> </span><span class="n">killed</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">others</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">killed</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">masters</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">oom</span><span class="o">-</span><span class="n">score</span><span class="o">-</span><span class="n">adj</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">oom</span><span class="o">-</span><span class="n">score</span><span class="o">-</span><span class="n">adj</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">controls</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">used</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">processes</span><span class="p">.</span><span class="w"> </span><span class="n">Values</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">-</span><span class="n">1000</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1000</span><span class="w"> </span><span class="p">(</span><span class="n">higher</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">killed</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Unprivileged</span><span class="w"> </span><span class="nf">processes</span><span class="w"> </span><span class="p">(</span><span class="n">not</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">CAP_SYS_RESOURCE</span><span class="w"> </span><span class="n">capabilities</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">freely</span><span class="w"> </span><span class="n">increase</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">decrease</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">below</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">initial</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">settings</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Values</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">relative</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">oom_score_adj</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">starts</span><span class="p">.</span><span class="w"> </span><span class="n">Because</span><span class="w"> </span><span class="n">typically</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">often</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">absolute</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">oom</span><span class="o">-</span><span class="n">score</span><span class="o">-</span><span class="n">adj</span><span class="o">-</span><span class="n">values</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">200</span><span class="w"> </span><span class="n">800</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">##############################</span><span class="w"> </span><span class="n">APPEND</span><span class="w"> </span><span class="n">ONLY</span><span class="w"> </span><span class="n">MODE</span><span class="w"> </span><span class="err">###############################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">asynchronously</span><span class="w"> </span><span class="n">dumps</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">disk</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">applications</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">or</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">outage</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">few</span><span class="w"> </span><span class="n">minutes</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="nf">lost</span><span class="w"> </span><span class="p">(</span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">points</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Append</span><span class="w"> </span><span class="n">Only</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">persistence</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">provides</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">much</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">durability</span><span class="p">.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">fsync</span><span class="w"> </span><span class="n">policy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">lose</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">dramatic</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">outage</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">something</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">itself</span><span class="w"> </span><span class="n">happens</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">correctly</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">persistence</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">problems</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">startup</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">durability</span><span class="w"> </span><span class="n">guarantees</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//redis.io/topics/persistence for more information.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">appendonly</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">append</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="nf">file</span><span class="w"> </span><span class="p">(</span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;appendonly.aof&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">appendfilename</span><span class="w"> </span><span class="s">&#34;appendonly.aof&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="nf">fsync</span><span class="p">()</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">tells</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Operating</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">disk</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">really</span><span class="w"> </span><span class="n">flush</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">disk</span><span class="p">,</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">ASAP</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">modes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">no</span><span class="p">:</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">fsync</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">flush</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">wants</span><span class="p">.</span><span class="w"> </span><span class="n">Faster</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">always</span><span class="p">:</span><span class="w"> </span><span class="n">fsync</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">append</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="w"> </span><span class="n">Slow</span><span class="p">,</span><span class="w"> </span><span class="n">Safest</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">everysec</span><span class="p">:</span><span class="w"> </span><span class="n">fsync</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">second</span><span class="p">.</span><span class="w"> </span><span class="n">Compromise</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="s">&#34;everysec&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">that</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="n">compromise</span><span class="w"> </span><span class="n">between</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">safety</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">understand</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">relax</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;no&#34;</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">flush</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">when</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">wants</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="nf">performances</span><span class="w"> </span><span class="p">(</span><span class="n">but</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">idea</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">loss</span><span class="w"> </span><span class="n">consider</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">persistence</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">that</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">snapshotting</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">contrary</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="s">&#34;always&#34;</span><span class="w"> </span><span class="n">that</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bit</span><span class="w"> </span><span class="n">safer</span><span class="w"> </span><span class="n">than</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">everysec</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">More</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="n">please</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">article</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//antirez.com/post/redis-persistence-demystified.html</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">unsure</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="s">&#34;everysec&#34;</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">appendfsync</span><span class="w"> </span><span class="n">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">appendfsync</span><span class="w"> </span><span class="n">everysec</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">appendfsync</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">fsync</span><span class="w"> </span><span class="n">policy</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">everysec</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">background</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="nf">process</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">rewriting</span><span class="p">)</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">performing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">configurations</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nf">fsync</span><span class="p">()</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">fix</span><span class="w"> </span><span class="k">for</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">currently</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="n">performing</span><span class="w"> </span><span class="n">fsync</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">block</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">synchronous</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mitigate</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">problem</span><span class="w"> </span><span class="n">it</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">option</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="nf">fsync</span><span class="p">()</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">BGSAVE</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">BGREWRITEAOF</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">progress</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">saving</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">durability</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="s">&#34;appendfsync none&#34;</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">practical</span><span class="w"> </span><span class="n">terms</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">lose</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">30</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">worst</span><span class="w"> </span><span class="nf">scenario</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">settings</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">problems</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&#34;yes&#34;</span><span class="p">.</span><span class="w"> </span><span class="n">Otherwise</span><span class="w"> </span><span class="n">leave</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">as</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;no&#34;</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">safest</span><span class="w"> </span><span class="n">pick</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">durability</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">no</span><span class="o">-</span><span class="n">appendfsync</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">rewrite</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Automatic</span><span class="w"> </span><span class="n">rewrite</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">append</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">rewrite</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">implicitly</span><span class="w"> </span><span class="n">calling</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">BGREWRITEAOF</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">grows</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">percentage</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">works</span><span class="p">:</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">remembers</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">latest</span><span class="w"> </span><span class="nf">rewrite</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">rewrite</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">happened</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">restart</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">startup</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">compared</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">size</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">bigger</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">percentage</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">rewrite</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">triggered</span><span class="p">.</span><span class="w"> </span><span class="n">Also</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">rewritten</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">rewriting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="n">increase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">pretty</span><span class="w"> </span><span class="n">small</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">automatic</span><span class="w"> </span><span class="n">AOF</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">rewrite</span><span class="w"> </span><span class="n">feature</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">auto</span><span class="o">-</span><span class="n">aof</span><span class="o">-</span><span class="n">rewrite</span><span class="o">-</span><span class="n">percentage</span><span class="w"> </span><span class="n">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">auto</span><span class="o">-</span><span class="n">aof</span><span class="o">-</span><span class="n">rewrite</span><span class="o">-</span><span class="n">min</span><span class="o">-</span><span class="n">size</span><span class="w"> </span><span class="n">64mb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">truncated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">startup</span><span class="w"> </span><span class="n">process</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">gets</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">memory</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">running</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">crashes</span><span class="p">,</span><span class="w"> </span><span class="n">especially</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">ext4</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">mounted</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ordered</span><span class="w"> </span><span class="nf">option</span><span class="w"> </span><span class="p">(</span><span class="n">however</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">itself</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">crashes</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">aborts</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">happens</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">much</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="nf">possible</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">now</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">found</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">truncated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">controls</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">behavior</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">aof</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">truncated</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">yes</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">truncated</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="n">emitting</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">inform</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Otherwise</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">aborts</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">refuses</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">start</span><span class="p">.</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">requires</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">fix</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;redis-check-aof&#34;</span><span class="w"> </span><span class="n">utility</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">restart</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">corrupted</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">middle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">applies</span><span class="w"> </span><span class="n">when</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="n">bytes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">found</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">aof</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">truncated</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">rewriting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">preamble</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">rewrites</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">recoveries</span><span class="p">.</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">turned</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">rewritten</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">composed</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">stanzas</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="o">[</span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="o">][</span><span class="n">AOF</span><span class="w"> </span><span class="n">tail</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">loading</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">recognizes</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;REDIS&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">loads</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prefixed</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">continues</span><span class="w"> </span><span class="n">loading</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tail</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">aof</span><span class="o">-</span><span class="n">use</span><span class="o">-</span><span class="n">rdb</span><span class="o">-</span><span class="n">preamble</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">################################</span><span class="w"> </span><span class="n">LUA</span><span class="w"> </span><span class="n">SCRIPTING</span><span class="w">  </span><span class="err">###############################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Max</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Lua</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">milliseconds</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">reply</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">exceeds</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">SCRIPT</span><span class="w"> </span><span class="n">KILL</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">SHUTDOWN</span><span class="w"> </span><span class="n">NOSAVE</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">available</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">yet</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">second</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">shut</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">was</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">issued</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">doesn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">natural</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">termination</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">script</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">negative</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">unlimited</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">warnings</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lua</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="n">limit</span><span class="w"> </span><span class="n">5000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">################################</span><span class="w"> </span><span class="n">REDIS</span><span class="w"> </span><span class="n">CLUSTER</span><span class="w">  </span><span class="err">###############################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Normal</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Cluster</span><span class="p">;</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">started</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">uncommenting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">enabled</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Every</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">intended</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">edited</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">hand</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">nodes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Every</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">have</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">overlapping</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="n">nodes</span><span class="o">-</span><span class="n">6379</span><span class="p">.</span><span class="na">conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">milliseconds</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">unreachable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">considered</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Most</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">limits</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">timeout</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">timeout</span><span class="w"> </span><span class="n">15000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">failing</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">failover</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">looks</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">old</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">There</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">simple</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exact</span><span class="w"> </span><span class="n">measure</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="s">&#34;data age&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">checks</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">performed</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">failover</span><span class="p">,</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">exchange</span><span class="w"> </span><span class="n">messages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">give</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">advantage</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">best</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">replication</span><span class="w"> </span><span class="nf">offset</span><span class="w"> </span><span class="p">(</span><span class="n">more</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">processed</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">Replicas</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">rank</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">start</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">failover</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="n">proportional</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">rank</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">Every</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">computes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">interaction</span><span class="w"> </span><span class="n">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">its</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="nf">received</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">is</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;connected&#34;</span><span class="w"> </span><span class="n">state</span><span class="p">),</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">elapsed</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">disconnection</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nf">master</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">currently</span><span class="w"> </span><span class="n">down</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">interaction</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">old</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">failover</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">all</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="s">&#34;2&#34;</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">tuned</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="w"> </span><span class="n">Specifically</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">perform</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">failover</span><span class="w"> </span><span class="k">if</span><span class="p">,</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">interaction</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">elapsed</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">greater</span><span class="w"> </span><span class="n">than</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="p">(</span><span class="n">node</span><span class="o">-</span><span class="n">timeout</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">validity</span><span class="o">-</span><span class="n">factor</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">ping</span><span class="o">-</span><span class="n">replica</span><span class="o">-</span><span class="n">period</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">node</span><span class="o">-</span><span class="n">timeout</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">30</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">validity</span><span class="o">-</span><span class="n">factor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">10</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">assuming</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">ping</span><span class="o">-</span><span class="n">replica</span><span class="o">-</span><span class="n">period</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">failover</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">talk</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">longer</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">310</span><span class="w"> </span><span class="n">seconds</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">validity</span><span class="o">-</span><span class="n">factor</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">failover</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">elect</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">all</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">availability</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replica</span><span class="o">-</span><span class="n">validity</span><span class="o">-</span><span class="n">factor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">means</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">failover</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">regardless</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">interacted</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">However</span><span class="w"> </span><span class="n">they</span><span class="err">&#39;</span><span class="n">ll</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="n">proportional</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">their</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="n">rank</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Zero</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">guarantee</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="n">heal</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">continue</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">replica</span><span class="o">-</span><span class="n">validity</span><span class="o">-</span><span class="n">factor</span><span class="w"> </span><span class="n">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">migrate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">orphaned</span><span class="w"> </span><span class="n">masters</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">masters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">replicas</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">improves</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">ability</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resist</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">orphaned</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">over</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">replicas</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Replicas</span><span class="w"> </span><span class="n">migrate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">orphaned</span><span class="w"> </span><span class="n">masters</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">number</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;migration barrier&#34;</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">migration</span><span class="w"> </span><span class="n">barrier</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">migrate</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="n">reflects</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">every</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">cluster</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="nf">1</span><span class="w"> </span><span class="p">(</span><span class="n">replicas</span><span class="w"> </span><span class="n">migrate</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">masters</span><span class="w"> </span><span class="n">remain</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">replica</span><span class="p">).</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="n">migration</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">debugging</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">dangerous</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">production</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">migration</span><span class="o">-</span><span class="n">barrier</span><span class="w"> </span><span class="n">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">accepting</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">detect</span><span class="w"> </span><span class="n">there</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="n">slot</span><span class="w"> </span><span class="nf">uncovered</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">serving</span><span class="w"> </span><span class="n">it</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">partially</span><span class="w"> </span><span class="nf">down</span><span class="w"> </span><span class="p">(</span><span class="k">for</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="n">slots</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">longer</span><span class="w"> </span><span class="n">covered</span><span class="p">)</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">becomes</span><span class="p">,</span><span class="w"> </span><span class="n">eventually</span><span class="p">,</span><span class="w"> </span><span class="n">unavailable</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">soon</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">slots</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">covered</span><span class="w"> </span><span class="n">again</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">sometimes</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">subset</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">working</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">still</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">covered</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">so</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">require</span><span class="o">-</span><span class="n">full</span><span class="o">-</span><span class="n">coverage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">no</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">require</span><span class="o">-</span><span class="n">full</span><span class="o">-</span><span class="n">coverage</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">option</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">yes</span><span class="p">,</span><span class="w"> </span><span class="n">prevents</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">failover</span><span class="w"> </span><span class="n">its</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">failures</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">manual</span><span class="w"> </span><span class="n">failover</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">forced</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">so</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">scenarios</span><span class="p">,</span><span class="w"> </span><span class="n">especially</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">multiple</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">center</span><span class="w"> </span><span class="n">operations</span><span class="p">,</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">promoted</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">not</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">DC</span><span class="w"> </span><span class="n">failure</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">replica</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">failover</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">option</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">yes</span><span class="p">,</span><span class="w"> </span><span class="n">allows</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">believes</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">owns</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">slots</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">cases</span><span class="p">.</span><span class="w">  </span><span class="n">The</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">application</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">doesn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">require</span><span class="w"> </span><span class="n">consistency</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">partitions</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">One</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">it</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">configurations</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">meet</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">recommended</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">shards</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="n">later</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">outage</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">2</span><span class="w"> </span><span class="n">shard</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">causes</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="w"> </span><span class="n">outage</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">entire</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">set</span><span class="p">,</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">outage</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Without</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quorum</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">masters</span><span class="p">,</span><span class="w"> </span><span class="n">slot</span><span class="w"> </span><span class="n">ownership</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">automatically</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">allow</span><span class="o">-</span><span class="n">reads</span><span class="o">-</span><span class="n">when</span><span class="o">-</span><span class="n">down</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">setup</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">documentation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//redis.io web site.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">##########################</span><span class="w"> </span><span class="n">CLUSTER</span><span class="w"> </span><span class="n">DOCKER</span><span class="o">/</span><span class="n">NAT</span><span class="w"> </span><span class="n">support</span><span class="w">  </span><span class="err">########################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="n">deployments</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">discovery</span><span class="w"> </span><span class="n">fails</span><span class="p">,</span><span class="w"> </span><span class="n">because</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">NAT</span><span class="o">-</span><span class="n">ted</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">ports</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="nf">forwarded</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="n">typical</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">containers</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">environments</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kd">static</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">knows</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">needed</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">are</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">announce</span><span class="o">-</span><span class="n">ip</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">announce</span><span class="o">-</span><span class="n">port</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">announce</span><span class="o">-</span><span class="n">bus</span><span class="o">-</span><span class="n">port</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Each</span><span class="w"> </span><span class="n">instruct</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">message</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">bus</span><span class="w"> </span><span class="n">port</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bus</span><span class="w"> </span><span class="n">packets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">node</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">publishing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">information</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">used</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">auto</span><span class="o">-</span><span class="n">detection</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">instead</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">remapped</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bus</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">10000</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">bus</span><span class="o">-</span><span class="n">port</span><span class="w"> </span><span class="n">depending</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">remapped</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bus</span><span class="o">-</span><span class="n">port</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">set</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">10000</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">usually</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Example</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">announce</span><span class="o">-</span><span class="n">ip</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="na">1</span><span class="p">.</span><span class="na">1</span><span class="p">.</span><span class="na">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">announce</span><span class="o">-</span><span class="n">port</span><span class="w"> </span><span class="n">6379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">announce</span><span class="o">-</span><span class="n">bus</span><span class="o">-</span><span class="n">port</span><span class="w"> </span><span class="n">6380</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">##################################</span><span class="w"> </span><span class="n">SLOW</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="err">###################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Slow</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">exceeded</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">specified</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">operations</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">talking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">sending</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reply</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nf">command</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">only</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">blocked</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">serve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">meantime</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">parameters</span><span class="p">:</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">tells</span><span class="w"> </span><span class="n">Redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">microseconds</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">exceed</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">logged</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">logged</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">oldest</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">logged</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">expressed</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">microseconds</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">1000000</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">equivalent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">second</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">negative</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">disables</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">log</span><span class="p">,</span><span class="w"> </span><span class="k">while</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">forces</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">slowlog</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="n">slower</span><span class="o">-</span><span class="n">than</span><span class="w"> </span><span class="n">10000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">There</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">length</span><span class="p">.</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">aware</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">consume</span><span class="w"> </span><span class="n">memory</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">reclaim</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">SLOWLOG</span><span class="w"> </span><span class="n">RESET</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">slowlog</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">len</span><span class="w"> </span><span class="n">128</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">################################</span><span class="w"> </span><span class="n">LATENCY</span><span class="w"> </span><span class="n">MONITOR</span><span class="w"> </span><span class="err">##############################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="n">subsystem</span><span class="w"> </span><span class="n">samples</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">operations</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">collect</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">related</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">sources</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Via</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">LATENCY</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">can</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">print</span><span class="w"> </span><span class="n">graphs</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">obtain</span><span class="w"> </span><span class="n">reports</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">or</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">greater</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">milliseconds</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">latency</span><span class="o">-</span><span class="n">monitor</span><span class="o">-</span><span class="n">threshold</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directive</span><span class="p">.</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">monitor</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">turned</span><span class="w"> </span><span class="n">off</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">disabled</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">mostly</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">needed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">issues</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">collecting</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">impact</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">small</span><span class="p">,</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">measured</span><span class="w"> </span><span class="n">under</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="w"> </span><span class="n">Latency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">easily</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="s">&#34;CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;&#34;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">needed</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">latency</span><span class="o">-</span><span class="n">monitor</span><span class="o">-</span><span class="n">threshold</span><span class="w"> </span><span class="n">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#############################</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="n">NOTIFICATION</span><span class="w"> </span><span class="err">##############################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">notify</span><span class="w"> </span><span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">happening</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">documented</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//redis.io/topics/notifications</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">keyspace</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">performs</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">DEL</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="s">&#34;foo&#34;</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Database</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">two</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">PUBLISH</span><span class="w"> </span><span class="n">__keyspace</span><span class="nd">@0__</span><span class="p">:</span><span class="n">foo</span><span class="w"> </span><span class="n">del</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">PUBLISH</span><span class="w"> </span><span class="n">__keyevent</span><span class="nd">@0__</span><span class="p">:</span><span class="n">del</span><span class="w"> </span><span class="n">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">notify</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">set</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">classes</span><span class="p">.</span><span class="w"> </span><span class="n">Every</span><span class="w"> </span><span class="kd">class</span> <span class="nc">is</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">character</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">K</span><span class="w">     </span><span class="n">Keyspace</span><span class="w"> </span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">__keyspace</span><span class="err">@</span><span class="o">&lt;</span><span class="n">db</span><span class="o">&gt;</span><span class="n">__</span><span class="w"> </span><span class="n">prefix</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">E</span><span class="w">     </span><span class="n">Keyevent</span><span class="w"> </span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">__keyevent</span><span class="err">@</span><span class="o">&lt;</span><span class="n">db</span><span class="o">&gt;</span><span class="n">__</span><span class="w"> </span><span class="n">prefix</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">g</span><span class="w">     </span><span class="n">Generic</span><span class="w"> </span><span class="nf">commands</span><span class="w"> </span><span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="n">specific</span><span class="p">)</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">DEL</span><span class="p">,</span><span class="w"> </span><span class="n">EXPIRE</span><span class="p">,</span><span class="w"> </span><span class="n">RENAME</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">$</span><span class="w">     </span><span class="n">String</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">l</span><span class="w">     </span><span class="n">List</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">s</span><span class="w">     </span><span class="n">Set</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">h</span><span class="w">     </span><span class="n">Hash</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">z</span><span class="w">     </span><span class="n">Sorted</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">x</span><span class="w">     </span><span class="n">Expired</span><span class="w"> </span><span class="nf">events</span><span class="w"> </span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">expires</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">e</span><span class="w">     </span><span class="n">Evicted</span><span class="w"> </span><span class="nf">events</span><span class="w"> </span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">evicted</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">maxmemory</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">t</span><span class="w">     </span><span class="n">Stream</span><span class="w"> </span><span class="n">commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">m</span><span class="w">     </span><span class="n">Key</span><span class="o">-</span><span class="n">miss</span><span class="w"> </span><span class="nf">events</span><span class="w"> </span><span class="p">(</span><span class="n">Note</span><span class="p">:</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">included</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="w"> </span><span class="kd">class</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span>  <span class="nc">A</span><span class="w">     </span><span class="n">Alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">g$lshzxet</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;AKE&#34;</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">events</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">        </span><span class="p">(</span><span class="n">Except</span><span class="w"> </span><span class="n">key</span><span class="o">-</span><span class="n">miss</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">excluded</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">their</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">         </span><span class="n">unique</span><span class="w"> </span><span class="n">nature</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">The</span><span class="w"> </span><span class="s">&#34;notify-keyspace-events&#34;</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">composed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">of</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">characters</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">notifications</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">are</span><span class="w"> </span><span class="n">disabled</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">Example</span><span class="p">:</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">generic</span><span class="w"> </span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">           </span><span class="n">event</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">notify</span><span class="o">-</span><span class="n">keyspace</span><span class="o">-</span><span class="n">events</span><span class="w"> </span><span class="n">Elg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">Example</span><span class="w"> </span><span class="n">2</span><span class="p">:</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">expired</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">subscribing</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">channel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">             </span><span class="n">name</span><span class="w"> </span><span class="n">__keyevent</span><span class="nd">@0__</span><span class="p">:</span><span class="n">expired</span><span class="w"> </span><span class="n">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">notify</span><span class="o">-</span><span class="n">keyspace</span><span class="o">-</span><span class="n">events</span><span class="w"> </span><span class="n">Ex</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">notifications</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">disabled</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">need</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="k">this</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">overhead</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">  </span><span class="n">specify</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">delivered</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">notify</span><span class="o">-</span><span class="n">keyspace</span><span class="o">-</span><span class="n">events</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">###############################</span><span class="w"> </span><span class="n">GOPHER</span><span class="w"> </span><span class="n">SERVER</span><span class="w"> </span><span class="err">#################################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">protocol</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RFC</span><span class="w"> </span><span class="nf">1436</span><span class="w"> </span><span class="p">(</span><span class="n">https</span><span class="p">:</span><span class="c1">//www.ietf.org/rfc/rfc1436.txt).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">popular</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">late</span><span class="w"> </span><span class="err">&#39;</span><span class="n">90s</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">alternative</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">web</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">simple</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">100</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="k">this</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">support</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">nowadays</span><span class="o">?</span><span class="w"> </span><span class="n">Well</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="o">*</span><span class="n">really</span><span class="o">*</span><span class="w"> </span><span class="n">died</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">lately</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">movement</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">hierarchical</span><span class="w"> </span><span class="n">content</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">composed</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">plain</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">documents</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">resurrected</span><span class="p">.</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">simpler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">internet</span><span class="p">,</span><span class="w"> </span><span class="n">others</span><span class="w"> </span><span class="n">believe</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">mainstream</span><span class="w"> </span><span class="n">internet</span><span class="w"> </span><span class="n">became</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">much</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">controlled</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">it</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">cool</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">people</span><span class="w"> </span><span class="n">that</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bit</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">fresh</span><span class="w"> </span><span class="n">air</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Anyway</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">10nth</span><span class="w"> </span><span class="n">birthday</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">gave</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">protocol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">gift</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="n">HOW</span><span class="w"> </span><span class="n">IT</span><span class="w"> </span><span class="n">WORKS</span><span class="o">?</span><span class="w"> </span><span class="o">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Redis</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">specifically</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">anyway</span><span class="w"> </span><span class="n">illegal</span><span class="p">:</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="s">&#34;/&#34;</span><span class="w"> </span><span class="p">(</span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">starting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">slash</span><span class="p">).</span><span class="w"> </span><span class="n">Normal</span><span class="w"> </span><span class="n">RESP2</span><span class="o">/</span><span class="n">RESP3</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">completely</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">served</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">well</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">it</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="s">&#34;/foo&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="s">&#34;/foo&#34;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">served</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">protocol</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">real</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="s">&#34;hole&#34;</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">site</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">Gopher</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">talking</span><span class="p">),</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/antirez/gopher2redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="n">SECURITY</span><span class="w"> </span><span class="n">WARNING</span><span class="w"> </span><span class="o">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">plan</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">put</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">internet</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">publicly</span><span class="w"> </span><span class="n">accessible</span><span class="w"> </span><span class="n">address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">pages</span><span class="w"> </span><span class="n">MAKE</span><span class="w"> </span><span class="n">SURE</span><span class="w"> </span><span class="n">TO</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Once</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">1</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="nf">server</span><span class="w"> </span><span class="p">(</span><span class="n">when</span><span class="w"> </span><span class="n">enabled</span><span class="p">,</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="p">)</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">serve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">      </span><span class="n">content</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">Gopher</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">2</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">will</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">      </span><span class="n">authenticate</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">&#39;</span><span class="n">requirepass</span><span class="err">&#39;</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">protect</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">Gopher</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">uncomment</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">set</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="nf">no</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">yes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">gopher</span><span class="o">-</span><span class="n">enabled</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">###############################</span><span class="w"> </span><span class="n">ADVANCED</span><span class="w"> </span><span class="n">CONFIG</span><span class="w"> </span><span class="err">###############################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Hashes</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">efficient</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">structure</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">entries</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">biggest</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exceed</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">given</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">threshold</span><span class="p">.</span><span class="w"> </span><span class="n">These</span><span class="w"> </span><span class="n">thresholds</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">directives</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">hash</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">ziplist</span><span class="o">-</span><span class="n">entries</span><span class="w"> </span><span class="n">512</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">hash</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">ziplist</span><span class="o">-</span><span class="n">value</span><span class="w"> </span><span class="n">64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Lists</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">entries</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">specified</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">elements</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="o">-</span><span class="n">5</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">-</span><span class="n">5</span><span class="p">:</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="n">64</span><span class="w"> </span><span class="n">Kb</span><span class="w">  </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">recommended</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">workloads</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">-</span><span class="n">4</span><span class="p">:</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="n">32</span><span class="w"> </span><span class="n">Kb</span><span class="w">  </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">recommended</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">-</span><span class="n">3</span><span class="p">:</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="n">16</span><span class="w"> </span><span class="n">Kb</span><span class="w">  </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">probably</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">recommended</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">-</span><span class="n">2</span><span class="p">:</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="n">8</span><span class="w"> </span><span class="n">Kb</span><span class="w">   </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">good</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="p">:</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="n">4</span><span class="w"> </span><span class="n">Kb</span><span class="w">   </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">good</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Positive</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">_exactly_</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">elements</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">highest</span><span class="w"> </span><span class="n">performing</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="o">-</span><span class="n">2</span><span class="w"> </span><span class="p">(</span><span class="n">8</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="w"> </span><span class="p">(</span><span class="n">4</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="n">size</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">unique</span><span class="p">,</span><span class="w"> </span><span class="n">adjust</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">necessary</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">list</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">ziplist</span><span class="o">-</span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="n">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Lists</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">compressed</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Compress</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">quicklist</span><span class="w"> </span><span class="n">ziplist</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">*</span><span class="n">each</span><span class="o">*</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">*</span><span class="n">exclude</span><span class="o">*</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">compression</span><span class="p">.</span><span class="w">  </span><span class="n">The</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">uncompressed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="n">push</span><span class="o">/</span><span class="n">pop</span><span class="w"> </span><span class="n">operations</span><span class="p">.</span><span class="w">  </span><span class="n">Settings</span><span class="w"> </span><span class="n">are</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">0</span><span class="p">:</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">compression</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">:</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="s">&#34;don&#39;t start compressing until after 1 node into the list,
</span></span></span><span class="line"><span class="cl"><span class="s">#    going from either the head or tail&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">So</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">head</span><span class="o">]-&gt;</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">node</span><span class="o">-&gt;</span><span class="p">...</span><span class="o">-&gt;</span><span class="n">node</span><span class="o">-&gt;[</span><span class="n">tail</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="o">[</span><span class="n">head</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">tail</span><span class="o">]</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">uncompressed</span><span class="p">;</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">compress</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">head</span><span class="o">]-&gt;[</span><span class="n">next</span><span class="o">]-&gt;</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">node</span><span class="o">-&gt;</span><span class="p">...</span><span class="o">-&gt;</span><span class="n">node</span><span class="o">-&gt;[</span><span class="n">prev</span><span class="o">]-&gt;[</span><span class="n">tail</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">2</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">means</span><span class="p">:</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">compress</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">tail</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">but</span><span class="w"> </span><span class="n">compress</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">them</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">3</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">head</span><span class="o">]-&gt;[</span><span class="n">next</span><span class="o">]-&gt;[</span><span class="n">next</span><span class="o">]-&gt;</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">node</span><span class="o">-&gt;</span><span class="p">...</span><span class="o">-&gt;</span><span class="n">node</span><span class="o">-&gt;[</span><span class="n">prev</span><span class="o">]-&gt;[</span><span class="n">prev</span><span class="o">]-&gt;[</span><span class="n">tail</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">etc</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">list</span><span class="o">-</span><span class="n">compress</span><span class="o">-</span><span class="n">depth</span><span class="w"> </span><span class="n">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Sets</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">encoding</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">case</span><span class="p">:</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">composed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">strings</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">integers</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">radix</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">range</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">64</span><span class="w"> </span><span class="n">bit</span><span class="w"> </span><span class="n">signed</span><span class="w"> </span><span class="n">integers</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">sets</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="n">encoding</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">set</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">intset</span><span class="o">-</span><span class="n">entries</span><span class="w"> </span><span class="n">512</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Similarly</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">hashes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">lists</span><span class="p">,</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="n">sets</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">specially</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">space</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">encoding</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">below</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">zset</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">ziplist</span><span class="o">-</span><span class="n">entries</span><span class="w"> </span><span class="n">128</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">zset</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">ziplist</span><span class="o">-</span><span class="n">value</span><span class="w"> </span><span class="n">64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">HyperLogLog</span><span class="w"> </span><span class="n">sparse</span><span class="w"> </span><span class="n">representation</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">limit</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">includes</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">16</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">header</span><span class="p">.</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">HyperLogLog</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">sparse</span><span class="w"> </span><span class="n">representation</span><span class="w"> </span><span class="n">crosses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">limit</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">converted</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dense</span><span class="w"> </span><span class="n">representation</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">greater</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">16000</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">totally</span><span class="w"> </span><span class="n">useless</span><span class="p">,</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">dense</span><span class="w"> </span><span class="n">representation</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">efficient</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">suggested</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">3000</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benefits</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="n">efficient</span><span class="w"> </span><span class="n">encoding</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">slowing</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">much</span><span class="w"> </span><span class="n">PFADD</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="nf">O</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">sparse</span><span class="w"> </span><span class="n">encoding</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">raised</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">10000</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">concern</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="n">is</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">composed</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">HyperLogLogs</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">cardinality</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">15000</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">hll</span><span class="o">-</span><span class="n">sparse</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">bytes</span><span class="w"> </span><span class="n">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Streams</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">structure</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">radix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">inside</span><span class="p">.</span><span class="w"> </span><span class="n">Using</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">switching</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">when</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">appending</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="n">entries</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">ignored</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">entires</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">max</span><span class="o">-</span><span class="n">bytes</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">max</span><span class="o">-</span><span class="n">entries</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">desired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">stream</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">bytes</span><span class="w"> </span><span class="n">4096</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">stream</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">entries</span><span class="w"> </span><span class="n">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Active</span><span class="w"> </span><span class="n">rehashing</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">millisecond</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">100</span><span class="w"> </span><span class="n">milliseconds</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">rehashing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="nf">table</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="n">top</span><span class="o">-</span><span class="n">level</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">values</span><span class="p">).</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="nf">uses</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">dict</span><span class="p">.</span><span class="na">c</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">performs</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lazy</span><span class="w"> </span><span class="n">rehashing</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="n">table</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">rehashing</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">rehashing</span><span class="w"> </span><span class="s">&#34;steps&#34;</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">performed</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">idle</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">rehashing</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="n">table</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">millisecond</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">actively</span><span class="w"> </span><span class="n">rehash</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">dictionaries</span><span class="p">,</span><span class="w"> </span><span class="n">freeing</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">possible</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">unsure</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="s">&#34;activerehashing no&#34;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">requirements</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="n">thing</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">reply</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">2</span><span class="w"> </span><span class="n">milliseconds</span><span class="w"> </span><span class="n">delay</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="s">&#34;activerehashing yes&#34;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">requirements</span><span class="w"> </span><span class="n">but</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">asap</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">possible</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">activerehashing</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">limits</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="n">disconnection</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">clients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="nf">reason</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">common</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">consume</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">publisher</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">produce</span><span class="w"> </span><span class="n">them</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">differently</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">clients</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">including</span><span class="w"> </span><span class="n">MONITOR</span><span class="w"> </span><span class="n">clients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">replica</span><span class="w">  </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">clients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">pubsub</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">subscribed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">pubsub</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">pattern</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">client</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="n">limit</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">client</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="n">limit</span><span class="w"> </span><span class="o">&lt;</span><span class="kd">class</span><span class="err">&gt;</span> <span class="err">&lt;</span><span class="nc">hard</span><span class="w"> </span><span class="n">limit</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">soft</span><span class="w"> </span><span class="n">limit</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">soft</span><span class="w"> </span><span class="n">seconds</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">immediately</span><span class="w"> </span><span class="n">disconnected</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="k">if</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">soft</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">remains</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="p">(</span><span class="n">continuously</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">32</span><span class="w"> </span><span class="n">megabytes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">soft</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">16</span><span class="w"> </span><span class="n">megabytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">disconnected</span><span class="w"> </span><span class="n">immediately</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">buffers</span><span class="w"> </span><span class="n">reach</span><span class="w"> </span><span class="n">32</span><span class="w"> </span><span class="n">megabytes</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">disconnected</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">reaches</span><span class="w"> </span><span class="n">16</span><span class="w"> </span><span class="n">megabytes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">continuously</span><span class="w"> </span><span class="n">overcomes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">seconds</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">limited</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">receive</span><span class="w"> </span><span class="n">data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="nf">asking</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">way</span><span class="p">),</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">only</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">asynchronous</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">scenario</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">requested</span><span class="w"> </span><span class="n">faster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">read</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Instead</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pubsub</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">clients</span><span class="p">,</span><span class="w"> </span><span class="n">since</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">subscribers</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="n">receive</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">fashion</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Both</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">soft</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">disabled</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">zero</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">client</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="n">limit</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">client</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="n">limit</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">256mb</span><span class="w"> </span><span class="n">64mb</span><span class="w"> </span><span class="n">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">client</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="n">limit</span><span class="w"> </span><span class="n">pubsub</span><span class="w"> </span><span class="n">32mb</span><span class="w"> </span><span class="n">8mb</span><span class="w"> </span><span class="n">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Client</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">buffers</span><span class="w"> </span><span class="n">accumulate</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="w"> </span><span class="n">They</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">limited</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">fixed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="nf">desynchronization</span><span class="w"> </span><span class="p">(</span><span class="k">for</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">lead</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">unbound</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">special</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">needs</span><span class="p">,</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="n">huge</span><span class="w"> </span><span class="n">multi</span><span class="o">/</span><span class="n">exec</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">alike</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">client</span><span class="o">-</span><span class="n">query</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="n">limit</span><span class="w"> </span><span class="n">1gb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">protocol</span><span class="p">,</span><span class="w"> </span><span class="n">bulk</span><span class="w"> </span><span class="n">requests</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="p">,</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="n">representing</span><span class="w"> </span><span class="n">single</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">strings</span><span class="p">,</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">normally</span><span class="w"> </span><span class="n">limited</span><span class="w"> </span><span class="n">ot</span><span class="w"> </span><span class="n">512</span><span class="w"> </span><span class="n">mb</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">limit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">1mb</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">greater</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">proto</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">bulk</span><span class="o">-</span><span class="n">len</span><span class="w"> </span><span class="n">512mb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">tasks</span><span class="p">,</span><span class="w"> </span><span class="n">like</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">closing</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">timeout</span><span class="p">,</span><span class="w"> </span><span class="n">purging</span><span class="w"> </span><span class="n">expired</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">requested</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">forth</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Not</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">frequency</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">checks</span><span class="w"> </span><span class="k">for</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">according</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="s">&#34;hz&#34;</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s">&#34;hz&#34;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="w"> </span><span class="n">Raising</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">when</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">idle</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">responsive</span><span class="w"> </span><span class="n">when</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">expiring</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">timeouts</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">handled</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">precision</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">500</span><span class="p">,</span><span class="w"> </span><span class="n">however</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">100</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="n">not</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="n">idea</span><span class="p">.</span><span class="w"> </span><span class="n">Most</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">100</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">environments</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">required</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">hz</span><span class="w"> </span><span class="n">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Normally</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">HZ</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">proportional</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">connected</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">invocation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">spikes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Since</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">HZ</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">conservatively</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">10</span><span class="p">,</span><span class="w"> </span><span class="n">Redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">offers</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">enables</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ability</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">adaptive</span><span class="w"> </span><span class="n">HZ</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">clients</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">dynamic</span><span class="w"> </span><span class="n">HZ</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">HZ</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">baseline</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">multiples</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">HZ</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">actually</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">connected</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">idle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">little</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">responsive</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">dynamic</span><span class="o">-</span><span class="n">hz</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">rewrites</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AOF</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fsync</span><span class="o">-</span><span class="n">ed</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">32</span><span class="w"> </span><span class="n">MB</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">generated</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">commit</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">incrementally</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">avoid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">spikes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">aof</span><span class="o">-</span><span class="n">rewrite</span><span class="o">-</span><span class="n">incremental</span><span class="o">-</span><span class="n">fsync</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">redis</span><span class="w"> </span><span class="n">saves</span><span class="w"> </span><span class="n">RDB</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fsync</span><span class="o">-</span><span class="n">ed</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">32</span><span class="w"> </span><span class="n">MB</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">generated</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">commit</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">incrementally</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">avoid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">spikes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">rdb</span><span class="o">-</span><span class="n">save</span><span class="o">-</span><span class="n">incremental</span><span class="o">-</span><span class="n">fsync</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">LFU</span><span class="w"> </span><span class="nf">eviction</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">maxmemory</span><span class="w"> </span><span class="n">setting</span><span class="p">)</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">tuned</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">good</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">idea</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">investigating</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">improve</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">performances</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">LFU</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">inspect</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">OBJECT</span><span class="w"> </span><span class="n">FREQ</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">There</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">tunable</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">LFU</span><span class="w"> </span><span class="n">implementation</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">logarithm</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">decay</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">understand</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">changing</span><span class="w"> </span><span class="n">them</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">LFU</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">8</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">255</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">Redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">probabilistic</span><span class="w"> </span><span class="n">increment</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">logarithmic</span><span class="w"> </span><span class="n">behavior</span><span class="p">.</span><span class="w"> </span><span class="n">Given</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">counter</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">accessed</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">incremented</span><span class="w"> </span><span class="n">in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">way</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">extracted</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">probability</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">calculated</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">1</span><span class="o">/</span><span class="p">(</span><span class="n">old_value</span><span class="o">*</span><span class="n">lfu_log_factor</span><span class="o">+</span><span class="n">1</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">3</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">incremented</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">lfu</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="n">factor</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">frequency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">accesses</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">different</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">logarithmic</span><span class="w"> </span><span class="n">factors</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">+--------+------------+------------+------------+------------+------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">100</span><span class="w"> </span><span class="n">hits</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">1000</span><span class="w"> </span><span class="n">hits</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">100K</span><span class="w"> </span><span class="n">hits</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">1M</span><span class="w"> </span><span class="n">hits</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">10M</span><span class="w"> </span><span class="n">hits</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">+--------+------------+------------+------------+------------+------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">0</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">104</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">+--------+------------+------------+------------+------------+------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">1</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">18</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">49</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">+--------+------------+------------+------------+------------+------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">10</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">10</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">18</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">142</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">+--------+------------+------------+------------+------------+------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">100</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">8</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">11</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">49</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">143</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">255</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">+--------+------------+------------+------------+------------+------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">obtained</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">commands</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">redis</span><span class="o">-</span><span class="n">benchmark</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="n">1000000</span><span class="w"> </span><span class="n">incr</span><span class="w"> </span><span class="n">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">   </span><span class="n">redis</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">freq</span><span class="w"> </span><span class="n">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">NOTE</span><span class="w"> </span><span class="n">2</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">5</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">give</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">chance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">accumulate</span><span class="w"> </span><span class="n">hits</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">decay</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">elapse</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">divided</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="nf">two</span><span class="w"> </span><span class="p">(</span><span class="n">or</span><span class="w"> </span><span class="n">decremented</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">10</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lfu</span><span class="o">-</span><span class="n">decay</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">1</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">Special</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">decay</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">happens</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">scanned</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">lfu</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="n">factor</span><span class="w"> </span><span class="n">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">lfu</span><span class="o">-</span><span class="n">decay</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">###########################</span><span class="w"> </span><span class="n">ACTIVE</span><span class="w"> </span><span class="n">DEFRAGMENTATION</span><span class="w"> </span><span class="err">#######################</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">defragmentation</span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="o">-------------------------------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Active</span><span class="w"> </span><span class="p">(</span><span class="n">online</span><span class="p">)</span><span class="w"> </span><span class="n">defragmentation</span><span class="w"> </span><span class="n">allows</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compact</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">spaces</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">allocations</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">deallocations</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">memory</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">thus</span><span class="w"> </span><span class="n">allowing</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reclaim</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">memory</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Fragmentation</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">natural</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">happens</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="nf">allocator</span><span class="w"> </span><span class="p">(</span><span class="n">but</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Jemalloc</span><span class="p">,</span><span class="w"> </span><span class="n">fortunately</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="n">workloads</span><span class="p">.</span><span class="w"> </span><span class="n">Normally</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">restart</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">lower</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fragmentation</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">flush</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">away</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">again</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="w"> </span><span class="n">thanks</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">feature</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">Oran</span><span class="w"> </span><span class="n">Agra</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">4</span><span class="p">.</span><span class="na">0</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">runtime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="s">&#34;hot&#34;</span><span class="w"> </span><span class="n">way</span><span class="p">,</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">running</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Basically</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fragmentation</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="nf">level</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="n">below</span><span class="p">)</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">copies</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">contiguous</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">regions</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">exploiting</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">Jemalloc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">understand</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">allocation</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">causing</span><span class="w"> </span><span class="n">fragmentation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">allocate</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">place</span><span class="p">),</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">copies</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">process</span><span class="p">,</span><span class="w"> </span><span class="n">repeated</span><span class="w"> </span><span class="n">incrementally</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">keys</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fragmentation</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">drop</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Important</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">understand</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">1</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">disabled</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">Redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Jemalloc</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">ship</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Redis</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">builds</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">2</span><span class="p">.</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">fragmentation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">issues</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">3</span><span class="p">.</span><span class="w"> </span><span class="n">Once</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">experience</span><span class="w"> </span><span class="n">fragmentation</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">when</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">    </span><span class="n">needed</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="s">&#34;CONFIG SET activedefrag yes&#34;</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">fine</span><span class="w"> </span><span class="n">tune</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">behavior</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">defragmentation</span><span class="w"> </span><span class="n">process</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="n">idea</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">leave</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">defaults</span><span class="w"> </span><span class="n">untouched</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Enabled</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">defragmentation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">activedefrag</span><span class="w"> </span><span class="n">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Minimum</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">fragmentation</span><span class="w"> </span><span class="n">waste</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">defrag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">active</span><span class="o">-</span><span class="n">defrag</span><span class="o">-</span><span class="n">ignore</span><span class="o">-</span><span class="n">bytes</span><span class="w"> </span><span class="n">100mb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Minimum</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">fragmentation</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">defrag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">active</span><span class="o">-</span><span class="n">defrag</span><span class="o">-</span><span class="n">threshold</span><span class="o">-</span><span class="n">lower</span><span class="w"> </span><span class="n">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">fragmentation</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">effort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">active</span><span class="o">-</span><span class="n">defrag</span><span class="o">-</span><span class="n">threshold</span><span class="o">-</span><span class="n">upper</span><span class="w"> </span><span class="n">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Minimal</span><span class="w"> </span><span class="n">effort</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">defrag</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">percentage</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lower</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">active</span><span class="o">-</span><span class="n">defrag</span><span class="o">-</span><span class="n">cycle</span><span class="o">-</span><span class="n">min</span><span class="w"> </span><span class="n">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Maximal</span><span class="w"> </span><span class="n">effort</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">defrag</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">percentage</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">upper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reached</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">active</span><span class="o">-</span><span class="n">defrag</span><span class="o">-</span><span class="n">cycle</span><span class="o">-</span><span class="n">max</span><span class="w"> </span><span class="n">25</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">set</span><span class="o">/</span><span class="n">hash</span><span class="o">/</span><span class="n">zset</span><span class="o">/</span><span class="n">list</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="n">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">dictionary</span><span class="w"> </span><span class="n">scan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">active</span><span class="o">-</span><span class="n">defrag</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">scan</span><span class="o">-</span><span class="n">fields</span><span class="w"> </span><span class="n">1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Jemalloc</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">purging</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">jemalloc</span><span class="o">-</span><span class="n">bg</span><span class="o">-</span><span class="n">thread</span><span class="w"> </span><span class="n">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pin</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">processes</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specific</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">CPUs</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">system</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">maximize</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">performances</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pin</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">different</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">CPUs</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">running</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">pinned</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">CPUs</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Normally</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s">&#34;taskset&#34;</span><span class="w"> </span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">however</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">also</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">directly</span><span class="p">,</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">FreeBSD</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">pin</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="o">/</span><span class="n">IO</span><span class="w"> </span><span class="n">threads</span><span class="p">,</span><span class="w"> </span><span class="n">bio</span><span class="w"> </span><span class="n">threads</span><span class="p">,</span><span class="w"> </span><span class="n">aof</span><span class="w"> </span><span class="n">rewrite</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">process</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bgsave</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">process</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cpu</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">as</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">taskset</span><span class="w"> </span><span class="n">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">redis</span><span class="w"> </span><span class="n">server</span><span class="o">/</span><span class="n">io</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">cpu</span><span class="w"> </span><span class="n">affinity</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">4</span><span class="p">,</span><span class="n">6</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">server_cpulist</span><span class="w"> </span><span class="n">0</span><span class="o">-</span><span class="n">7</span><span class="p">:</span><span class="n">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">bio</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">cpu</span><span class="w"> </span><span class="n">affinity</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="n">3</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">bio_cpulist</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="n">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">aof</span><span class="w"> </span><span class="n">rewrite</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">cpu</span><span class="w"> </span><span class="n">affinity</span><span class="w"> </span><span class="n">8</span><span class="p">,</span><span class="n">9</span><span class="p">,</span><span class="n">10</span><span class="p">,</span><span class="n">11</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">aof_rewrite_cpulist</span><span class="w"> </span><span class="n">8</span><span class="o">-</span><span class="n">11</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">bgsave</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">cpu</span><span class="w"> </span><span class="n">affinity</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="n">10</span><span class="p">,</span><span class="n">11</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="n">bgsave_cpulist</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="n">10</span><span class="o">-</span><span class="n">11</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="测试-redis-cli连接上来">测试 redis-cli连接上来</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it 运行着redis服务容器的ID redis-cli<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-28-49.png" alt=""></p>
<h4 id="测试持久化文件生成">测试持久化文件生成</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-29-12.png" alt=""></p>
<h1 id="第-8-章-将镜像推送到阿里云">第 8 章 将镜像推送到阿里云</h1>
<h3 id="本地镜像发布到阿里云流程">本地镜像发布到阿里云流程</h3>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-49-17.png" alt=""></p>
<h3 id="镜像生成方法">镜像生成方法</h3>
<p>1、前面的Dockerfile</p>
<p>2、从容器中创建一个新的镜像</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">docker commit <span class="o">[</span>OPTIONS<span class="o">]</span> 容器ID <span class="o">[</span>REPOSITORY<span class="o">[</span>:TAG<span class="o">]]</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-50-48.png" alt=""></p>
<h3 id="将本地镜像推送到阿里云">将本地镜像推送到阿里云</h3>
<h4 id="1本地镜像素材原型">1、本地镜像素材原型</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-51-52.png" alt=""></p>
<p>2、阿里云开发者平台</p>
<p><a href="https://promotion.aliyun.com/ntms/act/kubernetes.html">https://promotion.aliyun.com/ntms/act/kubernetes.html</a></p>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-53-02.png" alt=""></p>
<h4 id="3创建镜像仓库">3、创建镜像仓库</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-54-07.png" alt=""></p>
<p>命名空间</p>
<p>仓库名称</p>
<h4 id="4将镜像推送到registry">4、将镜像推送到registry</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="n">white3e</span><span class="w"> </span><span class="n">registry</span><span class="p">.</span><span class="na">cn</span><span class="o">-</span><span class="n">shenzhen</span><span class="p">.</span><span class="na">aliyuncs</span><span class="p">.</span><span class="na">com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">[</span><span class="n">ImageId</span><span class="o">]</span><span class="w"> </span><span class="n">registry</span><span class="p">.</span><span class="na">cn</span><span class="o">-</span><span class="n">shenzhen</span><span class="p">.</span><span class="na">aliyuncs</span><span class="p">.</span><span class="na">com</span><span class="o">/</span><span class="n">ggccqq</span><span class="o">/</span><span class="n">mycentos</span><span class="p">:</span><span class="o">[</span><span class="n">镜像版本号</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">registry</span><span class="p">.</span><span class="na">cn</span><span class="o">-</span><span class="n">shenzhen</span><span class="p">.</span><span class="na">aliyuncs</span><span class="p">.</span><span class="na">com</span><span class="o">/</span><span class="n">ggccqq</span><span class="o">/</span><span class="n">mycentos</span><span class="p">:</span><span class="o">[</span><span class="n">镜像版本号</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">其中</span><span class="o">[</span><span class="n">ImageId</span><span class="o">][</span><span class="n">镜像版本</span><span class="o">]</span><span class="n">自己填写</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-56-10.png" alt=""></p>
<h4 id="5公有云可以查询得到">5、公有云可以查询得到</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-56-53.png" alt=""></p>
<h4 id="6查看详情">6、查看详情</h4>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-57-23.png" alt=""></p>
<h3 id="将阿里云上的镜像下载到本地">将阿里云上的镜像下载到本地</h3>
<p><img src="https://raw.githubusercontent.com/cold-bin/img-for-cold-bin-blog/master/img/Snipaste_2020-10-04_12-59-00.png" alt=""></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">cold-bin</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2023-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/docker/">docker</a>
          <a href="/tags/dockerfile/">dockerfile</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Linux常用命令</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%B1%87%E7%BC%96%E4%B9%8B%E5%85%B6%E4%BB%96%E5%AE%9A%E4%BD%8D%E5%9C%B0%E5%9D%80%E6%96%B9%E6%B3%95/">
            <span class="next-text nav-default">汇编之其他定位地址方法</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2023-01-10 19:45:16 \u002b0800 CST',
        title: 'Docker基础',
        clientID: 'a19ac21c453d44aaaa57',
        clientSecret: '6b740fcf1281b868b86bb30a974a5ed8db33dbf1',
        repo: 'blog-comment',
        owner: 'cold-bin',
        admin: ['cold-bin'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

  

  

      </div>
    </main>
	

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:cold-bin@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/cold-bin" class="iconfont icon-github" title="github"></a>
      <a href="https://space.bilibili.com/248959839" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://cold-bin.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>cold-bin</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top" title="回到顶部">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.6.4.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>












<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>

<script id="baidu_analytics">
	  var _hmt = _hmt || [];
	  (function() {
		if (window.location.hostname === 'localhost') return;
		var hm = document.createElement("script"); hm.async = true;
		hm.src = "https://hm.baidu.com/hm.js?cabc0a71f63da092412d82d1aefe7d1c";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	  })();
	</script>


	<script id="baidu_push">
	  (function(){
		if (window.location.hostname === 'localhost') return;
		var bp = document.createElement('script'); bp.async = true;
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
		  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
		  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	  })();
	</script>


<script>
  function createCopyButton(highlightDiv) {
    const div = document.createElement("div");
    div.className = "copy-code";
    div.innerText = "Copy";
    div.addEventListener("click", () =>
      copyCodeToClipboard(div, highlightDiv)
    );
    addCopyButtonToDom(div, highlightDiv);
  }

  async function copyCodeToClipboard(button, highlightDiv) {
    const codeToCopy = highlightDiv.querySelector(":last-child > .chroma > code")
      .innerText;
    await navigator.clipboard.writeText(codeToCopy);
    button.blur();
    button.innerText = "Copied!";
    setTimeout(() => button.innerText = "Copy", 2000);
  }

  function addCopyButtonToDom(button, highlightDiv) {
    highlightDiv.insertBefore(button, highlightDiv.firstChild);
    const wrapper = document.createElement("div");
    wrapper.className = "highlight-wrapper";
    highlightDiv.parentNode.insertBefore(wrapper, highlightDiv);
    wrapper.appendChild(highlightDiv);
  }

  var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  if(!isMobile){
     document.querySelectorAll(".highlight").forEach((highlightDiv) => createCopyButton(highlightDiv));
  }
</script>  


</body>
</html>
